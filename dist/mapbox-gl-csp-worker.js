var mapboxgl=function(){"use strict";var e=t;function t(e,t){this.x=e,this.y=t}t.prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e};var r="undefined"!=typeof self?self:{};const n=Math.PI/180,i=180/Math.PI;function s(e){return e*n}function o(e){return e*i}function a(e,t,r){return Math.min(r,Math.max(t,e))}function l(e,t,r){const n=r-t,i=((e-t)%n+n)%n+t;return i===t?r:i}function u(e,t,r){if(!e.length)return r(null,[]);let n=e.length;const i=new Array(e.length);let s=null;e.forEach(((e,o)=>{t(e,((e,t)=>{e&&(s=e),i[o]=t,0==--n&&r(s,i)}))}))}function c(e){const t=[];for(const r in e)t.push(e[r]);return t}function h(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}let p=1;function d(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function f(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function y(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function m(e,t){return-1!==e.indexOf(t,e.length-t.length)}function g(e,t,r){const n={};for(const i in e)n[i]=t.call(r||this,e[i],i,e);return n}function x(e){return Array.isArray(e)?e.map(x):"object"==typeof e&&e?g(e,x):e}const v={};function b(e){v[e]||("undefined"!=typeof console&&console.warn(e),v[e]=!0)}function w(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function _(e){let t=0;for(let r,n,i=0,s=e.length,o=s-1;i<s;o=i++)r=e[i],n=e[o],t+=(n.x-r.x)*(r.y+n.y);return t}function S(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function A(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,r,n,i)=>{const s=n||i;return t[r]=!s||s.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let k=null;function I(e){if(null==k){const t=e.navigator?e.navigator.userAgent:null;k=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return k}function P(e){try{const t=r[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function T(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}var C=E;function E(e,t,r){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(r=i[2]);for(var s=0;s<this.d*this.d;s++){var o=i[3+s],a=i[3+s+1];n.push(o===a?null:i.subarray(o,a))}var l=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var c=r/t*e;this.min=-c,this.max=e+c}function M(e){var t={exports:{}};return e(t,t.exports),t.exports}E.prototype.insert=function(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},E.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},E.prototype._insertCell=function(e,t,r,n,i,s){this.cells[i].push(s)},E.prototype.query=function(e,t,r,n,i){var s=this.min,o=this.max;if(e<=s&&t<=s&&o<=r&&o<=n&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,r,n,this._queryCell,a,{},i),a},E.prototype._queryCell=function(e,t,r,n,i,s,o,a){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===o[p]){var d=4*p;(a?a(c[d+0],c[d+1],c[d+2],c[d+3]):e<=c[d+2]&&t<=c[d+3]&&r>=c[d+0]&&n>=c[d+1])?(o[p]=!0,s.push(u[p])):o[p]=!1}}},E.prototype._forEachCell=function(e,t,r,n,i,s,o,a){for(var l=this._convertToCellCoord(e),u=this._convertToCellCoord(t),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),p=l;p<=c;p++)for(var d=u;d<=h;d++){var f=this.d*d+p;if((!a||a(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&i.call(this,e,t,r,n,f,s,o,a))return}},E.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},E.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},E.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(t+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var s=t,o=0;o<e.length;o++){var a=e[o];i[3+o]=s,i.set(a,s),s+=a.length}return i[3+e.length]=s,i.set(this.keys,s),i[3+e.length+1]=s+=this.keys.length,i.set(this.bboxes,s),s+=this.bboxes.length,i.buffer};var D=M((function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(e){return(e=Math.round(e))<0?0:e>255?255:e}function i(e){return n("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function s(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function o(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{t.parseCSSColor=function(e){var t,a=e.replace(/ /g,"").toLowerCase();if(a in r)return r[a].slice();if("#"===a[0])return 4===a.length?(t=parseInt(a.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===a.length&&(t=parseInt(a.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=a.indexOf("("),u=a.indexOf(")");if(-1!==l&&u+1===a.length){var c=a.substr(0,l),h=a.substr(l+1,u-(l+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=s(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=s(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),y=s(h[2]),m=y<=.5?y*(f+1):y+f-y*f,g=2*y-m;return[n(255*o(g,m,d+1/3)),n(255*o(g,m,d)),n(255*o(g,m,d-1/3)),p];default:return null}}return null}}catch(e){}}));class Color{constructor(e,t,r,n=1){this.r=e,this.g=t,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof Color)return e;if("string"!=typeof e)return;const t=D.parseCSSColor(e);return t?new Color(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${n})`}toArray(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*r/n,n]}toArray01(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,r/n,n]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:r,a:n}=this;return[e,t,r,n]}}Color.black=new Color(0,0,0,1),Color.white=new Color(1,1,1,1),Color.transparent=new Color(0,0,0,0),Color.red=new Color(1,0,0,1),Color.blue=new Color(0,0,1,1);var z=Color;function B(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}class ParsingError extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var V=ParsingError;class Scope{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,r]of t)this.bindings[e]=r}concat(e){return new Scope(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var L=Scope;const F={kind:"null"},R={kind:"number"},O={kind:"string"},j={kind:"boolean"},q={kind:"color"},$={kind:"object"},U={kind:"value"},N={kind:"collator"},K={kind:"formatted"},Z={kind:"resolvedImage"};function G(e,t){return{kind:"array",itemType:e,N:t}}function X(e){if("array"===e.kind){const t=X(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Y=[F,R,O,j,q,K,$,G(U),Z];function W(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!W(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Y)if(!W(e,t))return null}return`Expected ${X(e)} but found ${X(t)} instead.`}function J(e,t){return t.some((t=>t.kind===e.kind))}function H(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class Collator{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class FormattedSection{constructor(e,t,r,n,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class Formatted{constructor(e){this.sections=e}static fromString(e){return new Formatted([new FormattedSection(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Formatted?e:Formatted.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class ResolvedImage{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ResolvedImage({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Q(e,t,r,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ee(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof z)return!0;if(e instanceof Collator)return!0;if(e instanceof Formatted)return!0;if(e instanceof ResolvedImage)return!0;if(Array.isArray(e)){for(const t of e)if(!ee(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!ee(e[t]))return!1;return!0}return!1}function te(e){if(null===e)return F;if("string"==typeof e)return O;if("boolean"==typeof e)return j;if("number"==typeof e)return R;if(e instanceof z)return q;if(e instanceof Collator)return N;if(e instanceof Formatted)return K;if(e instanceof ResolvedImage)return Z;if(Array.isArray(e)){const t=e.length;let r;for(const t of e){const e=te(t);if(r){if(r===e)continue;r=U;break}r=e}return G(r||U,t)}return $}function re(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof z||e instanceof Formatted||e instanceof ResolvedImage?e.toString():JSON.stringify(e)}class Literal{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ee(e[1]))return t.error("invalid value");const r=e[1];let n=te(r);const i=t.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new Literal(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof z?["rgba"].concat(this.value.toArray()):this.value instanceof Formatted?this.value.serialize():this.value}}var ne=Literal,ie=class RuntimeError{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const se={string:O,number:R,boolean:j,object:$};class Assertion{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,n=1;const i=e[0];if("array"===i){let i,s;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in se)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=se[r],n++}else i=U;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);s=e[2],n++}r=G(i,s)}else r=se[i];const s=[];for(;n<e.length;n++){const r=t.parse(e[n],n,U);if(!r)return null;s.push(r)}return new Assertion(r,s)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!W(this.type,te(r)))return r;if(t===this.args.length-1)throw new ie(`Expected value to be of type ${X(this.type)}, but found ${X(te(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}var oe=Assertion;class FormatExpression{constructor(e){this.type=K,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const n=[];let i=!1;for(let r=1;r<=e.length-1;++r){const s=e[r];if(i&&"object"==typeof s&&!Array.isArray(s)){i=!1;let e=null;if(s["font-scale"]&&(e=t.parse(s["font-scale"],1,R),!e))return null;let r=null;if(s["text-font"]&&(r=t.parse(s["text-font"],1,G(O)),!r))return null;let o=null;if(s["text-color"]&&(o=t.parse(s["text-color"],1,q),!o))return null;const a=n[n.length-1];a.scale=e,a.font=r,a.textColor=o}else{const s=t.parse(e[r],1,U);if(!s)return null;const o=s.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:s,scale:null,font:null,textColor:null})}}return new FormatExpression(n)}evaluate(e){return new Formatted(this.sections.map((t=>{const r=t.content.evaluate(e);return te(r)===Z?new FormattedSection("",r,null,null,null):new FormattedSection(re(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class ImageExpression{constructor(e){this.type=Z,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,O);return r?new ImageExpression(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=ResolvedImage.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ae={"to-boolean":j,"to-color":q,"to-number":R,"to-string":O};class Coercion{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");const n=ae[r],i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],r,U);if(!n)return null;i.push(n)}return new Coercion(n,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const n of this.args){if(t=n.evaluate(e),r=null,t instanceof z)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Q(t[0],t[1],t[2],t[3]),!r))return new z(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ie(r||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new ie(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Formatted.fromString(re(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ResolvedImage.fromString(re(this.args[0].evaluate(e))):re(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new FormatExpression([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ImageExpression(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var le=Coercion;const ue=["Unknown","Point","LineString","Polygon"];var ce=class EvaluationContext{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ue[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=z.parse(e)),t}};class CompoundExpression{constructor(e,t,r,n){this.name=e,this.type=t,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const r=e[0],n=CompoundExpression.definitions[r];if(!n)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(n)?n[0]:n.type,s=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=s.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[n,s]of o){a=new ze(t.registry,t.path,null,t.scope);const o=[];let l=!1;for(let t=1;t<e.length;t++){const r=e[t],i=Array.isArray(n)?n[t-1]:n.type,s=a.parse(r,1+o.length,i);if(!s){l=!0;break}o.push(s)}if(!l)if(Array.isArray(n)&&n.length!==o.length)a.error(`Expected ${n.length} arguments, but found ${o.length} instead.`);else{for(let e=0;e<o.length;e++){const t=Array.isArray(n)?n[e]:n.type,r=o[e];a.concat(e+1).checkSubtype(t,r.type)}if(0===a.errors.length)return new CompoundExpression(r,i,s,o)}}if(1===o.length)t.errors.push(...a.errors);else{const r=(o.length?o:s).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(X).join(", ")})`:`(${X(t.type)}...)`;var t})).join(" | "),n=[];for(let r=1;r<e.length;r++){const i=t.parse(e[r],1+n.length);if(!i)return null;n.push(X(i.type))}t.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){CompoundExpression.definitions=t;for(const r in t)e[r]=CompoundExpression}}var he=CompoundExpression;class CollatorExpression{constructor(e,t,r){this.type=N,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,j);if(!n)return null;const i=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,j);if(!i)return null;let s=null;return r.locale&&(s=t.parse(r.locale,1,O),!s)?null:new CollatorExpression(n,i,s)}evaluate(e){return new Collator(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const pe=8192;function de(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function fe(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ye(e,t){const r=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(r*i*pe),Math.round(n*i*pe)]}function me(e,t,r){const n=e[0]-t[0],i=e[1]-t[1],s=e[0]-r[0],o=e[1]-r[1];return n*o-s*i==0&&n*s<=0&&i*o<=0}function ge(e,t){let r=!1;for(let o=0,a=t.length;o<a;o++){const a=t[o];for(let t=0,o=a.length;t<o-1;t++){if(me(e,a[t],a[t+1]))return!1;(i=a[t])[1]>(n=e)[1]!=(s=a[t+1])[1]>n[1]&&n[0]<(s[0]-i[0])*(n[1]-i[1])/(s[1]-i[1])+i[0]&&(r=!r)}}var n,i,s;return r}function xe(e,t){for(let r=0;r<t.length;r++)if(ge(e,t[r]))return!0;return!1}function ve(e,t,r,n){const i=n[0]-r[0],s=n[1]-r[1],o=(e[0]-r[0])*s-i*(e[1]-r[1]),a=(t[0]-r[0])*s-i*(t[1]-r[1]);return o>0&&a<0||o<0&&a>0}function be(e,t,r){for(const u of r)for(let r=0;r<u.length-1;++r)if(0!=(a=[(o=u[r+1])[0]-(s=u[r])[0],o[1]-s[1]])[0]*(l=[(i=t)[0]-(n=e)[0],i[1]-n[1]])[1]-a[1]*l[0]&&ve(n,i,s,o)&&ve(s,o,n,i))return!0;var n,i,s,o,a,l;return!1}function we(e,t){for(let r=0;r<e.length;++r)if(!ge(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(be(e[r],e[r+1],t))return!1;return!0}function _e(e,t){for(let r=0;r<t.length;r++)if(we(e,t[r]))return!0;return!1}function Se(e,t,r){const n=[];for(let i=0;i<e.length;i++){const s=[];for(let n=0;n<e[i].length;n++){const o=ye(e[i][n],r);de(t,o),s.push(o)}n.push(s)}return n}function Ae(e,t,r){const n=[];for(let i=0;i<e.length;i++){const s=Se(e[i],t,r);n.push(s)}return n}function ke(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){const t=.5*n;let i=e[0]-r[0]>t?-n:r[0]-e[0]>t?n:0;0===i&&(i=e[0]-r[2]>t?-n:r[2]-e[0]>t?n:0),e[0]+=i}de(t,e)}function Ie(e,t,r,n){const i=Math.pow(2,n.z)*pe,s=[n.x*pe,n.y*pe],o=[];if(!e)return o;for(const n of e)for(const e of n){const n=[e.x+s[0],e.y+s[1]];ke(n,t,r,i),o.push(n)}return o}function Pe(e,t,r,n){const i=Math.pow(2,n.z)*pe,s=[n.x*pe,n.y*pe],o=[];if(!e)return o;for(const r of e){const e=[];for(const n of r){const r=[n.x+s[0],n.y+s[1]];de(t,r),e.push(r)}o.push(e)}if(t[2]-t[0]<=i/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of o)for(const n of e)ke(n,t,r,i)}var a;return o}class Within{constructor(e,t){this.type=j,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ee(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Within(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Within(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Within(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const s=Se(t.coordinates,n,i),o=Ie(e.geometry(),r,n,i);if(!fe(r,n))return!1;for(const e of o)if(!ge(e,s))return!1}if("MultiPolygon"===t.type){const s=Ae(t.coordinates,n,i),o=Ie(e.geometry(),r,n,i);if(!fe(r,n))return!1;for(const e of o)if(!xe(e,s))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const s=Se(t.coordinates,n,i),o=Pe(e.geometry(),r,n,i);if(!fe(r,n))return!1;for(const e of o)if(!we(e,s))return!1}if("MultiPolygon"===t.type){const s=Ae(t.coordinates,n,i),o=Pe(e.geometry(),r,n,i);if(!fe(r,n))return!1;for(const e of o)if(!_e(e,s))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Te=Within;function Ce(e){if(e instanceof he){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Te)return!1;let t=!0;return e.eachChild((e=>{t&&!Ce(e)&&(t=!1)})),t}function Ee(e){if(e instanceof he&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Ee(e)&&(t=!1)})),t}function Me(e,t){if(e instanceof he&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild((e=>{r&&!Me(e,t)&&(r=!1)})),r}class Var{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Var(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var De=Var;class ParsingContext{constructor(e,t=[],r,n=new L,i=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=i,this.expectedType=r}parse(e,t,r,n,i={}){return t?this.concat(t,r,n)._parse(e,i):this._parse(e,i)}_parse(e,t){function r(e,t,r){return"assert"===r?new oe(t,[e]):"coerce"===r?new le(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[n];if(i){let n=i.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,i=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"assert")}if(!(n instanceof ne)&&"resolvedImage"!==n.type.kind&&Be(n)){const e=new ce;try{n=new ne(n.type,n.evaluate(e))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const n="number"==typeof e?this.path.concat(e):this.path,i=r?this.scope.concat(r):this.scope;return new ParsingContext(this.registry,n,t||null,i,this.errors)}error(e,...t){const r=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new V(r,e))}checkSubtype(e,t){const r=W(e,t);return r&&this.error(r),r}}var ze=ParsingContext;function Be(e){if(e instanceof De)return Be(e.boundExpression);if(e instanceof he&&"error"===e.name)return!1;if(e instanceof CollatorExpression)return!1;if(e instanceof Te)return!1;const t=e instanceof le||e instanceof oe;let r=!0;return e.eachChild((e=>{r=t?r&&Be(e):r&&e instanceof ne})),!!r&&Ce(e)&&Me(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ve(e,t){const r=e.length-1;let n,i,s=0,o=r,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),n=e[a],i=e[a+1],n<=t){if(a===r||t<i)return a;s=a+1}else{if(!(n>t))throw new ie("Input is not a number.");o=a-1}return 0}class Step{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,R);if(!r)return null;const n=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let r=1;r<e.length;r+=2){const s=1===r?-1/0:e[r],o=e[r+1],a=r,l=r+1;if("number"!=typeof s)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=s)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const u=t.parse(o,l,i);if(!u)return null;i=i||u.type,n.push([s,u])}return new Step(i,r,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;return n>=t[i-1]?r[i-1].evaluate(e):r[Ve(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Le=Step,Fe=Re;function Re(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=r,this.p2y=n}function Oe(e,t,r){return e*(1-r)+t*r}Re.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Re.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Re.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Re.prototype.solveCurveX=function(e,t){var r,n,i,s,o;for(void 0===t&&(t=1e-6),i=e,o=0;o<8;o++){if(s=this.sampleCurveX(i)-e,Math.abs(s)<t)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=s/a}if((i=e)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(s=this.sampleCurveX(i),Math.abs(s-e)<t)return i;e>s?r=i:n=i,i=.5*(n-r)+r}return i},Re.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var je=Object.freeze({__proto__:null,number:Oe,color:function(e,t,r){return new z(Oe(e.r,t.r,r),Oe(e.g,t.g,r),Oe(e.b,t.b,r),Oe(e.a,t.a,r))},array:function(e,t,r){return e.map(((e,n)=>Oe(e,t[n],r)))}});const qe=.95047,$e=1.08883,Ue=4/29,Ne=6/29,Ke=3*Ne*Ne,Ze=Math.PI/180,Ge=180/Math.PI;function Xe(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ke+Ue}function Ye(e){return e>Ne?e*e*e:Ke*(e-Ue)}function We(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Je(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function He(e){const t=Je(e.r),r=Je(e.g),n=Je(e.b),i=Xe((.4124564*t+.3575761*r+.1804375*n)/qe),s=Xe((.2126729*t+.7151522*r+.072175*n)/1);return{l:116*s-16,a:500*(i-s),b:200*(s-Xe((.0193339*t+.119192*r+.9503041*n)/$e)),alpha:e.a}}function Qe(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Ye(t),r=qe*Ye(r),n=$e*Ye(n),new z(We(3.2404542*r-1.5371385*t-.4985314*n),We(-.969266*r+1.8760108*t+.041556*n),We(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}function et(e,t,r){const n=t-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const tt={forward:He,reverse:Qe,interpolate:function(e,t,r){return{l:Oe(e.l,t.l,r),a:Oe(e.a,t.a,r),b:Oe(e.b,t.b,r),alpha:Oe(e.alpha,t.alpha,r)}}},rt={forward:function(e){const{l:t,a:r,b:n}=He(e),i=Math.atan2(n,r)*Ge;return{h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Ze,r=e.c;return Qe({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:et(e.h,t.h,r),c:Oe(e.c,t.c,r),l:Oe(e.l,t.l,r),alpha:Oe(e.alpha,t.alpha,r)}}};var nt=Object.freeze({__proto__:null,lab:tt,hcl:rt});class Interpolate{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,n){let i=0;if("exponential"===e.name)i=it(t,e.base,r,n);else if("linear"===e.name)i=it(t,1,r,n);else if("cubic-bezier"===e.name){const s=e.controlPoints;i=new Fe(s[0],s[1],s[2],s[3]).solve(it(t,1,r,n))}return i}static parse(e,t){let[r,n,i,...s]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,R),!i)return null;const o=[];let a=null;"interpolate-hcl"===r||"interpolate-lab"===r?a=q:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<s.length;e+=2){const r=s[e],n=s[e+1],i=e+3,l=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const u=t.parse(n,l,a);if(!u)return null;a=a||u.type,o.push([r,u])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Interpolate(a,r,n,i,o):t.error(`Type ${X(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);const s=Ve(t,n),o=Interpolate.interpolationFactor(this.interpolation,n,t[s],t[s+1]),a=r[s].evaluate(e),l=r[s+1].evaluate(e);return"interpolate"===this.operator?je[this.type.kind.toLowerCase()](a,l,o):"interpolate-hcl"===this.operator?rt.reverse(rt.interpolate(rt.forward(a),rt.forward(l),o)):tt.reverse(tt.interpolate(tt.forward(a),tt.forward(l),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function it(e,t,r,n){const i=n-r,s=e-r;return 0===i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}var st=Interpolate;class Coalesce{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const n of e.slice(1)){const e=t.parse(n,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}const s=n&&i.some((e=>W(n,e.type)));return new Coalesce(s?U:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(e),r&&r instanceof ResolvedImage&&!r.available&&(t||(t=r),r=null,n===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var ot=Coalesce;class Let{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let n=1;n<e.length-1;n+=2){const i=e[n];if("string"!=typeof i)return t.error(`Expected string, but found ${typeof i} instead.`,n);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const s=t.parse(e[n+1],n+1);if(!s)return null;r.push([i,s])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return n?new Let(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}var at=Let;class At{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,R),n=t.parse(e[2],2,G(t.expectedType||U));return r&&n?new At(n.type.itemType,r,n):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new ie(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new ie(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new ie(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var lt=At;class In{constructor(e,t){this.type=j,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,U),n=t.parse(e[2],2,U);return r&&n?J(r.type,[j,O,R,F,U])?new In(r,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!H(t,["boolean","string","number","null"]))throw new ie(`Expected first argument to be of type boolean, string, number or null, but found ${X(te(t))} instead.`);if(!H(r,["string","array"]))throw new ie(`Expected second argument to be of type array or string, but found ${X(te(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ut=In;class IndexOf{constructor(e,t,r){this.type=R,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,U),n=t.parse(e[2],2,U);if(!r||!n)return null;if(!J(r.type,[j,O,R,F,U]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,R);return i?new IndexOf(r,n,i):null}return new IndexOf(r,n)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!H(t,["boolean","string","number","null"]))throw new ie(`Expected first argument to be of type boolean, string, number or null, but found ${X(te(t))} instead.`);if(!H(r,["string","array"]))throw new ie(`Expected second argument to be of type array or string, but found ${X(te(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(t,n)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ct=IndexOf;class Match{constructor(e,t,r,n,i,s){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=s}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i={},s=[];for(let o=2;o<e.length-1;o+=2){let a=e[o];const l=e[o+1];Array.isArray(a)||(a=[a]);const u=t.concat(o);if(0===a.length)return u.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,te(e)))return null}else r=te(e);if(void 0!==i[String(e)])return u.error("Branch labels must be unique.");i[String(e)]=s.length}const c=t.parse(l,o,n);if(!c)return null;n=n||c.type,s.push(c)}const o=t.parse(e[1],1,U);if(!o)return null;const a=t.parse(e[e.length-1],e.length-1,n);return a?"value"!==o.type.kind&&t.concat(1).checkSubtype(r,o.type)?null:new Match(r,n,o,i,s,a):null}evaluate(e){const t=this.input.evaluate(e);return(te(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=r.length,r.push([this.cases[e],[e]])):r[t][1].push(e)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of r)e.push(1===n.length?i(n[0]):n.map(i)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var ht=Match;class Case{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n=[];for(let i=1;i<e.length-1;i+=2){const s=t.parse(e[i],i,j);if(!s)return null;const o=t.parse(e[i+1],i+1,r);if(!o)return null;n.push([s,o]),r=r||o.type}const i=t.parse(e[e.length-1],e.length-1,r);return i?new Case(r,n,i):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var pt=Case;class Slice{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,U),n=t.parse(e[2],2,R);if(!r||!n)return null;if(!J(r.type,[G(U),O,U]))return t.error(`Expected first argument to be of type array or string, but found ${X(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,R);return i?new Slice(r.type,r,n,i):null}return new Slice(r.type,r,n)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!H(t,["string","array"]))throw new ie(`Expected first argument to be of type array or string, but found ${X(te(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(r,n)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var dt=Slice;function ft(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function yt(e,t,r,n){return 0===n.compare(t,r)}function mt(e,t,r){const n="=="!==e&&"!="!==e;return class Comparison{constructor(e,t,r){this.type=j,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let i=t.parse(e[1],1,U);if(!i)return null;if(!ft(r,i.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${X(i.type)}'.`);let s=t.parse(e[2],2,U);if(!s)return null;if(!ft(r,s.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${X(s.type)}'.`);if(i.type.kind!==s.type.kind&&"value"!==i.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${X(i.type)}' and '${X(s.type)}'.`);n&&("value"===i.type.kind&&"value"!==s.type.kind?i=new oe(s.type,[i]):"value"!==i.type.kind&&"value"===s.type.kind&&(s=new oe(i.type,[s])));let o=null;if(4===e.length){if("string"!==i.type.kind&&"string"!==s.type.kind&&"value"!==i.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(o=t.parse(e[3],3,N),!o)return null}return new Comparison(i,s,o)}evaluate(i){const s=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const t=te(s),r=te(o);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new ie(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=te(s),r=te(o);if("string"!==e.kind||"string"!==r.kind)return t(i,s,o)}return this.collator?r(i,s,o,this.collator.evaluate(i)):t(i,s,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const gt=mt("==",(function(e,t,r){return t===r}),yt),xt=mt("!=",(function(e,t,r){return t!==r}),(function(e,t,r,n){return!yt(0,t,r,n)})),vt=mt("<",(function(e,t,r){return t<r}),(function(e,t,r,n){return n.compare(t,r)<0})),bt=mt(">",(function(e,t,r){return t>r}),(function(e,t,r,n){return n.compare(t,r)>0})),wt=mt("<=",(function(e,t,r){return t<=r}),(function(e,t,r,n){return n.compare(t,r)<=0})),_t=mt(">=",(function(e,t,r){return t>=r}),(function(e,t,r,n){return n.compare(t,r)>=0}));class NumberFormat{constructor(e,t,r,n,i){this.type=O,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,R);if(!r)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=t.parse(n.locale,1,O),!i))return null;let s=null;if(n.currency&&(s=t.parse(n.currency,1,O),!s))return null;let o=null;if(n["min-fraction-digits"]&&(o=t.parse(n["min-fraction-digits"],1,R),!o))return null;let a=null;return n["max-fraction-digits"]&&(a=t.parse(n["max-fraction-digits"],1,R),!a)?null:new NumberFormat(r,i,s,o,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Length{constructor(e){this.type=R,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${X(r.type)} instead.`):new Length(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new ie(`Expected value to be of type string or array, but found ${X(te(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const St={"==":gt,"!=":xt,">":bt,"<":vt,">=":_t,"<=":wt,array:oe,at:lt,boolean:oe,case:pt,coalesce:ot,collator:CollatorExpression,format:FormatExpression,image:ImageExpression,in:ut,"index-of":ct,interpolate:st,"interpolate-hcl":st,"interpolate-lab":st,length:Length,let:at,literal:ne,match:ht,number:oe,"number-format":NumberFormat,object:oe,slice:dt,step:Le,string:oe,"to-boolean":le,"to-color":le,"to-number":le,"to-string":le,var:De,within:Te};function kt(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const s=i?i.evaluate(e):1,o=Q(t,r,n,s);if(o)throw new ie(o);return new z(t/255*s,r/255*s,n/255*s,s)}function It(e,t){return e in t}function Pt(e,t){const r=t[e];return void 0===r?null:r}function Tt(e){return{type:e}}he.register(St,{error:[{kind:"error"},[O],(e,[t])=>{throw new ie(t.evaluate(e))}],typeof:[O,[U],(e,[t])=>X(te(t.evaluate(e)))],"to-rgba":[G(R,4),[q],(e,[t])=>t.evaluate(e).toArray()],rgb:[q,[R,R,R],kt],rgba:[q,[R,R,R,R],kt],has:{type:j,overloads:[[[O],(e,[t])=>It(t.evaluate(e),e.properties())],[[O,$],(e,[t,r])=>It(t.evaluate(e),r.evaluate(e))]]},get:{type:U,overloads:[[[O],(e,[t])=>Pt(t.evaluate(e),e.properties())],[[O,$],(e,[t,r])=>Pt(t.evaluate(e),r.evaluate(e))]]},"feature-state":[U,[O],(e,[t])=>Pt(t.evaluate(e),e.featureState||{})],properties:[$,[],e=>e.properties()],"geometry-type":[O,[],e=>e.geometryType()],id:[U,[],e=>e.id()],zoom:[R,[],e=>e.globals.zoom],pitch:[R,[],e=>e.globals.pitch||0],"distance-from-center":[R,[],e=>e.distanceFromCenter()],"heatmap-density":[R,[],e=>e.globals.heatmapDensity||0],"line-progress":[R,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[R,[],e=>e.globals.skyRadialProgress||0],accumulated:[U,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[R,Tt(R),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[R,Tt(R),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:R,overloads:[[[R,R],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[R],(e,[t])=>-t.evaluate(e)]]},"/":[R,[R,R],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[R,[R,R],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[R,[],()=>Math.LN2],pi:[R,[],()=>Math.PI],e:[R,[],()=>Math.E],"^":[R,[R,R],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[R,[R],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[R,[R],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[R,[R],(e,[t])=>Math.log(t.evaluate(e))],log2:[R,[R],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[R,[R],(e,[t])=>Math.sin(t.evaluate(e))],cos:[R,[R],(e,[t])=>Math.cos(t.evaluate(e))],tan:[R,[R],(e,[t])=>Math.tan(t.evaluate(e))],asin:[R,[R],(e,[t])=>Math.asin(t.evaluate(e))],acos:[R,[R],(e,[t])=>Math.acos(t.evaluate(e))],atan:[R,[R],(e,[t])=>Math.atan(t.evaluate(e))],min:[R,Tt(R),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[R,Tt(R),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[R,[R],(e,[t])=>Math.abs(t.evaluate(e))],round:[R,[R],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[R,[R],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[R,[R],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[j,[O,U],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[j,[U],(e,[t])=>e.id()===t.value],"filter-type-==":[j,[O],(e,[t])=>e.geometryType()===t.value],"filter-<":[j,[O,U],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<i}],"filter-id-<":[j,[U],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<n}],"filter->":[j,[O,U],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>i}],"filter-id->":[j,[U],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>n}],"filter-<=":[j,[O,U],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[j,[U],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<=n}],"filter->=":[j,[O,U],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[j,[U],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>=n}],"filter-has":[j,[U],(e,[t])=>t.value in e.properties()],"filter-has-id":[j,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[j,[G(O)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[j,[G(U)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[j,[O,G(U)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[j,[O,G(U)],(e,[t,r])=>function(e,t,r,n){for(;r<=n;){const i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:j,overloads:[[[j,j],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[Tt(j),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:j,overloads:[[[j,j],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[Tt(j),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[j,[j],(e,[t])=>!t.evaluate(e)],"is-supported-script":[j,[O],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[O,[O],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[O,[O],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[O,Tt(U),(e,t)=>t.map((t=>re(t.evaluate(e)))).join("")],"resolved-locale":[O,[N],(e,[t])=>t.evaluate(e).resolvedLocale()]});var Ct=St;function Et(e){return{result:"success",value:e}}function Mt(e){return{result:"error",value:e}}function Dt(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function zt(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Bt(e){return!!e.expression&&e.expression.interpolated}function Vt(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Lt(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Ft(e){return e}function Rt(e,t){const r="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],i=n||!(n||void 0!==e.property),s=e.type||(Bt(t)?"exponential":"interval");if(r&&((e=B({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],z.parse(e[1])]))),e.default=z.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!nt[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let o,a,l;if("exponential"===s)o=$t;else if("interval"===s)o=qt;else if("categorical"===s){o=jt,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);o=Ut}if(n){const r={},n=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],s=i[0].zoom;void 0===r[s]&&(r[s]={zoom:s,type:e.type,property:e.property,default:e.default,stops:[]},n.push(s)),r[s].stops.push([i[0].value,i[1]])}const i=[];for(const e of n)i.push([r[e].zoom,Rt(r[e],t)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:st.interpolationFactor.bind(void 0,s),zoomStops:i.map((e=>e[0])),evaluate:({zoom:r},n)=>$t({stops:i,base:e.base},t,r).evaluate(r,n)}}if(i){const r="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:st.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:r})=>o(e,t,r,a,l)}}return{kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[e.property]:void 0;return void 0===i?Ot(e.default,t.default):o(e,t,i,a,l)}}}function Ot(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function jt(e,t,r,n,i){return Ot(typeof r===i?n[r]:void 0,e.default,t.default)}function qt(e,t,r){if("number"!==Vt(r))return Ot(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const i=Ve(e.stops.map((e=>e[0])),r);return e.stops[i][1]}function $t(e,t,r){const n=void 0!==e.base?e.base:1;if("number"!==Vt(r))return Ot(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const s=Ve(e.stops.map((e=>e[0])),r),o=function(e,t,r,n){const i=n-r,s=e-r;return 0===i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}(r,n,e.stops[s][0],e.stops[s+1][0]),a=e.stops[s][1],l=e.stops[s+1][1];let u=je[t.type]||Ft;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=nt[e.colorSpace];u=(e,r)=>t.reverse(t.interpolate(t.forward(e),t.forward(r),o))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==r)return u(t,r,o)}}:u(a,l,o)}function Ut(e,t,r){return"color"===t.type?r=z.parse(r):"formatted"===t.type?r=Formatted.fromString(r.toString()):"resolvedImage"===t.type?r=ResolvedImage.fromString(r.toString()):Vt(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),Ot(r,e.default,t.default)}class StyleExpression{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ce,this._defaultValue=t?function(e){return"color"===e.type&&(Lt(e.default)||Array.isArray(e.default))?new z(0,0,0,0):"color"===e.type?z.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,n,i,s,o,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,s,o,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new ie(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Nt(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Ct}function Kt(e,t){const r=new ze(Ct,[],t?function(e){const t={color:q,string:O,number:R,enum:O,boolean:j,formatted:K,resolvedImage:Z};return"array"===e.type?G(t[e.value]||U,e.length):t[e.type]}(t):void 0),n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?Et(new StyleExpression(n,t)):Mt(r.errors)}class ZoomConstantExpression{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Ee(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}}class ZoomDependentExpression{constructor(e,t,r,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Ee(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}interpolationFactor(e,t,r){return this.interpolationType?st.interpolationFactor(this.interpolationType,e,t,r):0}}function Zt(e,t){if("error"===(e=Kt(e,t)).result)return e;const r=e.value.expression,n=Ce(r);if(!n&&!Dt(t))return Mt([new V("","data expressions not supported")]);const i=Me(r,["zoom","pitch","distance-from-center"]);if(!i&&!zt(t))return Mt([new V("","zoom expressions not supported")]);const s=Gt(r);return s||i?s instanceof V?Mt([s]):s instanceof st&&!Bt(t)?Mt([new V("",'"interpolate" expressions cannot be used with this property')]):Et(s?new ZoomDependentExpression(n?"camera":"composite",e.value,s.labels,s instanceof st?s.interpolation:void 0):new ZoomConstantExpression(n?"constant":"source",e.value)):Mt([new V("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class StylePropertyFunction{constructor(e,t){this._parameters=e,this._specification=t,B(this,Rt(this._parameters,this._specification))}static deserialize(e){return new StylePropertyFunction(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Gt(e){let t=null;if(e instanceof at)t=Gt(e.result);else if(e instanceof ot){for(const r of e.args)if(t=Gt(r),t)break}else(e instanceof Le||e instanceof st)&&e.input instanceof he&&"zoom"===e.input.name&&(t=e);return t instanceof V||e.eachChild((e=>{const r=Gt(e);r instanceof V?t=r:!t&&r?t=new V("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&r&&t!==r&&(t=new V("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}let Xt;const Yt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Xt){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Xt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){Xt=e}}return Xt},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Wt={supported:!1,testSupport:function(e){!Qt&&Ht&&(er?tr(e):Jt=e)}};let Jt,Ht,Qt=!1,er=!1;function tr(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ht),e.isContextLost())return;Wt.supported=!0}catch(e){}e.deleteTexture(t),Qt=!0}r.document&&(Ht=r.document.createElement("img"),Ht.onload=function(){Jt&&tr(Jt),Jt=null,er=!0},Ht.onerror=function(){Qt=!0,Jt=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const rr="NO_ACCESS_TOKEN";function nr(e){return Yt.API_URL_REGEX.test(e)}function ir(e){return e.indexOf("sku=")>0&&nr(e)}const sr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function or(e){const t=e.match(sr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ar(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function lr(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(r.atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class TelemetryEvent{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=lr(Yt.ACCESS_TOKEN);let n="";return n=t&&t.u?r.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=P("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=r.localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const i=r.localStorage.getItem(n);i&&(this.anonId=i)}catch(e){b("Unable to read from LocalStorage")}}saveEventData(){const e=P("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{r.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&r.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){b("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,r,n){if(!Yt.EVENTS_URL)return;const i=or(Yt.EVENTS_URL);i.params.push(`access_token=${n||Yt.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.9.1",skuId:"01",userId:this.anonId},o=t?h(s,t):s,a={url:ar(i),headers:{"Content-Type":"text/plain"},body:JSON.stringify([o])};this.pendingRequest=_o(a,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const ur=new class TurnstileEvent extends TelemetryEvent{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){Yt.EVENTS_URL&&Yt.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>function(e){return 0===e.indexOf("mapbox:")}(e)||nr(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=lr(Yt.ACCESS_TOKEN),r=t?t.u:Yt.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;f(this.anonId)||(this.anonId=d(),n=!0);const i=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(i),r=(i-this.eventData.lastSuccess)/864e5;n=n||r>=1||r<-1||e.getDate()!==t.getDate()}else n=!0;n?this.postEvent(i,{"enabled.telemetry":!1},(e=>{e||(this.eventData.lastSuccess=i,this.eventData.tokenU=r)}),e):this.processRequests()}};ur.postTurnstileEvent.bind(ur);const cr=new class MapLoadEvent extends TelemetryEvent{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,n){this.skuToken=t,this.errorCb=n,Yt.EVENTS_URL&&(r||Yt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(rr)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),f(this.anonId)||(this.anonId=d()),this.postEvent(r,{skuToken:this.skuToken},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}};cr.postMapLoadEvent.bind(cr);const hr=new class MapSessionAPI extends TelemetryEvent{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,n){const i=or(Yt.API_URL+Yt.SESSION_PATH);i.params.push(`sku=${t||""}`),i.params.push(`access_token=${n||Yt.ACCESS_TOKEN||""}`);const s={url:ar(i),headers:{"Content-Type":"text/plain"}};this.pendingRequest=So(s,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,r,n){this.skuToken=t,this.errorCb=n,r||Yt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(rr))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}};hr.getSessionAPI.bind(hr);let pr,dr={};function fr(e){const t=gr(e);let r,n;t&&t.forEach((e=>{const t=e.split("=");"language"===t[0]?r=t[1]:"worldview"===t[0]&&(n=t[1])}));let i="mapbox-tiles";return r&&(i+=`-${r}`),n&&(i+=`-${n}`),i}function yr(e){r.caches&&!dr[e]&&(dr[e]=r.caches.open(e))}function mr(e,t,n){const i=fr(e.url);if(yr(i),!dr[i])return;const s={status:t.status,statusText:t.statusText,headers:new r.Headers};t.headers.forEach(((e,t)=>s.headers.set(t,e)));const o=A(t.headers.get("Cache-Control")||"");if(o["no-store"])return;o["max-age"]&&s.headers.set("Expires",new Date(n+1e3*o["max-age"]).toUTCString());const a=s.headers.get("Expires");a&&(new Date(a).getTime()-n<42e4||function(e,t){if(void 0===pr)try{new Response(new ReadableStream),pr=!0}catch(e){pr=!1}pr?t(e.body):e.blob().then(t)}(t,(t=>{const n=new r.Response(t,s);yr(i),dr[i]&&dr[i].then((t=>t.put(xr(e.url),n))).catch((e=>b(e.message)))})))}function gr(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}function xr(e){const t=e.indexOf("?");if(t<0)return e;const r=gr(e).filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return r.length?`${e.slice(0,t)}?${r.join("&")}`:e.slice(0,t)}function vr(e,t){const r=fr(e.url);if(yr(r),!dr[r])return t(null);const n=xr(e.url);dr[r].then((e=>{e.match(n).then((r=>{const i=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),r=A(e.headers.get("Cache-Control")||"");return t>Date.now()&&!r["no-cache"]}(r);e.delete(n),i&&e.put(n,r.clone()),t(null,r,i)})).catch(t)})).catch(t)}const br="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,wr=Object.keys,_r=Array.isArray;function Sr(e,t){return"object"!=typeof t||wr(t).forEach((function(r){e[r]=t[r]})),e}"undefined"==typeof Promise||br.Promise||(br.Promise=Promise);const Ar=Object.getPrototypeOf,kr={}.hasOwnProperty;function Ir(e,t){return kr.call(e,t)}function Pr(e,t){"function"==typeof t&&(t=t(Ar(e))),("undefined"==typeof Reflect?wr:Reflect.ownKeys)(t).forEach((r=>{Cr(e,r,t[r])}))}const Tr=Object.defineProperty;function Cr(e,t,r,n){Tr(e,t,Sr(r&&Ir(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function Er(e){return{from:function(t){return e.prototype=Object.create(t.prototype),Cr(e.prototype,"constructor",e),{extend:Pr.bind(null,e.prototype)}}}}const Mr=Object.getOwnPropertyDescriptor;function Dr(e,t){let r;return Mr(e,t)||(r=Ar(e))&&Dr(r,t)}const zr=[].slice;function Br(e,t,r){return zr.call(e,t,r)}function Vr(e,t){return t(e)}function Lr(e){if(!e)throw new Error("Assertion Failed")}function Fr(e){br.setImmediate?setImmediate(e):setTimeout(e,0)}function Rr(e,t){return e.reduce(((e,r,n)=>{var i=t(r,n);return i&&(e[i[0]]=i[1]),e}),{})}function Or(e,t){if(Ir(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,i=t.length;n<i;++n){var s=Or(e,t[n]);r.push(s)}return r}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:Or(a,t.substr(o+1))}}function jr(e,t,r){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){Lr("string"!=typeof r&&"length"in r);for(var n=0,i=t.length;n<i;++n)jr(e,t[n],r[n])}else{var s=t.indexOf(".");if(-1!==s){var o=t.substr(0,s),a=t.substr(s+1);if(""===a)void 0===r?_r(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=r;else{var l=e[o];l&&Ir(e,o)||(l=e[o]={}),jr(l,a,r)}}else void 0===r?_r(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function qr(e){var t={};for(var r in e)Ir(e,r)&&(t[r]=e[r]);return t}const $r=[].concat;function Ur(e){return $r.apply([],e)}const Nr="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ur([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>br[e])),Kr=Nr.map((e=>br[e]));Rr(Nr,(e=>[e,!0]));let Zr=null;function Gr(e){Zr="undefined"!=typeof WeakMap&&new WeakMap;const t=Xr(e);return Zr=null,t}function Xr(e){if(!e||"object"!=typeof e)return e;let t=Zr&&Zr.get(e);if(t)return t;if(_r(e)){t=[],Zr&&Zr.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(Xr(e[r]))}else if(Kr.indexOf(e.constructor)>=0)t=e;else{const r=Ar(e);for(var i in t=r===Object.prototype?{}:Object.create(r),Zr&&Zr.set(e,t),e)Ir(e,i)&&(t[i]=Xr(e[i]))}return t}const{toString:Yr}={};function Wr(e){return Yr.call(e).slice(8,-1)}const Jr="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",Hr="symbol"==typeof Jr?function(e){var t;return null!=e&&(t=e[Jr])&&t.apply(e)}:function(){return null},Qr={};function en(e){var t,r,n,i;if(1===arguments.length){if(_r(e))return e.slice();if(this===Qr&&"string"==typeof e)return[e];if(i=Hr(e)){for(r=[];!(n=i.next()).done;)r.push(n.value);return r}if(null==e)return[e];if("number"==typeof(t=e.length)){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const tn="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var rn="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function nn(e,t){rn=e,sn=t}var sn=()=>!0;const on=!new Error("").stack;function an(){if(on)try{throw new Error}catch(e){return e}return new Error}function ln(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(sn).map((e=>"\n"+e)).join("")):""}var un=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],cn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(un),hn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function pn(e,t){this._e=an(),this.name=e,this.message=t}function dn(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,r)=>r.indexOf(e)===t)).join("\n")}function fn(e,t,r,n){this._e=an(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=dn(e,t)}function yn(e,t){this._e=an(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=dn(e,t)}Er(pn).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+ln(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Er(fn).from(pn),Er(yn).from(pn);var mn=cn.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const gn=pn;var xn=cn.reduce(((e,t)=>{var r=t+"Error";function n(e,n){this._e=an(),this.name=r,e?"string"==typeof e?(this.message=`${e}${n?"\n "+n:""}`,this.inner=n||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=hn[t]||r,this.inner=null)}return Er(n).from(gn),e[t]=n,e}),{});xn.Syntax=SyntaxError,xn.Type=TypeError,xn.Range=RangeError;var vn=un.reduce(((e,t)=>(e[t+"Error"]=xn[t],e)),{}),bn=cn.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=xn[t]),e)),{});function wn(){}function _n(e){return e}function Sn(e,t){return null==e||e===_n?t:function(r){return t(e(r))}}function An(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function kn(e,t){return e===wn?t:function(){var r=e.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?An(n,this.onsuccess):n),i&&(this.onerror=this.onerror?An(i,this.onerror):i),void 0!==s?s:r}}function Pn(e,t){return e===wn?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?An(r,this.onsuccess):r),n&&(this.onerror=this.onerror?An(n,this.onerror):n)}}function Tn(e,t){return e===wn?t:function(r){var n=e.apply(this,arguments);Sr(r,n);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?An(i,this.onsuccess):i),s&&(this.onerror=this.onerror?An(s,this.onerror):s),void 0===n?void 0===o?void 0:o:Sr(n,o)}}function Cn(e,t){return e===wn?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function En(e,t){return e===wn?t:function(){var r=e.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return r.then((function(){return t.apply(n,s)}))}return t.apply(this,arguments)}}bn.ModifyError=fn,bn.DexieError=pn,bn.BulkError=yn;var Mn={};const[Dn,zn,Bn]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,Ar(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Ar(t),e]})(),Vn=zn&&zn.then,Ln=Dn&&Dn.constructor,Fn=!!Bn;var Rn=!1,On=Bn?()=>{Bn.then(li)}:br.setImmediate?setImmediate.bind(null,li):br.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{li(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(li,0)},jn=function(e,t){Yn.push([e,t]),$n&&(On(),$n=!1)},qn=!0,$n=!0,Un=[],Nn=[],Kn=null,Zn=_n,Gn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:zi,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{zi(e[0],e[1])}catch(e){}}))}},Xn=Gn,Yn=[],Wn=0,Jn=[];function Hn(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=wn,this._lib=!1;var t=this._PSD=Xn;if(rn&&(this._stackHolder=an(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==Mn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&ri(this,this._value))}this._state=null,this._value=null,++t.ref,ti(this,e)}const Qn={get:function(){var e=Xn,t=xi;function r(r,n){var i=!e.global&&(e!==Xn||t!==xi);const s=i&&!_i();var o=new Hn(((t,o)=>{ii(this,new ei(Ei(r,e,i,s),Ei(n,e,i,s),t,o,e))}));return rn&&ai(o,this),o}return r.prototype=Mn,r},set:function(e){Cr(this,"then",e&&e.prototype===Mn?Qn:{get:function(){return e},set:Qn.set})}};function ei(e,t,r,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=i}function ti(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&ui();t&&"function"==typeof t.then?ti(e,((e,r)=>{t instanceof Hn?t._then(e,r):t.then(e,r)})):(e._state=!0,e._value=t,ni(e)),r&&ci()}}),ri.bind(null,e))}catch(t){ri(e,t)}}function ri(e,t){if(Nn.push(t),null===e._state){var r=e._lib&&ui();t=Zn(t),e._state=!1,e._value=t,rn&&null!==t&&"object"==typeof t&&!t._promise&&function(r,n,i){try{(()=>{var r=Dr(t,"stack");t._promise=e,Cr(t,"stack",{get:()=>Rn?r&&(r.get?r.get.apply(t):r.value):e.stack})}).apply(null,void 0)}catch(e){}}(),function(e){Un.some((t=>t._value===e._value))||Un.push(e)}(e),ni(e),r&&ci()}}function ni(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)ii(e,t[r]);var i=e._PSD;--i.ref||i.finalize(),0===Wn&&(++Wn,jn((()=>{0==--Wn&&hi()}),[]))}function ii(e,t){if(null!==e._state){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Wn,jn(si,[r,e,t])}else e._listeners.push(t)}function si(e,t,r){try{Kn=t;var n,i=t._value;t._state?n=e(i):(Nn.length&&(Nn=[]),n=e(i),-1===Nn.indexOf(i)&&function(e){for(var t=Un.length;t;)if(Un[--t]._value===e._value)return void Un.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{Kn=null,0==--Wn&&hi(),--r.psd.ref||r.psd.finalize()}}function oi(e,t,r){if(t.length===r)return t;var n="";if(!1===e._state){var i,s,o=e._value;null!=o?(i=o.name||"Error",s=o.message||o,n=ln(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+n)}return rn&&((n=ln(e._stackHolder,2))&&-1===t.indexOf(n)&&t.push(n),e._prev&&oi(e._prev,t,r)),t}function ai(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function li(){ui()&&ci()}function ui(){var e=qn;return qn=!1,$n=!1,e}function ci(){var e,t,r;do{for(;Yn.length>0;)for(e=Yn,Yn=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(Yn.length>0);qn=!0,$n=!0}function hi(){var e=Un;Un=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Jn.slice(0),r=t.length;r;)t[--r]()}function pi(e){return new Hn(Mn,!1,e)}function di(e,t){var r=Xn;return function(){var n=ui(),i=Xn;try{return Ii(r,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{Ii(i,!1),n&&ci()}}}Pr(Hn.prototype,{then:Qn,_then:function(e,t){ii(this,new ei(null,null,e,t,Xn))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],r=arguments[1];return this.then(null,"function"==typeof t?e=>e instanceof t?r(e):pi(e):e=>e&&e.name===t?r(e):pi(e))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),pi(t))))},stack:{get:function(){if(this._stack)return this._stack;try{Rn=!0;var e=oi(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{Rn=!1}}},timeout:function(e,t){return e<1/0?new Hn(((r,n)=>{var i=setTimeout((()=>n(new xn.Timeout(t))),e);this.then(r,n).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&Cr(Hn.prototype,Symbol.toStringTag,"Dexie.Promise"),Gn.env=Pi(),Pr(Hn,{all:function(){var e=en.apply(null,arguments).map(Si);return new Hn((function(t,r){0===e.length&&t([]);var n=e.length;e.forEach(((i,s)=>Hn.resolve(i).then((r=>{e[s]=r,--n||t(e)}),r)))}))},resolve:e=>{if(e instanceof Hn)return e;if(e&&"function"==typeof e.then)return new Hn(((t,r)=>{e.then(t,r)}));var t=new Hn(Mn,!0,e);return ai(t,Kn),t},reject:pi,race:function(){var e=en.apply(null,arguments).map(Si);return new Hn(((t,r)=>{e.map((e=>Hn.resolve(e).then(t,r)))}))},PSD:{get:()=>Xn,set:e=>Xn=e},totalEchoes:{get:()=>xi},newPSD:bi,usePSD:Ti,scheduler:{get:()=>jn,set:e=>{jn=e}},rejectionMapper:{get:()=>Zn,set:e=>{Zn=e}},follow:(e,t)=>new Hn(((r,n)=>bi(((t,r)=>{var n=Xn;n.unhandleds=[],n.onunhandled=r,n.finalize=An((function(){!function(e){Jn.push((function t(){e(),Jn.splice(Jn.indexOf(t),1)})),++Wn,jn((()=>{0==--Wn&&hi()}),[])}((()=>{0===this.unhandleds.length?t():r(this.unhandleds[0])}))}),n.finalize),e()}),t,r,n)))}),Ln&&(Ln.allSettled&&Cr(Hn,"allSettled",(function(){const e=en.apply(null,arguments).map(Si);return new Hn((t=>{0===e.length&&t([]);let r=e.length;const n=new Array(r);e.forEach(((e,i)=>Hn.resolve(e).then((e=>n[i]={status:"fulfilled",value:e}),(e=>n[i]={status:"rejected",reason:e})).then((()=>--r||t(n)))))}))})),Ln.any&&"undefined"!=typeof AggregateError&&Cr(Hn,"any",(function(){const e=en.apply(null,arguments).map(Si);return new Hn(((t,r)=>{0===e.length&&r(new AggregateError([]));let n=e.length;const i=new Array(n);e.forEach(((e,s)=>Hn.resolve(e).then((e=>t(e)),(e=>{i[s]=e,--n||r(new AggregateError(i))}))))}))})));const fi={awaits:0,echoes:0,id:0};var yi=0,mi=[],gi=0,xi=0,vi=0;function bi(e,t,r,n){var i=Xn,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++vi;var o=Gn.env;s.env=Fn?{Promise:Hn,PromiseProp:{value:Hn,configurable:!0,writable:!0},all:Hn.all,race:Hn.race,allSettled:Hn.allSettled,any:Hn.any,resolve:Hn.resolve,reject:Hn.reject,nthen:Mi(o.nthen,s),gthen:Mi(o.gthen,s)}:{},t&&Sr(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Ti(s,e,r,n);return 0===s.ref&&s.finalize(),a}function wi(){return fi.id||(fi.id=++yi),++fi.awaits,fi.echoes+=100,fi.id}function _i(){return!!fi.awaits&&(0==--fi.awaits&&(fi.id=0),fi.echoes=100*fi.awaits,!0)}function Si(e){return fi.echoes&&e&&e.constructor===Ln?(wi(),e.then((e=>(_i(),e)),(e=>(_i(),Bi(e))))):e}function Ai(e){++xi,fi.echoes&&0!=--fi.echoes||(fi.echoes=fi.id=0),mi.push(Xn),Ii(e,!0)}function ki(){var e=mi[mi.length-1];mi.pop(),Ii(e,!1)}function Ii(e,t){var r=Xn;if((t?!fi.echoes||gi++&&e===Xn:!gi||--gi&&e===Xn)||Ci(t?Ai.bind(null,e):ki),e!==Xn&&(Xn=e,r===Gn&&(Gn.env=Pi()),Fn)){var n=Gn.env.Promise,i=e.env;zn.then=i.nthen,n.prototype.then=i.gthen,(r.global||e.global)&&(Object.defineProperty(br,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function Pi(){var e=br.Promise;return Fn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(br,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:zn.then,gthen:e.prototype.then}:{}}function Ti(e,t,r,n,i){var s=Xn;try{return Ii(e,!0),t(r,n,i)}finally{Ii(s,!1)}}function Ci(e){Vn.call(Dn,e)}function Ei(e,t,r,n){return"function"!=typeof e?e:function(){var i=Xn;r&&wi(),Ii(t,!0);try{return e.apply(this,arguments)}finally{Ii(i,!1),n&&Ci(_i)}}}function Mi(e,t){return function(r,n){return e.call(this,Ei(r,t),Ei(n,t))}}-1===(""+Vn).indexOf("[native code]")&&(wi=_i=wn);const Di="unhandledrejection";function zi(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var n,i={promise:t,reason:e};if(br.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(Di,!0,!0),Sr(n,i)):br.CustomEvent&&Sr(n=new CustomEvent(Di,{detail:i}),i),n&&br.dispatchEvent&&(dispatchEvent(n),!br.PromiseRejectionEvent&&br.onunhandledrejection))try{br.onunhandledrejection(n)}catch(e){}rn&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}var Bi=Hn.reject;function Vi(e,t,r,n){if(e.idbdb&&(e._state.openComplete||Xn.letThrough||e._vip)){var i=e._createTransaction(t,r,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===mn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Vi(e,t,r,n)))):Bi(i)}return i._promise(t,((e,t)=>bi((()=>(Xn.trans=i,n(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return Bi(new xn.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return Bi(new xn.DatabaseClosed);e.open().catch(wn)}return e._state.dbReadyPromise.then((()=>Vi(e,t,r,n)))}const Li="3.2.2",Fi=String.fromCharCode(65535),Ri=-1/0,Oi="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ji="String expected.",qi=[],$i="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ui=$i,Ni=$i,Ki=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),Zi="__dbnames",Gi="readonly",Xi="readwrite";function Yi(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Wi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ji(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=Gr(t))[e],t)}class Table{_trans(e,t,r){const n=this._tx||Xn.trans,i=this.name;function s(e,r,n){if(!n.schema[i])throw new xn.NotFound("Table "+i+" not part of transaction");return t(n.idbtrans,n)}const o=ui();try{return n&&n.db===this.db?n===Xn.trans?n._promise(e,s,r):bi((()=>n._promise(e,s,r)),{trans:n,transless:Xn.transless||Xn}):Vi(this.db,e,[this.name],s)}finally{o&&ci()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(_r(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=wr(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(r&&this.db._maxKey!==Fi)return this.where(r.name).equals(r.keyPath.map((t=>e[t])));!r&&rn&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:n}=this.schema,i=this.db._deps.indexedDB;function s(e,t){try{return 0===i.cmp(e,t)}catch(e){return!1}}const[o,a]=t.reduce((([t,r],i)=>{const o=n[i],a=e[i];return[t||o,t||!o?Yi(r,o&&o.multi?e=>{const t=Or(e,i);return _r(t)&&t.some((e=>s(a,e)))}:e=>s(a,Or(e,i))):r]}),[null,null]);return o?this.where(o.name).equals(e[o.keyPath]).filter(a):r?this.filter(a):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,_r(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const r=Object.create(e.prototype);for(var n in t)if(Ir(t,n))try{r[n]=t[n]}catch(e){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){Sr(this,e)}))}add(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let i=e;return n&&r&&(i=Ji(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[i]}))).then((e=>e.numFailures?Hn.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{jr(e,n,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||_r(e))return this.where(":id").equals(e).modify(t);{const r=Or(e,this.schema.primKey.keyPath);if(void 0===r)return Bi(new xn.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?wr(t).forEach((r=>{jr(e,r,t[r])})):t(e,{value:e,primKey:r})}catch(e){}return this.where(":id").equals(r).modify(t)}}put(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let i=e;return n&&r&&(i=Ji(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[i],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Hn.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{jr(e,n,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Hn.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:Wi}))).then((e=>e.numFailures?Hn.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,r){const n=Array.isArray(t)?t:void 0,i=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:s}=this.schema.primKey;if(s&&n)throw new xn.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new xn.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&r?e.map(Ji(s)):e;return this.core.mutate({trans:t,type:"add",keys:n,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return i?t:r;throw new yn(`${this.name}.bulkAdd(): ${e} of ${o} operations failed`,n)}))}))}bulkPut(e,t,r){const n=Array.isArray(t)?t:void 0,i=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:s}=this.schema.primKey;if(s&&n)throw new xn.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new xn.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&r?e.map(Ji(s)):e;return this.core.mutate({trans:t,type:"put",keys:n,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return i?t:r;throw new yn(`${this.name}.bulkPut(): ${e} of ${o} operations failed`,n)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:r,failures:n})=>{if(0===e)return r;throw new yn(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,n)}))}}function Hi(e){var t={},r=function(r,n){if(n){for(var i=arguments.length,s=new Array(i-1);--i;)s[i-1]=arguments[i];return t[r].subscribe.apply(null,s),e}if("string"==typeof r)return t[r]};r.addEventType=s;for(var n=1,i=arguments.length;n<i;++n)s(arguments[n]);return r;function s(e,n,i){if("object"==typeof e)return o(e);n||(n=Cn),i||(i=wn);var s={subscribers:[],fire:i,subscribe:function(e){-1===s.subscribers.indexOf(e)&&(s.subscribers.push(e),s.fire=n(s.fire,e))},unsubscribe:function(e){s.subscribers=s.subscribers.filter((function(t){return t!==e})),s.fire=s.subscribers.reduce(n,i)}};return t[e]=r[e]=s,s}function o(e){wr(e).forEach((function(t){var r=e[t];if(_r(r))s(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new xn.InvalidArgument("Invalid event config");var n=s(t,_n,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){Fr((function(){e.apply(null,t)}))}))}))}}))}}function Qi(e,t){return Er(t).from({prototype:e}),t}function es(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function ts(e,t){e.filter=Yi(e.filter,t)}function rs(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>Yi(n(),t()):t,e.justLimit=r&&!n}function ns(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new xn.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function is(e,t,r){const n=ns(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:n,range:e.range}})}function ss(e,t,r,n){const i=e.replayFilter?Yi(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(e,r,n)=>{if(!i||i(r,n,(e=>r.stop(e)),(e=>r.fail(e)))){var o=r.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),Ir(s,a)||(s[a]=!0,t(e,r,n))}};return Promise.all([e.or._iterate(o,r),os(is(e,n,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return os(is(e,n,r),Yi(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function os(e,t,r,n){var i=di(n?(e,t,i)=>r(n(e),t,i):r);return e.then((e=>{if(e)return e.start((()=>{var r=()=>e.continue();t&&!t(e,(e=>r=e),(t=>{e.stop(t),r=wn}),(t=>{e.fail(t),r=wn}))||i(e.value,e,(e=>r=e)),r()}))}))}function as(e,t){try{const r=ls(e),n=ls(t);if(r!==n)return"Array"===r?1:"Array"===n?-1:"binary"===r?1:"binary"===n?-1:"string"===r?1:"string"===n?-1:"Date"===r?1:"Date"!==n?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const r=e.length,n=t.length,i=r<n?r:n;for(let r=0;r<i;++r)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return r===n?0:r<n?-1:1}(us(e),us(t));case"Array":return function(e,t){const r=e.length,n=t.length,i=r<n?r:n;for(let r=0;r<i;++r){const n=as(e[r],t[r]);if(0!==n)return n}return r===n?0:r<n?-1:1}(e,t)}}catch(e){}return NaN}function ls(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const r=Wr(e);return"ArrayBuffer"===r?"binary":r}function us(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Collection{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,Bi.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,Bi.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Yi(t.algorithm,e)}_iterate(e,t){return ss(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Sr(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((r=>ss(t,e,r,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,r=t.table.core;if(es(t,!0))return r.count({trans:e,query:{index:ns(t,r.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var n=0;return ss(t,(()=>(++n,!1)),e,r).then((()=>n))})).then(e)}sortBy(e,t){const r=e.split(".").reverse(),n=r[0],i=r.length-1;function s(e,t){return t?s(e[r[t]],t-1):e[n]}var o="next"===this._ctx.dir?1:-1;function a(e,t){var r=s(e,i),n=s(t,i);return r<n?-o:r>n?o:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&es(t,!0)&&t.limit>0){const{valueMapper:r}=t,n=ns(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:n,range:t.range}}).then((({result:e})=>r?e.map(r):e))}{const r=[];return ss(t,(e=>r.push(e)),e,t.table.core).then((()=>r))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,es(t)?rs(t,(()=>{var t=e;return(e,r)=>0===t||(1===t?(--t,!1):(r((()=>{e.advance(t),t=0})),!1))})):rs(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),rs(this._ctx,(()=>{var t=e;return function(e,r,n){return--t<=0&&r(n),t>=0}}),!0),this}until(e,t){return ts(this._ctx,(function(r,n,i){return!e(r.value)||(n(i),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t;return ts(this._ctx,(function(t){return e(t.value)})),(t=this._ctx).isMatch=Yi(t.isMatch,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.key,r)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.primaryKey,r)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.key)})).then((function(){return r})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&es(t,!0)&&t.limit>0)return this._read((e=>{var r=ns(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:r,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return ts(this._ctx,(function(e){var t=e.primaryKey.toString(),n=Ir(r,t);return r[t]=!0,!n})),this}modify(e){var t=this._ctx;return this._write((r=>{var n;if("function"==typeof e)n=e;else{var i=wr(e),s=i.length;n=function(t){for(var r=!1,n=0;n<s;++n){var o=i[n],a=e[o];Or(t,o)!==a&&(jr(t,o,a),r=!0)}return r}}const o=t.table.core,{outbound:a,extractKey:l}=o.schema.primaryKey,u=this.db._options.modifyChunkSize||200,c=[];let h=0;const p=[],d=(e,t)=>{const{failures:r,numFailures:n}=t;h+=e-n;for(let e of wr(r))c.push(r[e])};return this.clone().primaryKeys().then((i=>{const s=c=>{const h=Math.min(u,i.length-c);return o.getMany({trans:r,keys:i.slice(c,c+h),cache:"immutable"}).then((p=>{const f=[],y=[],m=a?[]:null,g=[];for(let e=0;e<h;++e){const t=p[e],r={value:Gr(t),primKey:i[c+e]};!1!==n.call(r,r.value,r)&&(null==r.value?g.push(i[c+e]):a||0===as(l(t),l(r.value))?(y.push(r.value),a&&m.push(i[c+e])):(g.push(i[c+e]),f.push(r.value)))}const x=es(t)&&t.limit===1/0&&("function"!=typeof e||e===cs)&&{index:t.index,range:t.range};return Promise.resolve(f.length>0&&o.mutate({trans:r,type:"add",values:f}).then((e=>{for(let t in e.failures)g.splice(parseInt(t),1);d(f.length,e)}))).then((()=>(y.length>0||x&&"object"==typeof e)&&o.mutate({trans:r,type:"put",keys:m,values:y,criteria:x,changeSpec:"function"!=typeof e&&e}).then((e=>d(y.length,e))))).then((()=>(g.length>0||x&&e===cs)&&o.mutate({trans:r,type:"delete",keys:g,criteria:x}).then((e=>d(g.length,e))))).then((()=>i.length>c+h&&s(c+u)))}))};return s(0).then((()=>{if(c.length>0)throw new fn("Error modifying one or more objects",c,h,p);return i.length}))}))}))}delete(){var e=this._ctx,t=e.range;return es(e)&&(e.isPrimKey&&!Ni||3===t.type)?this._write((r=>{const{primaryKey:n}=e.table.core.schema,i=t;return e.table.core.count({trans:r,query:{index:n,range:i}}).then((t=>e.table.core.mutate({trans:r,type:"deleteRange",range:i}).then((({failures:e,numFailures:r})=>{if(r)throw new fn("Could not delete some values",Object.keys(e).map((t=>e[t])),t-r);return t-r}))))})):this.modify(cs)}}const cs=(e,t)=>t.value=null;function hs(e,t){return e<t?-1:e===t?0:1}function ps(e,t){return e>t?-1:e===t?0:1}function ds(e,t,r){var n=e instanceof WhereClause?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function fs(e){return new e.Collection(e,(()=>xs(""))).limit(0)}function ys(e,t,r,n,i,s){for(var o=Math.min(e.length,n.length),a=-1,l=0;l<o;++l){var u=t[l];if(u!==n[l])return i(e[l],r[l])<0?e.substr(0,l)+r[l]+r.substr(l+1):i(e[l],n[l])<0?e.substr(0,l)+n[l]+r.substr(l+1):a>=0?e.substr(0,a)+t[a]+r.substr(a+1):null;i(e[l],u)<0&&(a=l)}return o<n.length&&"next"===s?e+r.substr(e.length):o<e.length&&"prev"===s?e.substr(0,r.length):a<0?null:e.substr(0,a)+n[a]+r.substr(a+1)}function ms(e,t,r,n){var i,s,o,a,l,u,c,h=r.length;if(!r.every((e=>"string"==typeof e)))return ds(e,ji);function p(e){i=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),s=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),o="next"===e?hs:ps;var t=r.map((function(e){return{lower:s(e),upper:i(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),l=t.map((function(e){return e.lower})),u=e,c="next"===e?"":n}p("next");var d=new e.Collection(e,(()=>gs(a[0],l[h-1]+n)));d._ondirectionchange=function(e){p(e)};var f=0;return d._addAlgorithm((function(e,r,n){var i=e.key;if("string"!=typeof i)return!1;var p=s(i);if(t(p,l,f))return!0;for(var d=null,y=f;y<h;++y){var m=ys(i,p,a[y],l[y],o,u);null===m&&null===d?f=y+1:(null===d||o(d,m)>0)&&(d=m)}return r(null!==d?function(){e.continue(d+c)}:n),!1})),d}function gs(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function xs(e){return{type:1,lower:e,upper:e}}class WhereClause{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,n){r=!1!==r,n=!0===n;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(r||n)&&(!r||!n)?fs(this):new this.Collection(this,(()=>gs(e,t,!r,!n)))}catch(e){return ds(this,Oi)}}equals(e){return null==e?ds(this,Oi):new this.Collection(this,(()=>xs(e)))}above(e){return null==e?ds(this,Oi):new this.Collection(this,(()=>gs(e,void 0,!0)))}aboveOrEqual(e){return null==e?ds(this,Oi):new this.Collection(this,(()=>gs(e,void 0,!1)))}below(e){return null==e?ds(this,Oi):new this.Collection(this,(()=>gs(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?ds(this,Oi):new this.Collection(this,(()=>gs(void 0,e)))}startsWith(e){return"string"!=typeof e?ds(this,ji):this.between(e,e+Fi,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):ms(this,((e,t)=>0===e.indexOf(t[0])),[e],Fi)}equalsIgnoreCase(e){return ms(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=en.apply(Qr,arguments);return 0===e.length?fs(this):ms(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=en.apply(Qr,arguments);return 0===e.length?fs(this):ms(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,Fi)}anyOf(){const e=en.apply(Qr,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return ds(this,Oi)}if(0===e.length)return fs(this);const r=new this.Collection(this,(()=>gs(e[0],e[e.length-1])));r._ondirectionchange=r=>{t="next"===r?this._ascending:this._descending,e.sort(t)};let n=0;return r._addAlgorithm(((r,i,s)=>{const o=r.key;for(;t(o,e[n])>0;)if(++n,n===e.length)return i(s),!1;return 0===t(o,e[n])||(i((()=>{r.continue(e[n])})),!1)})),r}notEqual(e){return this.inAnyRange([[Ri,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=en.apply(Qr,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return ds(this,Oi)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[Ri,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const r=this._cmp,n=this._ascending,i=this._descending,s=this._min,o=this._max;if(0===e.length)return fs(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&n(e[0],e[1])<=0)))return ds(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",xn.InvalidArgument);const a=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers;let u,c=n;function h(e,t){return c(e[0],t[0])}try{u=e.reduce((function(e,t){let n=0,i=e.length;for(;n<i;++n){const i=e[n];if(r(t[0],i[1])<0&&r(t[1],i[0])>0){i[0]=s(i[0],t[0]),i[1]=o(i[1],t[1]);break}}return n===i&&e.push(t),e}),[]),u.sort(h)}catch(e){return ds(this,Oi)}let p=0;const d=l?e=>n(e,u[p][1])>0:e=>n(e,u[p][1])>=0,f=a?e=>i(e,u[p][0])>0:e=>i(e,u[p][0])>=0;let y=d;const m=new this.Collection(this,(()=>gs(u[0][0],u[u.length-1][1],!a,!l)));return m._ondirectionchange=e=>{"next"===e?(y=d,c=n):(y=f,c=i),u.sort(h)},m._addAlgorithm(((e,t,r)=>{for(var i=e.key;y(i);)if(++p,p===u.length)return t(r),!1;return!!function(e){return!d(e)&&!f(e)}(i)||(0===this._cmp(i,u[p][1])||0===this._cmp(i,u[p][0])||t((()=>{e.continue(c===n?u[p][0]:u[p][1])})),!1)})),m}startsWithAnyOf(){const e=en.apply(Qr,arguments);return e.every((e=>"string"==typeof e))?0===e.length?fs(this):this.inAnyRange(e.map((e=>[e,e+Fi]))):ds(this,"startsWithAnyOf() only works with strings")}}function vs(e){return di((function(t){return bs(t),e(t.target.error),!1}))}function bs(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const ws="storagemutated",_s="x-storagemutated-1",Ss=Hi(null,ws);class Transaction{_lock(){return Lr(!Xn.global),++this._reculock,1!==this._reculock||Xn.global||(Xn.lockOwnerFor=this),this}_unlock(){if(Lr(!Xn.global),0==--this._reculock)for(Xn.global||(Xn.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Ti(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Xn.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,r=this.db._state.dbOpenError;if(Lr(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new xn.DatabaseClosed(r);case"MissingAPIError":throw new xn.MissingAPI(r.message,r);default:throw new xn.OpenFailed(r)}if(!this.active)throw new xn.TransactionInactive;return Lr(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=di((t=>{bs(t),this._reject(e.error)})),e.onabort=di((t=>{bs(t),this.active&&this._reject(new xn.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=di((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Ss.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,r){if("readwrite"===e&&"readwrite"!==this.mode)return Bi(new xn.ReadOnly("Transaction is readonly"));if(!this.active)return Bi(new xn.TransactionInactive);if(this._locked())return new Hn(((n,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(n,i)},Xn])}));if(r)return bi((()=>{var e=new Hn(((e,r)=>{this._lock();const n=t(e,r,this);n&&n.then&&n.then(e,r)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var n=new Hn(((e,r)=>{var n=t(e,r,this);n&&n.then&&n.then(e,r)}));return n._lib=!0,n}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const r=Hn.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>r));else{t._waitingFor=r,t._waitingQueue=[];var n=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Hn(((e,n)=>{r.then((r=>t._waitingQueue.push(di(e.bind(null,r)))),(e=>t._waitingQueue.push(di(n.bind(null,e))))).finally((()=>{t._waitingFor===i&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new xn.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(Ir(t,e))return t[e];const r=this.schema[e];if(!r)throw new xn.NotFound("Table "+e+" not part of transaction");const n=new this.db.Table(e,r,this);return n.core=this.db.core.table(e),t[e]=n,n}}function As(e,t,r,n,i,s,o){return{name:e,keyPath:t,unique:r,multi:n,auto:i,compound:s,src:(r&&!o?"&":"")+(n?"*":"")+(i?"++":"")+ks(t)}}function ks(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function Is(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:Rr(r,(e=>[e.name,e]))}}let Ps=e=>{try{return e.only([[]]),Ps=()=>[[]],[[]]}catch(e){return Ps=()=>Fi,Fi}};function Ts(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>Or(t,e)}(e):t=>Or(t,e)}function Cs(e){return[].slice.call(e)}let Es=0;function Ms(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function Ds(e,t,r){function n(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:r,upper:n,lowerOpen:i,upperOpen:s}=e;return void 0===r?void 0===n?null:t.upperBound(n,!!s):void 0===n?t.lowerBound(r,!!i):t.bound(r,n,!!i,!!s)}const{schema:i,hasGetAll:s}=function(e,t){const r=Cs(e.objectStoreNames);return{schema:{name:e.name,tables:r.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:r}=e,n=_r(t),i={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==t,compound:n,keyPath:t,autoIncrement:r,unique:!0,extractKey:Ts(t)},indexes:Cs(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:r,multiEntry:n,keyPath:s}=e,o={name:t,compound:_r(s),keyPath:s,unique:r,multiEntry:n,extractKey:Ts(s)};return i[Ms(s)]=o,o})),getIndexByKeyPath:e=>i[Ms(e)]};return i[":id"]=s.primaryKey,null!=t&&(i[Ms(t)]=s.primaryKey),s}))},hasGetAll:r.length>0&&"getAll"in t.objectStore(r[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),o=i.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:r,keys:i,values:s,range:o}){return new Promise(((a,l)=>{a=di(a);const u=e.objectStore(t),c=null==u.keyPath,h="put"===r||"add"===r;if(!h&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);const{length:p}=i||s||{length:1};if(i&&s&&i.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===p)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let d;const f=[],y=[];let m=0;const g=e=>{++m,bs(e)};if("deleteRange"===r){if(4===o.type)return a({numFailures:m,failures:y,results:[],lastResult:void 0});f.push(d=3===o.type?u.clear():u.delete(n(o)))}else{const[e,t]=h?c?[s,i]:[s,null]:[i,null];if(h)for(let n=0;n<p;++n)f.push(d=t&&void 0!==t[n]?u[r](e[n],t[n]):u[r](e[n])),d.onerror=g;else for(let t=0;t<p;++t)f.push(d=u[r](e[t])),d.onerror=g}const x=e=>{const t=e.target.result;f.forEach(((e,t)=>null!=e.error&&(y[t]=e.error))),a({numFailures:m,failures:y,results:"delete"===r?i:f.map((e=>e.result)),lastResult:t})};d.onerror=e=>{g(e),x(e)},d.onsuccess=x}))},getMany:({trans:e,keys:r})=>new Promise(((n,i)=>{n=di(n);const s=e.objectStore(t),o=r.length,a=new Array(o);let l,u=0,c=0;const h=e=>{const t=e.target;a[t._pos]=t.result,++c===u&&n(a)},p=vs(i);for(let e=0;e<o;++e)null!=r[e]&&(l=s.get(r[e]),l._pos=e,l.onsuccess=h,l.onerror=p,++u);0===u&&n(a)})),get:({trans:e,key:r})=>new Promise(((n,i)=>{n=di(n);const s=e.objectStore(t).get(r);s.onsuccess=e=>n(e.target.result),s.onerror=vs(i)})),query:function(e){return r=>new Promise(((i,s)=>{i=di(i);const{trans:o,values:a,limit:l,query:u}=r,c=l===1/0?void 0:l,{index:h,range:p}=u,d=o.objectStore(t),f=h.isPrimaryKey?d:d.index(h.name),y=n(p);if(0===l)return i({result:[]});if(e){const e=a?f.getAll(y,c):f.getAllKeys(y,c);e.onsuccess=e=>i({result:e.target.result}),e.onerror=vs(s)}else{let e=0;const t=a||!("openKeyCursor"in f)?f.openCursor(y):f.openKeyCursor(y),r=[];t.onsuccess=n=>{const s=t.result;return s?(r.push(a?s.value:s.primaryKey),++e===l?i({result:r}):void s.continue()):i({result:r})},t.onerror=vs(s)}}))}(s),openCursor:function({trans:e,values:r,query:i,reverse:s,unique:o}){return new Promise(((a,l)=>{a=di(a);const{index:u,range:c}=i,h=e.objectStore(t),p=u.isPrimaryKey?h:h.index(u.name),d=s?o?"prevunique":"prev":o?"nextunique":"next",f=r||!("openKeyCursor"in p)?p.openCursor(n(c),d):p.openKeyCursor(n(c),d);f.onerror=vs(l),f.onsuccess=di((t=>{const r=f.result;if(!r)return void a(null);r.___id=++Es,r.done=!1;const n=r.continue.bind(r);let i=r.continuePrimaryKey;i&&(i=i.bind(r));const s=r.advance.bind(r),o=()=>{throw new Error("Cursor not stopped")};r.trans=e,r.stop=r.continue=r.continuePrimaryKey=r.advance=()=>{throw new Error("Cursor not started")},r.fail=di(l),r.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},r.start=e=>{const t=new Promise(((e,t)=>{e=di(e),f.onerror=vs(t),r.fail=t,r.stop=t=>{r.stop=r.continue=r.continuePrimaryKey=r.advance=o,e(t)}})),a=()=>{if(f.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=()=>{throw new Error("Cursor behind last entry")},r.stop()};return f.onsuccess=di((e=>{f.onsuccess=a,a()})),r.continue=n,r.continuePrimaryKey=i,r.advance=s,a(),t},a(r)}),l)}))},count({query:e,trans:r}){const{index:i,range:s}=e;return new Promise(((e,o)=>{const a=r.objectStore(t),l=i.isPrimaryKey?a:a.index(i.name),u=n(s),c=u?l.count(u):l.count();c.onsuccess=di((t=>e(t.target.result))),c.onerror=vs(o)}))}}}(e))),a={};return o.forEach((e=>a[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!a[e])throw new Error(`Table '${e}' not found`);return a[e]},MIN_KEY:-1/0,MAX_KEY:Ps(t),schema:i}}function zs({_novip:e},t){const r=function(e,t,{IDBKeyRange:r},n){return{dbcore:function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(Ds(t,r,n),e.dbcore)}}(e._middlewares,t.db,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const r=t.name;e.core.schema.tables.some((e=>e.name===r))&&(t.core=e.core.table(r),e[r]instanceof e.Table&&(e[r].core=t.core))}))}function Bs({_novip:e},t,r,n){r.forEach((r=>{const i=n[r];t.forEach((t=>{const n=Dr(t,r);(!n||"value"in n&&void 0===n.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?Cr(t,r,{get(){return this.table(r)},set(e){Tr(this,r,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[r]=new e.Table(r,i))}))}))}function Vs({_novip:e},t){t.forEach((t=>{for(let r in t)t[r]instanceof e.Table&&delete t[r]}))}function Ls(e,t){return e._cfg.version-t._cfg.version}function Fs(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const i=e[n],s=t[n];if(i){const e={name:n,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!$i)e.recreate=!0,r.change.push(e);else{const t=i.idxByName,n=s.idxByName;let o;for(o in t)n[o]||e.del.push(o);for(o in n){const r=t[o],i=n[o];r?r.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&r.change.push(e)}}else r.add.push([n,s])}return r}function Rs(e,t,r,n){const i=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((e=>Os(i,e))),i}function Os(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function js(e,t,r){const n={};return Br(t.objectStoreNames,0).forEach((e=>{const t=r.objectStore(e);let i=t.keyPath;const s=As(ks(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),o=[];for(let e=0;e<t.indexNames.length;++e){const r=t.index(t.indexNames[e]);i=r.keyPath;var a=As(r.name,i,!!r.unique,!!r.multiEntry,!1,i&&"string"!=typeof i,!1);o.push(a)}n[e]=Is(e,s,o)})),n}function qs({_novip:e},t,r){const n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){const s=n[i],o=r.objectStore(s);e._hasGetAll="getAll"in o;for(let e=0;e<o.indexNames.length;++e){const r=o.indexNames[e],n=o.index(r).keyPath,i="string"==typeof n?n:"["+Br(n).join("+")+"]";if(t[s]){const e=t[s].idxByName[i];e&&(e.name=r,delete t[s].idxByName[i],t[s].idxByName[r]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&br.WorkerGlobalScope&&br instanceof br.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Version{_parseStoresSpec(e,t){wr(e).forEach((r=>{if(null!==e[r]){var n=e[r].split(",").map(((e,t)=>{const r=(e=e.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return As(r,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),_r(n),0===t)})),i=n.shift();if(i.multi)throw new xn.Schema("Primary key cannot be multi-valued");n.forEach((e=>{if(e.auto)throw new xn.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new xn.Schema("Index must have a name and cannot be an empty string")})),t[r]=Is(r,i,n)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?Sr(this._cfg.storesSource,e):e;const r={};let n={};return t._versions.forEach((e=>{Sr(r,e._cfg.storesSource),n=e._cfg.dbschema={},e._parseStoresSpec(r,n)})),t._dbSchema=n,Vs(t,[t._allTables,t,t.Transaction.prototype]),Bs(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],wr(n),n),t._storeNames=wr(n),this}upgrade(e){return this._cfg.contentUpgrade=En(this._cfg.contentUpgrade||wn,e),this}}function $s(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Dexie$1(Zi,{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function Us(e){return e&&"function"==typeof e.databases}function Ns(e){return bi((function(){return Xn.letThrough=!0,e()}))}function Ks(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Zs(e){var t=t=>e.next(t),r=i(t),n=i((t=>e.throw(t)));function i(e){return t=>{var i=e(t),s=i.value;return i.done?s:s&&"function"==typeof s.then?s.then(r,n):_r(s)?Promise.all(s).then(r,n):r(s)}}return i(t)()}function Gs(e,t,r){var n=arguments.length;if(n<2)throw new xn.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];r=i.pop();var s=Ur(i);return[e,s,r]}function Xs(e,t,r,n,i){return Hn.resolve().then((()=>{const s=Xn.transless||Xn,o=e._createTransaction(t,r,e._dbSchema,n),a={trans:o,transless:s};if(n)o.idbtrans=n.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(n){return n.name===mn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Xs(e,t,r,null,i)))):Bi(n)}const l=tn(i);let u;l&&wi();const c=Hn.follow((()=>{if(u=i.call(o,o),u)if(l){var e=_i.bind(null,null);u.then(e,e)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=Zs(u))}),a);return(u&&"function"==typeof u.then?Hn.resolve(u).then((e=>o.active?e:Bi(new xn.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):c.then((()=>u))).then((e=>(n&&o._resolve(),o._completion.then((()=>e))))).catch((e=>(o._reject(e),Bi(e))))}))}function Ys(e,t,r){const n=_r(e)?e.slice():[e];for(let e=0;e<r;++e)n.push(t);return n}const Ws={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,i={},s=[];function o(e,t,r){const n=Ms(e),a=i[n]=i[n]||[],l=null==e?0:"string"==typeof e?1:e.length,u=t>0,c={...r,isVirtual:u,keyTail:t,keyLength:l,extractKey:Ts(e),unique:!u&&r.unique};return a.push(c),c.isPrimaryKey||s.push(c),l>1&&o(2===l?e[0]:e.slice(0,l-1),t+1,r),a.sort(((e,t)=>e.keyTail-t.keyTail)),c}const a=o(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(const e of n.indexes)o(e.keyPath,0,e);function l(t){const r=t.query.index;return r.isVirtual?{...t,query:{index:r,range:(n=t.query.range,i=r.keyTail,{type:1===n.type?2:n.type,lower:Ys(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Ys(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}:t;var n,i}return{...r,schema:{...n,primaryKey:a,indexes:s,getIndexByKeyPath:function(e){const t=i[Ms(e)];return t&&t[0]}},count:e=>r.count(l(e)),query:e=>r.query(l(e)),openCursor(t){const{keyTail:n,isVirtual:i,keyLength:s}=t.query.index;return i?r.openCursor(l(t)).then((r=>r&&function(r){return Object.create(r,{continue:{value:function(i){null!=i?r.continue(Ys(i,t.reverse?e.MAX_KEY:e.MIN_KEY,n)):t.unique?r.continue(r.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,n)):r.continue()}},continuePrimaryKey:{value(t,i){r.continuePrimaryKey(Ys(t,e.MAX_KEY,n),i)}},primaryKey:{get:()=>r.primaryKey},key:{get(){const e=r.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:()=>r.value}})}(r))):r.openCursor(t)}}}}}};function Js(e,t,r,n){return r=r||{},n=n||"",wr(e).forEach((i=>{if(Ir(t,i)){var s=e[i],o=t[i];if("object"==typeof s&&"object"==typeof o&&s&&o){const e=Wr(s);e!==Wr(o)?r[n+i]=t[i]:"Object"===e?Js(s,o,r,n+i+"."):s!==o&&(r[n+i]=t[i])}else s!==o&&(r[n+i]=t[i])}else r[n+i]=void 0})),wr(t).forEach((i=>{Ir(e,i)||(r[n+i]=t[i])})),r}const Hs={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema;return{...r,mutate(e){const i=Xn.trans,{deleting:s,creating:o,updating:a}=i.table(t).hook;switch(e.type){case"add":if(o.fire===wn)break;return i._promise("readwrite",(()=>l(e)),!0);case"put":if(o.fire===wn&&a.fire===wn)break;return i._promise("readwrite",(()=>l(e)),!0);case"delete":if(s.fire===wn)break;return i._promise("readwrite",(()=>l(e)),!0);case"deleteRange":if(s.fire===wn)break;return i._promise("readwrite",(()=>function(e){return u(e.trans,e.range,1e4)}(e)),!0)}return r.mutate(e);function l(e){const t=Xn.trans,i=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(n,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:i}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,r){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:r,cache:"immutable"})}(r,e,i).then((l=>{const u=i.map(((r,i)=>{const u=l[i],c={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(c,r,u,t);else if("add"===e.type||void 0===u){const s=o.fire.call(c,r,e.values[i],t);null==r&&null!=s&&(e.keys[i]=r=s,n.outbound||jr(e.values[i],n.keyPath,r))}else{const n=Js(u,e.values[i]),s=a.fire.call(c,n,r,u,t);if(s){const t=e.values[i];Object.keys(s).forEach((e=>{Ir(t,e)?t[e]=s[e]:jr(t,e,s[e])}))}}return c}));return r.mutate(e).then((({failures:t,results:r,numFailures:n,lastResult:s})=>{for(let n=0;n<i.length;++n){const s=r?r[n]:i[n],o=u[n];null==s?o.onerror&&o.onerror(t[n]):o.onsuccess&&o.onsuccess("put"===e.type&&l[n]?e.values[n]:s)}return{failures:t,results:r,numFailures:n,lastResult:s}})).catch((e=>(u.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function u(e,t,i){return r.query({trans:e,values:!1,query:{index:n,range:t},limit:i}).then((({result:r})=>l({type:"delete",keys:r,trans:e}).then((n=>n.numFailures>0?Promise.reject(n.failures[0]):r.length<i?{failures:[],numFailures:0,lastResult:void 0}:u(e,{...t,lower:r[r.length-1],lowerOpen:!0},i)))))}}}}})};function Qs(e,t,r){try{if(!t)return null;if(t.keys.length<e.length)return null;const n=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)0===as(t.keys[i],e[s])&&(n.push(r?Gr(t.values[i]):t.values[i]),++s);return n.length===e.length?n:null}catch(e){return null}}const eo={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:e=>{if(!e.cache)return r.getMany(e);const t=Qs(e.keys,e.trans._cache,"clone"===e.cache);return t?Hn.resolve(t):r.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?Gr(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),r.mutate(e))}}})};function to(e){return!("from"in e)}const ro=function(e,t){if(!this){const t=new ro;return e&&"d"in e&&Sr(t,e),t}Sr(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function no(e,t,r){const n=as(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(to(e))return Sr(e,{from:t,to:r,d:1});const i=e.l,s=e.r;if(as(r,e.from)<0)return i?no(i,t,r):e.l={from:t,to:r,d:1,l:null,r:null},oo(e);if(as(t,e.to)>0)return s?no(s,t,r):e.r={from:t,to:r,d:1,l:null,r:null},oo(e);as(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),as(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&io(e,i),s&&o&&io(e,s)}function io(e,t){to(t)||function e(t,{from:r,to:n,l:i,r:s}){no(t,r,n),i&&e(t,i),s&&e(t,s)}(e,t)}function so(e){let t=to(e)?null:{s:0,n:e};return{next(e){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&as(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||as(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function oo(e){var t,r;const n=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){const t="r"===i?"l":"r",r={...e},n=e[i];e.from=n.from,e.to=n.to,e[i]=n[i],r[i]=n[t],e[t]=r,r.d=ao(r)}e.d=ao(e)}function ao({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}Pr(ro.prototype,{add(e){return io(this,e),this},addKey(e){return no(this,e,e),this},addKeys(e){return e.forEach((e=>no(this,e,e))),this},[Jr](){return so(this)}});const lo={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new ro(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const i=e.table(n),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,u={...i,mutate:e=>{const o=e.trans,a=o.mutatedParts||(o.mutatedParts={}),l=e=>{const r=`idb://${t}/${n}/${e}`;return a[r]||(a[r]=new ro)},u=l(""),c=l(":dels"),{type:h}=e;let[p,d]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const f=e.trans._cache;return i.mutate(e).then((e=>{if(_r(p)){"delete"!==h&&(p=e.results),u.addKeys(p);const t=Qs(p,f);t||"add"===h||c.addKeys(p),(t||d)&&function(e,t,r,n){t.indexes.forEach((function(t){const i=e(t.name||"");function s(e){return null!=e?t.extractKey(e):null}const o=e=>t.multiEntry&&_r(e)?e.forEach((e=>i.addKey(e))):i.addKey(e);(r||n).forEach(((e,t)=>{const i=r&&s(r[t]),a=n&&s(n[t]);0!==as(i,a)&&(null!=i&&o(i),null!=a&&o(a))}))}))}(l,s,t,d)}else if(p){const e={from:p.lower,to:p.upper};c.add(e),u.add(e)}else u.add(r),c.add(r),s.indexes.forEach((e=>l(e.name).add(r)));return e}))}},c=({query:{index:t,range:r}})=>{var n,i;return[t,new ro(null!==(n=r.lower)&&void 0!==n?n:e.MIN_KEY,null!==(i=r.upper)&&void 0!==i?i:e.MAX_KEY)]},h={get:e=>[o,new ro(e.key)],getMany:e=>[o,(new ro).addKeys(e.keys)],count:c,query:c,openCursor:c};return wr(h).forEach((e=>{u[e]=function(s){const{subscr:o}=Xn;if(o){const u=e=>{const r=`idb://${t}/${n}/${e}`;return o[r]||(o[r]=new ro)},c=u(""),p=u(":dels"),[d,f]=h[e](s);if(u(d.name||"").add(f),!d.isPrimaryKey){if("count"!==e){const t="query"===e&&l&&s.values&&i.query({...s,values:!1});return i[e].apply(this,arguments).then((r=>{if("query"===e){if(l&&s.values)return t.then((({result:e})=>(c.addKeys(e),r)));const e=s.values?r.result.map(a):r.result;s.values?c.addKeys(e):p.addKeys(e)}else if("openCursor"===e){const e=r,t=s.values;return e&&Object.create(e,{key:{get:()=>(p.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return p.addKey(t),t}},value:{get:()=>(t&&c.addKey(e.primaryKey),e.value)}})}return r}))}p.add(r)}}return i[e].apply(this,arguments)}})),u}}}};class Dexie$1{constructor(e,t){this._middlewares={},this.verno=0;const r=Dexie$1.dependencies;this._options=t={addons:Dexie$1.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:n}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:wn,dbReadyPromise:null,cancelOpen:wn,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};i.dbReadyPromise=new Hn((e=>{i.dbReadyResolve=e})),i.openCanceller=new Hn(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=Hi(this,"populate","blocked","versionchange","close",{ready:[En,wn]}),this.on.ready.subscribe=Vr(this.on.ready.subscribe,(e=>(t,r)=>{Dexie$1.vip((()=>{const n=this._state;if(n.openComplete)n.dbOpenError||Hn.resolve().then(t),r&&e(t);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(t),r&&e(t);else{e(t);const n=this;r||e((function e(){n.on.ready.unsubscribe(t),n.on.ready.unsubscribe(e)}))}}))})),this.Collection=function(e){return Qi(Collection.prototype,(function(t,r){this.db=e;let n=Wi,i=null;if(r)try{n=r()}catch(e){i=e}const s=t._ctx,o=s.table,a=o.hook.reading.fire;this._ctx={table:o,index:s.index,isPrimKey:!s.index||o.schema.primKey.keyPath&&s.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:s.or,valueMapper:a!==_n?a:null}}))}(this),this.Table=function(e){return Qi(Table.prototype,(function(t,r,n){this.db=e,this._tx=n,this.name=t,this.schema=r,this.hook=e._allTables[t]?e._allTables[t].hook:Hi(null,{creating:[kn,wn],reading:[Sn,_n],updating:[Tn,wn],deleting:[Pn,wn]})}))}(this),this.Transaction=function(e){return Qi(Transaction.prototype,(function(t,r,n,i,s){this.db=e,this.mode=t,this.storeNames=r,this.schema=n,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Hi(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Hn(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),Bi(e)}))}))}(this),this.Version=function(e){return Qi(Version.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Qi(WhereClause.prototype,(function(t,r,n){this.db=e,this._ctx={table:t,index:":id"===r?null:r,or:n};const i=e._deps.indexedDB;if(!i)throw new xn.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(e,t)=>i.cmp(t,e),this._max=(e,t)=>i.cmp(e,t)>0?e:t,this._min=(e,t)=>i.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=Ps(t.IDBKeyRange),this._createTransaction=(e,t,r,n)=>new this.Transaction(e,t,r,this._options.chromeTransactionDurability,n),this._fireOnBlocked=e=>{this.on("blocked").fire(e),qi.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Ws),this.use(Hs),this.use(lo),this.use(eo),this.vip=Object.create(this,{_vip:{value:!0}}),n.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new xn.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new xn.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var r=t.filter((t=>t._cfg.version===e))[0];return r||(r=new this.Version(e),t.push(r),t.sort(Ls),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Xn.letThrough||this._vip)?e():new Hn(((e,t)=>{if(this._state.openComplete)return t(new xn.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new xn.DatabaseClosed);this.open().catch(wn)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:r,name:n}){n&&this.unuse({stack:e,name:n});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:null==r?10:r,name:n}),i.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>r?e.create!==r:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?Bi(t.dbOpenError):e));rn&&(t.openCanceller._stackHolder=an()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const n=t.openCanceller;function i(){if(t.openCanceller!==n)throw new xn.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,a=!1;return Hn.race([n,("undefined"==typeof navigator?Hn.resolve():Ks()).then((()=>new Hn(((n,s)=>{if(i(),!r)throw new xn.MissingAPI;const l=e.name,u=t.autoSchema?r.open(l):r.open(l,Math.round(10*e.verno));if(!u)throw new xn.MissingAPI;u.onerror=vs(s),u.onblocked=di(e._fireOnBlocked),u.onupgradeneeded=di((n=>{if(o=u.transaction,t.autoSchema&&!e._options.allowEmptyDB){u.onerror=bs,o.abort(),u.result.close();const e=r.deleteDatabase(l);e.onsuccess=e.onerror=di((()=>{s(new xn.NoSuchDatabase(`Database ${l} doesnt exist`))}))}else{o.onerror=vs(s);var i=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;a=i<1,e._novip.idbdb=u.result,function(e,t,r,n){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(r),s._completion.catch(n);const o=s._reject.bind(s),a=Xn.transless||Xn;bi((()=>{Xn.trans=s,Xn.transless=a,0===t?(wr(i).forEach((e=>{Rs(r,e,i[e].primKey,i[e].indexes)})),zs(e,r),Hn.follow((()=>e.on.populate.fire(s))).catch(o)):function({_novip:e},t,r,n){const i=[],s=e._versions;let o=e._dbSchema=js(0,e.idbdb,n),a=!1;return s.filter((e=>e._cfg.version>=t)).forEach((s=>{i.push((()=>{const i=o,l=s._cfg.dbschema;qs(e,i,n),qs(e,l,n),o=e._dbSchema=l;const u=Fs(i,l);u.add.forEach((e=>{Rs(n,e[0],e[1].primKey,e[1].indexes)})),u.change.forEach((e=>{if(e.recreate)throw new xn.Upgrade("Not yet support for changing primary key");{const t=n.objectStore(e.name);e.add.forEach((e=>Os(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),Os(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const c=s._cfg.contentUpgrade;if(c&&s._cfg.version>t){zs(e,n),r._memoizedTables={},a=!0;let t=qr(l);u.del.forEach((e=>{t[e]=i[e]})),Vs(e,[e.Transaction.prototype]),Bs(e,[e.Transaction.prototype],wr(t),t),r.schema=t;const s=tn(c);let o;s&&wi();const h=Hn.follow((()=>{if(o=c(r),o&&s){var e=_i.bind(null,null);o.then(e,e)}}));return o&&"function"==typeof o.then?Hn.resolve(o):h.then((()=>o))}})),i.push((t=>{a&&Ui||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((r=>null==e[r]&&t.db.deleteObjectStore(r)))}(s._cfg.dbschema,t),Vs(e,[e.Transaction.prototype]),Bs(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),r.schema=e._dbSchema}))})),function e(){return i.length?Hn.resolve(i.shift()(r.idbtrans)).then(e):Hn.resolve()}().then((()=>{var e,t;t=n,wr(e=o).forEach((r=>{t.db.objectStoreNames.contains(r)||Rs(t,r,e[r].primKey,e[r].indexes)}))}))}(e,t,s,r).catch(o)}))}(e,i/10,o,s)}}),s),u.onsuccess=di((()=>{o=null;const r=e._novip.idbdb=u.result,i=Br(r.objectStoreNames);if(i.length>0)try{const n=r.transaction(1===(s=i).length?s[0]:s,"readonly");t.autoSchema?function({_novip:e},t,r){e.verno=t.version/10;const n=e._dbSchema=js(0,t,r);e._storeNames=Br(t.objectStoreNames,0),Bs(e,[e._allTables],wr(n),n)}(e,r,n):(qs(e,e._dbSchema,n),function(e,t){const r=Fs(js(0,e.idbdb,t),e._dbSchema);return!(r.add.length||r.change.some((e=>e.add.length||e.change.length)))}(e,n)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),zs(e,n)}catch(e){}var s;qi.push(e),r.onversionchange=di((r=>{t.vcFired=!0,e.on("versionchange").fire(r)})),r.onclose=di((t=>{e.on("close").fire(t)})),a&&function({indexedDB:e,IDBKeyRange:t},r){!Us(e)&&r!==Zi&&$s(e,t).put({name:r}).catch(wn)}(e._deps,l),n()}),s)}))))]).then((()=>(i(),t.onReadyBeingFired=[],Hn.resolve(Ns((()=>e.on.ready.fire(e.vip)))).then((function r(){if(t.onReadyBeingFired.length>0){let n=t.onReadyBeingFired.reduce(En,wn);return t.onReadyBeingFired=[],Hn.resolve(Ns((()=>n(e.vip)))).then(r)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((r=>{t.dbOpenError=r;try{o&&o.abort()}catch(e){}return n===t.openCanceller&&e._close(),Bi(r)})).finally((()=>{t.openComplete=!0,s()}))}(this)}_close(){const e=this._state,t=qi.indexOf(this);if(t>=0&&qi.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Hn((t=>{e.dbReadyResolve=t})),e.openCanceller=new Hn(((t,r)=>{e.cancelOpen=r}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new xn.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Hn(((r,n)=>{const i=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=di((()=>{!function({indexedDB:e,IDBKeyRange:t},r){!Us(e)&&r!==Zi&&$s(e,t).delete(r).catch(wn)}(this._deps,this.name),r()})),e.onerror=vs(n),e.onblocked=this._fireOnBlocked};if(e)throw new xn.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return wr(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Gs.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let n=Xn.trans;n&&n.db===this&&-1===e.indexOf("!")||(n=null);const i=-1!==e.indexOf("?");let s,o;e=e.replace("!","").replace("?","");try{if(o=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===Gi)s=Gi;else{if("rw"!=e&&e!=Xi)throw new xn.InvalidArgument("Invalid transaction mode: "+e);s=Xi}if(n){if(n.mode===Gi&&s===Xi){if(!i)throw new xn.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");n=null}n&&o.forEach((e=>{if(n&&-1===n.storeNames.indexOf(e)){if(!i)throw new xn.SubTransaction("Table "+e+" not included in parent transaction.");n=null}})),i&&n&&!n.active&&(n=null)}}catch(e){return n?n._promise(null,((t,r)=>{r(e)})):Bi(e)}const a=Xs.bind(null,this,s,o,n,r);return n?n._promise(s,a,"lock"):Xn.trans?Ti(Xn.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!Ir(this._allTables,e))throw new xn.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const uo="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class Observable{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:r})}[uo](){return this}}function co(e,t){return wr(t).forEach((r=>{io(e[r]||(e[r]=new ro),t[r])})),e}let ho;try{ho={indexedDB:br.indexedDB||br.mozIndexedDB||br.webkitIndexedDB||br.msIndexedDB,IDBKeyRange:br.IDBKeyRange||br.webkitIDBKeyRange}}catch(e){ho={indexedDB:null,IDBKeyRange:null}}const po=Dexie$1;function fo(e){let t=yo;try{yo=!0,Ss.storagemutated.fire(e)}finally{yo=t}}Pr(po,{...bn,delete:e=>new po(e,{addons:[]}).delete(),exists:e=>new po(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Us(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>e!==Zi)))):$s(e,t).toCollection().primaryKeys()}(po.dependencies).then(e)}catch(e){return Bi(new xn.MissingAPI)}},defineClass:()=>function(e){Sr(this,e)},ignoreTransaction:e=>Xn.trans?Ti(Xn.transless,e):e(),vip:Ns,async:function(e){return function(){try{var t=Zs(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Hn.resolve(t)}catch(e){return Bi(e)}}},spawn:function(e,t,r){try{var n=Zs(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:Hn.resolve(n)}catch(e){return Bi(e)}},currentTransaction:{get:()=>Xn.trans||null},waitFor:function(e,t){const r=Hn.resolve("function"==typeof e?po.ignoreTransaction(e):e).timeout(t||6e4);return Xn.trans?Xn.trans.waitFor(r):r},Promise:Hn,debug:{get:()=>rn,set:e=>{nn(e,"dexie"===e?()=>!0:Ki)}},derive:Er,extend:Sr,props:Pr,override:Vr,Events:Hi,on:Ss,liveQuery:function(e){return new Observable((t=>{const r=tn(e);let n=!1,i={},s={};const o={get closed(){return n},unsubscribe:()=>{n=!0,Ss.storagemutated.unsubscribe(c)}};t.start&&t.start(o);let a=!1,l=!1;function u(){return wr(s).some((e=>i[e]&&function(e,t){const r=so(t);let n=r.next();if(n.done)return!1;let i=n.value;const s=so(e);let o=s.next(i.from),a=o.value;for(;!n.done&&!o.done;){if(as(a.from,i.to)<=0&&as(a.to,i.from)>=0)return!0;as(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}(i[e],s[e])))}const c=e=>{co(i,e),u()&&h()},h=()=>{if(a||n)return;i={};const p={},d=function(t){r&&wi();const n=()=>bi(e,{subscr:t,trans:null}),i=Xn.trans?Ti(Xn.transless,n):n();return r&&i.then(_i,_i),i}(p);l||(Ss(ws,c),l=!0),a=!0,Promise.resolve(d).then((e=>{a=!1,n||(u()?h():(i={},s=p,t.next&&t.next(e)))}),(e=>{a=!1,t.error&&t.error(e),o.unsubscribe()}))};return h(),o}))},extendObservabilitySet:co,getByKeyPath:Or,setByKeyPath:jr,delByKeyPath:function(e,t){"string"==typeof t?jr(e,t,void 0):"length"in t&&[].map.call(t,(function(t){jr(e,t,void 0)}))},shallowClone:qr,deepClone:Gr,getObjectDiff:Js,cmp:as,asap:Fr,minKey:Ri,addons:[],connections:qi,errnames:mn,dependencies:ho,semVer:Li,version:Li.split(".").map((e=>parseInt(e))).reduce(((e,t,r)=>e+t/Math.pow(10,2*r)))}),po.maxKey=Ps(po.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Ss(ws,(e=>{if(!yo){let t;$i?(t=document.createEvent("CustomEvent"),t.initCustomEvent(_s,!0,!0,e)):t=new CustomEvent(_s,{detail:e}),yo=!0,dispatchEvent(t),yo=!1}})),addEventListener(_s,(({detail:e})=>{yo||fo(e)})));let yo=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel(_s);Ss(ws,(t=>{yo||e.postMessage(t)})),e.onmessage=e=>{e.data&&fo(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Ss(ws,(e=>{try{yo||("undefined"!=typeof localStorage&&localStorage.setItem(_s,JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:_s,changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if(e.key===_s){const t=JSON.parse(e.newValue);t&&fo(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&e.type===_s&&fo(e.changedParts)}))}Hn.rejectionMapper=function(e,t){if(!e||e instanceof pn||e instanceof TypeError||e instanceof SyntaxError||!e.name||!vn[e.name])return e;var r=new vn[e.name](t||e.message,e);return"stack"in e&&Cr(r,"stack",{get:function(){return this.inner.stack}}),r},nn(rn,Ki);const mo=new Dexie$1("botlink-tile-cache");mo.version(1).stores({tiles:"url, blob"}),"function"==typeof Object.freeze&&Object.freeze({Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"});class AJAXError extends Error{constructor(e,t,r){401===t&&nr(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const go=S()?()=>self.worker&&self.worker.referrer:()=>("blob:"===r.location.protocol?r.parent:r).location.href,xo=e=>/^file:/.test(e)||/^file:/.test(go())&&!/^\w+:/.test(e),vo=async e=>await mo.tiles.where("url").equalsIgnoreCase(e).first(),bo=function(e,t){if(!xo(e.url)){if(r.fetch&&r.Request&&r.AbortController&&r.Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new r.AbortController,i=new r.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:go(),signal:n.signal});let s=!1,o=!1;const a=ir(i.url);"json"===e.type&&i.headers.set("Accept","application/json");const l=async(n,s,l)=>{if(o)return;if(n&&"SecurityError"!==n.message&&b(n),s&&l)return u(s);const c=xr(i.url),h=await vo(c);if(h){const e=async()=>h.blob;return u({headers:{get:e=>"Cache-Control"===e?"max-age=43200,s-maxage=300":new Date((new Date).getTime()+432e5).toUTCString()},arrayBuffer:e,json:e,text:e})}const p=Date.now();r.fetch(i).then((r=>{if(r.ok){const e=a?r.clone():null;return u(r,e,p)}return t(new AJAXError(r.statusText,r.status,e.url))})).catch((e=>{20!==e.code&&t(new Error(e.message))}))},u=(r,n,a)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then((e=>{o||(n&&a&&mr(i,n,a),s=!0,t(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((e=>{o||t(new Error(e.message))}))};return a?vr(i,l):l(null,null),{cancel:()=>{o=!0,s||n.abort()}}}(e,t);if(S()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}return function(e,t){const n=new r.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const t in e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let r=n.response;if("json"===e.type)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new AJAXError(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},wo=function(e,t){return bo(h(e,{type:"arrayBuffer"}),t)},_o=function(e,t){return bo(h(e,{method:"POST"}),t)},So=function(e,t){return bo(h(e,{method:"GET"}),t)},Ao={};function ko(e,t,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Ao[t]={klass:e,omit:r.omit||[]}}ko(Object,"Object"),C.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},C.deserialize=function(e){return new C(e.buffer)},Object.defineProperty(C,"name",{value:"Grid"}),ko(C,"Grid"),ko(z,"Color"),ko(Error,"Error"),ko(AJAXError,"AJAXError"),ko(ResolvedImage,"ResolvedImage"),ko(StylePropertyFunction,"StylePropertyFunction"),ko(StyleExpression,"StyleExpression",{omit:["_evaluator"]}),ko(ZoomDependentExpression,"ZoomDependentExpression"),ko(ZoomConstantExpression,"ZoomConstantExpression"),ko(he,"CompoundExpression",{omit:["_evaluate"]});for(const e in Ct)Ao[Ct[e]._classRegistryKey]||ko(Ct[e],`Expression${e}`);function Io(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Po(e){return r.ImageBitmap&&e instanceof r.ImageBitmap}function To(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Io(e)||Po(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const r=e;return t&&t.push(r.buffer),r}if(e instanceof r.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const n of e)r.push(To(n,t));return r}if("object"==typeof e){const r=e.constructor,n=r._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const i=r.serialize?r.serialize(e,t):{};if(!r.serialize){for(const r in e)e.hasOwnProperty(r)&&(Ao[n].omit.indexOf(r)>=0||(i[r]=To(e[r],t)));e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof e)}function Co(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Io(e)||Po(e)||ArrayBuffer.isView(e)||e instanceof r.ImageData)return e;if(Array.isArray(e))return e.map(Co);if("object"==typeof e){const t=e.$name||"Object",{klass:r}=Ao[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);const n=Object.create(r.prototype);for(const t of Object.keys(e))"$name"!==t&&(n[t]=Co(e[t]));return n}throw new Error("can't deserialize object of type "+typeof e)}class ThrottledInvoker{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}const Eo=r.performance;function Mo(e){const t=e?e.url.toString():void 0;return Eo.getEntriesByName(t)}class Scheduler{constructor(){this.tasks={},this.taskQueue=[],y(["process"],this),this.invoker=new ThrottledInvoker(this.process),this.nextId=0}add(e,t){const r=this.nextId++,n=function({type:e,isSymbolTile:t,zoom:r}){return r=r||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-r:"maybePrepare"===e&&t?400-r:500:200-r:100-r}(t);if(0===n){S();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:t,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){S();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let r=0;r<this.taskQueue.length;r++){const n=this.tasks[this.taskQueue[r]];n.priority<t&&(t=n.priority,e=r)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class Actor{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},y(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=S()?e:r,this.scheduler=new Scheduler}send(e,t,r,n,i=!1,s){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=s,this.callbacks[o]=r);const a=I(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:e,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:To(t,a)},a),{cancel:()=>{r&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||S()){const e=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add((()=>this.processTask(r,t)),e&&e.metadata||{type:"message"})}else this.processTask(r,t)}processTask(e,t){if("<response>"===t.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(Co(t.error)):r(null,Co(t.data)))}else{const r=I(this.globalScope)?void 0:[],n=t.hasCallback?(t,n)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?To(t):null,data:To(n,r)},r)}:e=>{},i=Co(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,i,n);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],i.source)[e[1]](i,n)}else n(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Do=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function zo(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Bo(e,t,r){if(r&&r[e]){const n=r[e].indexOf(t);-1!==n&&r[e].splice(n,1)}}class Event{constructor(e,t={}){h(this,t),this.type=e}}class ErrorEvent extends Event{constructor(e,t={}){super("error",h({error:e},t))}}class Evented{on(e,t){return this._listeners=this._listeners||{},zo(e,t,this._listeners),this}off(e,t){return Bo(e,t,this._listeners),Bo(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},zo(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Event(e,t||{}));const r=e.type;if(this.listens(r)){e.target=this;const t=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of t)r.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const t of n)Bo(r,t,this._oneTimeListeners),t.call(this,e);const i=this._eventedParent;i&&(h(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof ErrorEvent&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}function Vo(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Lo(e){if(Array.isArray(e))return e.map(Lo);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=Lo(e[r]);return t}return Vo(e)}class ValidationError{constructor(e,t,r,n){this.message=(e?`${e}: `:"")+r,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function Fo(e){const t=e.key,r=e.value,n=e.valueSpec||{},i=e.objectElementValidators||{},s=e.style,o=e.styleSpec;let a=[];const l=Vt(r);if("object"!==l)return[new ValidationError(t,r,`object expected, ${l} found`)];for(const e in r){const l=e.split(".")[0],u=n[l]||n["*"];let c;i[l]?c=i[l]:n[l]?c=ha:i["*"]?c=i["*"]:n["*"]&&(c=ha),c?a=a.concat(c({key:(t?`${t}.`:t)+e,value:r[e],valueSpec:u,style:s,styleSpec:o,object:r,objectKey:e},r)):a.push(new ValidationError(t,r[e],`unknown property "${e}"`))}for(const e in n)i[e]||n[e].required&&void 0===n[e].default&&void 0===r[e]&&a.push(new ValidationError(t,r,`missing required property "${e}"`));return a}function Ro(e){const t=e.value,r=e.valueSpec,n=e.style,i=e.styleSpec,s=e.key,o=e.arrayElementValidator||ha;if("array"!==Vt(t))return[new ValidationError(s,t,`array expected, ${Vt(t)} found`)];if(r.length&&t.length!==r.length)return[new ValidationError(s,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ValidationError(s,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let a={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};i.$version<7&&(a.function=r.function),"object"===Vt(r.value)&&(a=r.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(o({array:t,arrayIndex:e,value:t[e],valueSpec:a,style:n,styleSpec:i,key:`${s}[${e}]`}));return l}function Oo(e){const t=e.key,r=e.value,n=e.valueSpec;let i=Vt(r);if("number"===i&&r!=r&&(i="NaN"),"number"!==i)return[new ValidationError(t,r,`number expected, ${i} found`)];if("minimum"in n){let i=n.minimum;if("array"===Vt(n.minimum)&&(i=n.minimum[e.arrayIndex]),r<i)return[new ValidationError(t,r,`${r} is less than the minimum value ${i}`)]}if("maximum"in n){let i=n.maximum;if("array"===Vt(n.maximum)&&(i=n.maximum[e.arrayIndex]),r>i)return[new ValidationError(t,r,`${r} is greater than the maximum value ${i}`)]}return[]}function jo(e){const t=e.valueSpec,r=Vo(e.value.type);let n,i,s,o={};const a="categorical"!==r&&void 0===e.value.property,l=!a,u="array"===Vt(e.value.stops)&&"array"===Vt(e.value.stops[0])&&"object"===Vt(e.value.stops[0][0]),c=Fo({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===r)return[new ValidationError(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(Ro({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Vt(n)&&0===n.length&&t.push(new ValidationError(e.key,n,"array must have at least one stop")),t},default:function(e){return ha({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&a&&c.push(new ValidationError(e.key,e.value,'missing required property "property"')),"identity"===r||e.value.stops||c.push(new ValidationError(e.key,e.value,'missing required property "stops"')),"exponential"===r&&e.valueSpec.expression&&!Bt(e.valueSpec)&&c.push(new ValidationError(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Dt(e.valueSpec)?c.push(new ValidationError(e.key,e.value,"property functions not supported")):a&&!zt(e.valueSpec)&&c.push(new ValidationError(e.key,e.value,"zoom functions not supported"))),"categorical"!==r&&!u||void 0!==e.value.property||c.push(new ValidationError(e.key,e.value,'"property" property is required')),c;function h(e){let r=[];const n=e.value,a=e.key;if("array"!==Vt(n))return[new ValidationError(a,n,`array expected, ${Vt(n)} found`)];if(2!==n.length)return[new ValidationError(a,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==Vt(n[0]))return[new ValidationError(a,n,`object expected, ${Vt(n[0])} found`)];if(void 0===n[0].zoom)return[new ValidationError(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new ValidationError(a,n,"object stop key must have value")];const t=Vo(n[0].zoom);if("number"!=typeof t)return[new ValidationError(a,n[0].zoom,"stop zoom values must be numbers")];if(s&&s>t)return[new ValidationError(a,n[0].zoom,"stop zoom values must appear in ascending order")];t!==s&&(s=t,i=void 0,o={}),r=r.concat(Fo({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Oo,value:p}}))}else r=r.concat(p({key:`${a}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return Nt(Lo(n[1]))?r.concat([new ValidationError(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):r.concat(ha({key:`${a}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function p(e,s){const a=Vt(e.value),l=Vo(e.value),u=null!==e.value?e.value:s;if(n){if(a!==n)return[new ValidationError(e.key,u,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new ValidationError(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==r){let n=`number expected, ${a} found`;return Dt(t)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ValidationError(e.key,u,n)]}return"categorical"!==r||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==r&&"number"===a&&"number"==typeof l&&"number"==typeof i&&void 0!==i&&l<i?[new ValidationError(e.key,u,"stop domain values must appear in ascending order")]:(i=l,"categorical"===r&&l in o?[new ValidationError(e.key,u,"stop domain values must be unique")]:(o[l]=!0,[])):[new ValidationError(e.key,u,`integer expected, found ${String(l)}`)]}}function qo(e){const t=("property"===e.expressionContext?Zt:Kt)(Lo(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new ValidationError(`${e.key}${t.key}`,e.value,t.message)));const r=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new ValidationError(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ee(r))return[new ValidationError(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return $o(r,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Me(r,["zoom","feature-state"]))return[new ValidationError(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Ce(r))return[new ValidationError(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $o(e,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)r.delete(e);if(0===r.size)return[];const n=[];return e instanceof he&&r.has(e.name)?[new ValidationError(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{n.push(...$o(e,t))})),n)}function Uo(e){const t=e.key,r=e.value,n=e.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(Vo(r))&&i.push(new ValidationError(t,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(Vo(r))&&i.push(new ValidationError(t,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),i}function No(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!No(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Ko(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};No(e)||(e=Ho(e));const r=e;let n=!0;try{n=function(e){if(!Xo(e))return e;let t=Lo(e);return Go(t),t=Zo(t),t}(r)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const i=Do[`filter_${t}`],s=Kt(n,i);let o=null;if("error"===s.result)throw new Error(s.value.map((e=>`${e.key}: ${e.message}`)).join(", "));o=(e,t,r)=>s.value.evaluate(e,t,{},r);let a=null,l=null;if(n!==r){const e=Kt(r,i);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(t,r,n,i,s)=>e.value.evaluate(t,r,{},n,void 0,void 0,i,s),l=!Ce(e.value.expression)}return o=o,{filter:o,dynamicFilter:a||void 0,needGeometry:Jo(n),needFeature:!!l}}function Zo(e){if(!Array.isArray(e))return e;const t=function(e){if(Yo.has(e[0]))for(let t=1;t<e.length;t++)if(Xo(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>Zo(e)))}function Go(e){let t=!1;const r=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||Xo(e[n]),r.push(e[n+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||Xo(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||Xo(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let t=1;t<e.length;t++)Go(e[t])}function Xo(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(Xo(e[t]))return!0;return!1}const Yo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Wo(e,t){return e<t?-1:e>t?1:0}function Jo(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(Jo(e[t]))return!0;return!1}function Ho(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Qo(e[1],e[2],"=="):"!="===t?ra(Qo(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Qo(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(Ho))):"all"===t?["all"].concat(e.slice(1).map(Ho)):"none"===t?["all"].concat(e.slice(1).map(Ho).map(ra)):"in"===t?ea(e[1],e.slice(2)):"!in"===t?ra(ea(e[1],e.slice(2))):"has"===t?ta(e[1]):"!has"===t?ra(ta(e[1])):"within"!==t||e;var r}function Qo(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function ea(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Wo)]]:["filter-in-small",e,["literal",t]]}}function ta(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function ra(e){return["!",e]}function na(e){return No(Lo(e.value))?qo(B({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):ia(e)}function ia(e){const t=e.value,r=e.key;if("array"!==Vt(t))return[new ValidationError(r,t,`array expected, ${Vt(t)} found`)];const n=e.styleSpec;let i,s=[];if(t.length<1)return[new ValidationError(r,t,"filter array must have at least 1 element")];switch(s=s.concat(Uo({key:`${r}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),Vo(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Vo(t[1])&&s.push(new ValidationError(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&s.push(new ValidationError(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(i=Vt(t[1]),"string"!==i&&s.push(new ValidationError(`${r}[1]`,t[1],`string expected, ${i} found`)));for(let o=2;o<t.length;o++)i=Vt(t[o]),"$type"===Vo(t[1])?s=s.concat(Uo({key:`${r}[${o}]`,value:t[o],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&s.push(new ValidationError(`${r}[${o}]`,t[o],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)s=s.concat(ia({key:`${r}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Vt(t[1]),2!==t.length?s.push(new ValidationError(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==i&&s.push(new ValidationError(`${r}[1]`,t[1],`string expected, ${i} found`));break;case"within":i=Vt(t[1]),2!==t.length?s.push(new ValidationError(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==i&&s.push(new ValidationError(`${r}[1]`,t[1],`object expected, ${i} found`))}return s}function sa(e,t){const r=e.key,n=e.style,i=e.styleSpec,s=e.value,o=e.objectKey,a=i[`${t}_${e.layerType}`];if(!a)return[];const l=o.match(/^(.*)-transition$/);if("paint"===t&&l&&a[l[1]]&&a[l[1]].transition)return ha({key:r,value:s,valueSpec:i.transition,style:n,styleSpec:i});const u=e.valueSpec||a[o];if(!u)return[new ValidationError(r,s,`unknown property "${o}"`)];let c;if("string"===Vt(s)&&Dt(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(s)))return[new ValidationError(r,s,`"${o}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===o&&n&&!n.glyphs&&h.push(new ValidationError(r,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Lt(Lo(s))&&"identity"===Vo(s.type)&&h.push(new ValidationError(r,s,'"text-font" does not support identity functions'))),h.concat(ha({key:e.key,value:s,valueSpec:u,style:n,styleSpec:i,expressionContext:"property",propertyType:t,propertyKey:o}))}function oa(e){return sa(e,"paint")}function aa(e){return sa(e,"layout")}function la(e){const t=e.value,r=e.key,n=Vt(t);return"string"!==n?[new ValidationError(r,t,`string expected, ${n} found`)]:[]}const ua={promoteId:function({key:e,value:t}){if("string"===Vt(t))return la({key:e,value:t});{const r=[];for(const n in t)r.push(...la({key:`${e}.${n}`,value:t[n]}));return r}}},ca={"*":()=>[],array:Ro,boolean:function(e){const t=e.value,r=e.key,n=Vt(t);return"boolean"!==n?[new ValidationError(r,t,`boolean expected, ${n} found`)]:[]},number:Oo,color:function(e){const t=e.key,r=e.value,n=Vt(r);return"string"!==n?[new ValidationError(t,r,`color expected, ${n} found`)]:null===D.parseCSSColor(r)?[new ValidationError(t,r,`color expected, "${r}" found`)]:[]},enum:Uo,filter:na,function:jo,layer:function(e){let t=[];const r=e.value,n=e.key,i=e.style,s=e.styleSpec;r.type||r.ref||t.push(new ValidationError(n,r,'either "type" or "ref" is required'));let o=Vo(r.type);const a=Vo(r.ref);if(r.id){const s=Vo(r.id);for(let o=0;o<e.arrayIndex;o++){const e=i.layers[o];Vo(e.id)===s&&t.push(new ValidationError(n,r.id,`duplicate layer id "${r.id}", previously used at line ${e.id.__line__}`))}}if("ref"in r){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in r&&t.push(new ValidationError(n,r[e],`"${e}" is prohibited for ref layers`))})),i.layers.forEach((t=>{Vo(t.id)===a&&(e=t)})),e?e.ref?t.push(new ValidationError(n,r.ref,"ref cannot reference another ref layer")):o=Vo(e.type):"string"==typeof a&&t.push(new ValidationError(n,r.ref,`ref layer "${a}" not found`))}else if("background"!==o&&"sky"!==o)if(r.source){const e=i.sources&&i.sources[r.source],s=e&&Vo(e.type);e?"vector"===s&&"raster"===o?t.push(new ValidationError(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===s&&"raster"!==o?t.push(new ValidationError(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==s||r["source-layer"]?"raster-dem"===s&&"hillshade"!==o?t.push(new ValidationError(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===s&&e.lineMetrics||t.push(new ValidationError(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ValidationError(n,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ValidationError(n,r.source,`source "${r.source}" not found`))}else t.push(new ValidationError(n,r,'missing required property "source"'));return t=t.concat(Fo({key:n,value:r,valueSpec:s.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ha({key:`${n}.type`,value:r.type,valueSpec:s.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"}),filter:e=>na(B({layerType:o},e)),layout:e=>Fo({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>aa(B({layerType:o},e))}}),paint:e=>Fo({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>oa(B({layerType:o},e))}})}})),t},object:Fo,source:function(e){const t=e.value,r=e.key,n=e.styleSpec,i=e.style;if(!t.type)return[new ValidationError(r,t,'"type" is required')];const s=Vo(t.type);let o;switch(s){case"vector":case"raster":case"raster-dem":return o=Fo({key:r,value:t,valueSpec:n[`source_${s.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:ua}),o;case"geojson":if(o=Fo({key:r,value:t,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:ua}),t.cluster)for(const e in t.clusterProperties){const[n,i]=t.clusterProperties[e],s="string"==typeof n?[n,["accumulated"],["get",e]]:n;o.push(...qo({key:`${r}.${e}.map`,value:i,expressionContext:"cluster-map"})),o.push(...qo({key:`${r}.${e}.reduce`,value:s,expressionContext:"cluster-reduce"}))}return o;case"video":return Fo({key:r,value:t,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return Fo({key:r,value:t,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new ValidationError(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Uo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}},light:function(e){const t=e.value,r=e.styleSpec,n=r.light,i=e.style;let s=[];const o=Vt(t);if(void 0===t)return s;if("object"!==o)return s=s.concat([new ValidationError("light",t,`object expected, ${o} found`)]),s;for(const e in t){const o=e.match(/^(.*)-transition$/);s=s.concat(o&&n[o[1]]&&n[o[1]].transition?ha({key:e,value:t[e],valueSpec:r.transition,style:i,styleSpec:r}):n[e]?ha({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}):[new ValidationError(e,t[e],`unknown property "${e}"`)])}return s},terrain:function(e){const t=e.value,r=e.key,n=e.style,i=e.styleSpec,s=i.terrain;let o=[];const a=Vt(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new ValidationError("terrain",t,`object expected, ${a} found`)]),o;for(const e in t){const r=e.match(/^(.*)-transition$/);o=o.concat(r&&s[r[1]]&&s[r[1]].transition?ha({key:e,value:t[e],valueSpec:i.transition,style:n,styleSpec:i}):s[e]?ha({key:e,value:t[e],valueSpec:s[e],style:n,styleSpec:i}):[new ValidationError(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=n.sources&&n.sources[t.source],i=e&&Vo(e.type);e?"raster-dem"!==i&&o.push(new ValidationError(r,t.source,`terrain cannot be used with a source of type ${String(i)}, it only be used with a "raster-dem" source type`)):o.push(new ValidationError(r,t.source,`source "${t.source}" not found`))}else o.push(new ValidationError(r,t,'terrain is missing required property "source"'));return o},fog:function(e){const t=e.value,r=e.style,n=e.styleSpec,i=n.fog;let s=[];const o=Vt(t);if(void 0===t)return s;if("object"!==o)return s=s.concat([new ValidationError("fog",t,`object expected, ${o} found`)]),s;for(const e in t){const o=e.match(/^(.*)-transition$/);s=s.concat(o&&i[o[1]]&&i[o[1]].transition?ha({key:e,value:t[e],valueSpec:n.transition,style:r,styleSpec:n}):i[e]?ha({key:e,value:t[e],valueSpec:i[e],style:r,styleSpec:n}):[new ValidationError(e,t[e],`unknown property "${e}"`)])}return s},string:la,formatted:function(e){return 0===la(e).length?[]:qo(e)},resolvedImage:function(e){return 0===la(e).length?[]:qo(e)},projection:function(e){const t=e.value,r=e.styleSpec,n=r.projection,i=e.style;let s=[];const o=Vt(t);if("object"===o)for(const e in t)s=s.concat(ha({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}));else"string"!==o&&(s=s.concat([new ValidationError("projection",t,`object or string expected, ${o} found`)]));return s}};function ha(e){const t=e.value,r=e.valueSpec,n=e.styleSpec;return r.expression&&Lt(Vo(t))?jo(e):r.expression&&Nt(Lo(t))?qo(e):r.type&&ca[r.type]?ca[r.type](e):Fo(B({},e,{valueSpec:r.type?n[r.type]:r}))}function pa(e){const t=e.value,r=e.key,n=la(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new ValidationError(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new ValidationError(r,t,'"glyphs" url must include a "{range}" token'))),n}function da(e,t=Do){return ma(ha({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:pa,"*":()=>[]}}))}const fa=e=>ma(oa(e)),ya=e=>ma(aa(e));function ma(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}class ZoomHistory{constructor(){this.first=!0}update(e,t){const r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const ga=e=>e>=1536&&e<=1791,xa=e=>e>=1872&&e<=1919,va=e=>e>=2208&&e<=2303,ba=e=>e>=11904&&e<=12031,wa=e=>e>=12032&&e<=12255,_a=e=>e>=12272&&e<=12287,Sa=e=>e>=12288&&e<=12351,Aa=e=>e>=12352&&e<=12447,ka=e=>e>=12448&&e<=12543,Ia=e=>e>=12544&&e<=12591,Pa=e=>e>=12704&&e<=12735,Ta=e=>e>=12736&&e<=12783,Ca=e=>e>=12784&&e<=12799,Ea=e=>e>=12800&&e<=13055,Ma=e=>e>=13056&&e<=13311,Da=e=>e>=13312&&e<=19903,za=e=>e>=19968&&e<=40959,Ba=e=>e>=40960&&e<=42127,Va=e=>e>=42128&&e<=42191,La=e=>e>=63744&&e<=64255,Fa=e=>e>=64336&&e<=65023,Ra=e=>e>=65040&&e<=65055,Oa=e=>e>=65072&&e<=65103,ja=e=>e>=65104&&e<=65135,qa=e=>e>=65136&&e<=65279,$a=e=>e>=65280&&e<=65519;function Ua(e){for(const t of e)if(Za(t.charCodeAt(0)))return!0;return!1}function Na(e){for(const t of e)if(!Ka(t.charCodeAt(0)))return!1;return!0}function Ka(e){return!(ga(e)||xa(e)||va(e)||Fa(e)||qa(e))}function Za(e){return!(746!==e&&747!==e&&(e<4352||!(Pa(e)||Ia(e)||Oa(e)&&!(e>=65097&&e<=65103)||La(e)||Ma(e)||ba(e)||Ta(e)||!(!Sa(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Da(e)||za(e)||Ea(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||(e=>e>=44032&&e<=55215)(e)||Aa(e)||_a(e)||(e=>e>=12688&&e<=12703)(e)||wa(e)||Ca(e)||ka(e)&&12540!==e||!(!$a(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ja(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||Ra(e)||(e=>e>=19904&&e<=19967)(e)||Ba(e)||Va(e))))}function Ga(e){return!(Za(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Sa(e)||ka(e)||(e=>e>=57344&&e<=63743)(e)||Oa(e)||ja(e)||$a(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Xa(e){return e>=1424&&e<=2303||Fa(e)||qa(e)}function Ya(e,t){return!(!t&&Xa(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(e=>e>=6016&&e<=6143)(e))}function Wa(e){for(const t of e)if(Xa(t.charCodeAt(0)))return!0;return!1}let Ja,Ha,Qa,el;const tl={now:()=>void 0!==Qa?Qa:r.performance.now(),setNow(e){Qa=e},restoreNow(){Qa=void 0},frame(e){const t=r.requestAnimationFrame(e);return{cancel:()=>r.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:n,height:i}=e;el||(el=r.document.createElement("canvas"));const s=el.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return(n>el.width||i>el.height)&&(el.width=n,el.height=i),s.clearRect(-t,-t,n+2*t,i+2*t),s.drawImage(e,0,0,n,i),s.getImageData(-t,-t,n+2*t,i+2*t)},resolveURL:e=>(Ja||(Ja=r.document.createElement("a")),Ja.href=e,Ja.href),get devicePixelRatio(){return r.devicePixelRatio},get prefersReducedMotion(){return!!r.matchMedia&&(null==Ha&&(Ha=r.matchMedia("(prefers-reduced-motion: reduce)")),Ha.matches)}},rl="loading",nl="loaded";let il="unavailable",sl=null;function ol(){al.fire(new Event("pluginStateChange",{pluginStatus:il,pluginURL:sl}))}const al=new Evented,ll=function(){return il},ul=function(){if("deferred"!==il||!sl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");il=rl,ol(),sl&&wo({url:sl},(e=>{e?function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(il="error")}(e):(il=nl,ol())}))},cl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>il===nl||null!=cl.applyArabicShaping,isLoading:()=>il===rl,setState(e){il=e.pluginStatus,sl=e.pluginURL},isParsed:()=>null!=cl.applyArabicShaping&&null!=cl.processBidirectionalText&&null!=cl.processStyledBidirectionalText,getPluginURL:()=>sl};class EvaluationParameters{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ZoomHistory,this.transition={},this.pitch=0)}isSupportedScript(e){return function(e,t){for(const r of e)if(!Ya(r.charCodeAt(0),t))return!1;return!0}(e,cl.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}}}class PropertyValue{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Lt(e))return new StylePropertyFunction(e,t);if(Nt(e)){const r=Zt(e,t);if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return r.value}{let r=e;return"string"==typeof e&&"color"===t.type&&(r=z.parse(e)),{kind:"constant",evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class TransitionablePropertyValue{constructor(e){this.property=e,this.value=new PropertyValue(e,void 0)}transitioned(e,t){return new TransitioningPropertyValue(this.property,this.value,t,h({},e.transition,this.transition),e.now)}untransitioned(){return new TransitioningPropertyValue(this.property,this.value,null,{},0)}}class Transitionable{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return x(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new TransitionablePropertyValue(this._values[e].property)),this._values[e].value=new PropertyValue(this._values[e].property,null===t?void 0:x(t))}getTransition(e){return x(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new TransitionablePropertyValue(this._values[e].property)),this._values[e].transition=x(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n)}return e}transitioned(e,t){const r=new Transitioning(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,t._values[n]);return r}untransitioned(){const e=new Transitioning(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class TransitioningPropertyValue{constructor(e,t,r,n,i){const s=n.delay||0,o=n.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+s,this.end=this.begin+o,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),s=this.prior;if(s){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return s.possiblyEvaluate(e,t,r);{const o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(e,t,r),i,function(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}(o))}}return i}}class Transitioning{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const n=new PossiblyEvaluated(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Layout{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return x(this._values[e].value)}setValue(e,t){this._values[e]=new PropertyValue(this._values[e].property,null===t?void 0:x(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r){const n=new PossiblyEvaluated(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}}class PossiblyEvaluatedPropertyValue{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n)}}class PossiblyEvaluated{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class DataConstantProperty{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const n=je[this.specification.type];return n?n(e,t,r):e}}class DataDrivenProperty{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,n){return new PossiblyEvaluatedPropertyValue(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,n)}:e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new PossiblyEvaluatedPropertyValue(this,{kind:"constant",value:void 0},e.parameters);const n=je[this.specification.type];return n?new PossiblyEvaluatedPropertyValue(this,{kind:"constant",value:n(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,n,i,s){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,s)}}class CrossFadedDataDrivenProperty extends DataDrivenProperty{possiblyEvaluate(e,t,r,n){if(void 0===e.value)return new PossiblyEvaluatedPropertyValue(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const i=e.expression.evaluate(t,null,{},r,n),s="resolvedImage"===e.property.specification.type&&"string"!=typeof i?i.name:i,o=this._calculate(s,s,s,t);return new PossiblyEvaluatedPropertyValue(this,{kind:"constant",value:o},t)}if("camera"===e.expression.kind){const r=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new PossiblyEvaluatedPropertyValue(this,{kind:"constant",value:r},t)}return new PossiblyEvaluatedPropertyValue(this,e.expression,t)}evaluate(e,t,r,n,i,s){if("source"===e.kind){const o=e.evaluate(t,r,n,i,s);return this._calculate(o,o,o,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},r,n),e.evaluate({zoom:Math.floor(t.zoom)},r,n),e.evaluate({zoom:Math.floor(t.zoom)+1},r,n),t):e.value}_calculate(e,t,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t,other:r}:{from:r,to:t,other:e}}interpolate(e){return e}}class CrossFadedProperty{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){if(void 0!==e.value){if("constant"===e.expression.kind){const i=e.expression.evaluate(t,null,{},r,n);return this._calculate(i,i,i,t)}return this._calculate(e.expression.evaluate(new EvaluationParameters(Math.floor(t.zoom-1),t)),e.expression.evaluate(new EvaluationParameters(Math.floor(t.zoom),t)),e.expression.evaluate(new EvaluationParameters(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class ColorRampProperty{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}interpolate(){return!1}}class Properties{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new EvaluationParameters(0,{});for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new PropertyValue(n,void 0),s=this.defaultTransitionablePropertyValues[r]=new TransitionablePropertyValue(n);this.defaultTransitioningPropertyValues[r]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate(t)}}}function hl(e,t){return 256*(e=a(Math.floor(e),0,255))+a(Math.floor(t),0,255)}ko(DataDrivenProperty,"DataDrivenProperty"),ko(DataConstantProperty,"DataConstantProperty"),ko(CrossFadedDataDrivenProperty,"CrossFadedDataDrivenProperty"),ko(CrossFadedProperty,"CrossFadedProperty"),ko(ColorRampProperty,"ColorRampProperty");const pl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Struct{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class StructArray{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function dl(e,t=1){let r=0,n=0;return{members:e.map((e=>{const i=function(e){return pl[e].BYTES_PER_ELEMENT}(e.type),s=r=fl(r,Math.max(t,i)),o=e.components||1;return n=Math.max(n,i),r+=i*o,{name:e.name,type:e.type,components:o,offset:s}})),size:fl(r,Math.max(n,t)),alignment:t}}function fl(e,t){return Math.ceil(e/t)*t}class StructArrayLayout2i4 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=r,e}}StructArrayLayout2i4.prototype.bytesPerElement=4,ko(StructArrayLayout2i4,"StructArrayLayout2i4");class StructArrayLayout3i6 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}StructArrayLayout3i6.prototype.bytesPerElement=6,ko(StructArrayLayout3i6,"StructArrayLayout3i6");class StructArrayLayout4i8 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=4*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,e}}StructArrayLayout4i8.prototype.bytesPerElement=8,ko(StructArrayLayout4i8,"StructArrayLayout4i8");class StructArrayLayout2i4ub1f12 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s,o)}emplace(e,t,r,n,i,s,o,a){const l=6*e,u=12*e,c=3*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=i,this.uint8[u+6]=s,this.uint8[u+7]=o,this.float32[c+2]=a,e}}StructArrayLayout2i4ub1f12.prototype.bytesPerElement=12,ko(StructArrayLayout2i4ub1f12,"StructArrayLayout2i4ub1f12");class StructArrayLayout4f16 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=4*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=n,this.float32[s+3]=i,e}}StructArrayLayout4f16.prototype.bytesPerElement=16,ko(StructArrayLayout4f16,"StructArrayLayout4f16");class StructArrayLayout10ui20 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,r,n,i,s,o,a,l,u)}emplace(e,t,r,n,i,s,o,a,l,u,c){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=r,this.uint16[h+2]=n,this.uint16[h+3]=i,this.uint16[h+4]=s,this.uint16[h+5]=o,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=u,this.uint16[h+9]=c,e}}StructArrayLayout10ui20.prototype.bytesPerElement=20,ko(StructArrayLayout10ui20,"StructArrayLayout10ui20");class StructArrayLayout8ui16 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,r,n,i,s,o,a)}emplace(e,t,r,n,i,s,o,a,l){const u=8*e;return this.uint16[u+0]=t,this.uint16[u+1]=r,this.uint16[u+2]=n,this.uint16[u+3]=i,this.uint16[u+4]=s,this.uint16[u+5]=o,this.uint16[u+6]=a,this.uint16[u+7]=l,e}}StructArrayLayout8ui16.prototype.bytesPerElement=16,ko(StructArrayLayout8ui16,"StructArrayLayout8ui16");class StructArrayLayout6i12 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,o){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,this.int16[a+4]=s,this.int16[a+5]=o,e}}StructArrayLayout6i12.prototype.bytesPerElement=12,ko(StructArrayLayout6i12,"StructArrayLayout6i12");class StructArrayLayout4i4ui4i24 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,u,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,n,i,s,o,a,l,u,c,h)}emplace(e,t,r,n,i,s,o,a,l,u,c,h,p){const d=12*e;return this.int16[d+0]=t,this.int16[d+1]=r,this.int16[d+2]=n,this.int16[d+3]=i,this.uint16[d+4]=s,this.uint16[d+5]=o,this.uint16[d+6]=a,this.uint16[d+7]=l,this.int16[d+8]=u,this.int16[d+9]=c,this.int16[d+10]=h,this.int16[d+11]=p,e}}StructArrayLayout4i4ui4i24.prototype.bytesPerElement=24,ko(StructArrayLayout4i4ui4i24,"StructArrayLayout4i4ui4i24");class StructArrayLayout3i3f20 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,o){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.float32[l+2]=i,this.float32[l+3]=s,this.float32[l+4]=o,e}}StructArrayLayout3i3f20.prototype.bytesPerElement=20,ko(StructArrayLayout3i3f20,"StructArrayLayout3i3f20");class StructArrayLayout1ul4 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}StructArrayLayout1ul4.prototype.bytesPerElement=4,ko(StructArrayLayout1ul4,"StructArrayLayout1ul4");class StructArrayLayout5i4f1i1ul2ui40 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,u,c,h,p){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,r,n,i,s,o,a,l,u,c,h,p)}emplace(e,t,r,n,i,s,o,a,l,u,c,h,p,d){const f=20*e,y=10*e;return this.int16[f+0]=t,this.int16[f+1]=r,this.int16[f+2]=n,this.int16[f+3]=i,this.int16[f+4]=s,this.float32[y+3]=o,this.float32[y+4]=a,this.float32[y+5]=l,this.float32[y+6]=u,this.int16[f+14]=c,this.uint32[y+8]=h,this.uint16[f+18]=p,this.uint16[f+19]=d,e}}StructArrayLayout5i4f1i1ul2ui40.prototype.bytesPerElement=40,ko(StructArrayLayout5i4f1i1ul2ui40,"StructArrayLayout5i4f1i1ul2ui40");class StructArrayLayout3i2i2i16 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s,o)}emplace(e,t,r,n,i,s,o,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+4]=i,this.int16[l+5]=s,this.int16[l+6]=o,this.int16[l+7]=a,e}}StructArrayLayout3i2i2i16.prototype.bytesPerElement=16,ko(StructArrayLayout3i2i2i16,"StructArrayLayout3i2i2i16");class StructArrayLayout2f1f2i16 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){const o=4*e,a=8*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.int16[a+6]=i,this.int16[a+7]=s,e}}StructArrayLayout2f1f2i16.prototype.bytesPerElement=16,ko(StructArrayLayout2f1f2i16,"StructArrayLayout2f1f2i16");class StructArrayLayout2ub2f12 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=12*e,o=3*e;return this.uint8[s+0]=t,this.uint8[s+1]=r,this.float32[o+1]=n,this.float32[o+2]=i,e}}StructArrayLayout2ub2f12.prototype.bytesPerElement=12,ko(StructArrayLayout2ub2f12,"StructArrayLayout2ub2f12");class StructArrayLayout3f12 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=r,this.float32[i+2]=n,e}}StructArrayLayout3f12.prototype.bytesPerElement=12,ko(StructArrayLayout3f12,"StructArrayLayout3f12");class StructArrayLayout3ui6 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,this.uint16[i+2]=n,e}}StructArrayLayout3ui6.prototype.bytesPerElement=6,ko(StructArrayLayout3ui6,"StructArrayLayout3ui6");class StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,u,c,h,p,d,f,y,m,g,x,v,b){const w=this.length;return this.resize(w+1),this.emplace(w,e,t,r,n,i,s,o,a,l,u,c,h,p,d,f,y,m,g,x,v,b)}emplace(e,t,r,n,i,s,o,a,l,u,c,h,p,d,f,y,m,g,x,v,b,w){const _=30*e,S=15*e,A=60*e;return this.int16[_+0]=t,this.int16[_+1]=r,this.int16[_+2]=n,this.float32[S+2]=i,this.float32[S+3]=s,this.uint16[_+8]=o,this.uint16[_+9]=a,this.uint32[S+5]=l,this.uint32[S+6]=u,this.uint32[S+7]=c,this.uint16[_+16]=h,this.uint16[_+17]=p,this.uint16[_+18]=d,this.float32[S+10]=f,this.float32[S+11]=y,this.uint8[A+48]=m,this.uint8[A+49]=g,this.uint8[A+50]=x,this.uint32[S+13]=v,this.int16[_+28]=b,this.uint8[A+58]=w,e}}StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60.prototype.bytesPerElement=60,ko(StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class StructArrayLayout3i2f6i15ui1ul3f76 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,u,c,h,p,d,f,y,m,g,x,v,b,w,_,S,A,k,I,P,T,C){const E=this.length;return this.resize(E+1),this.emplace(E,e,t,r,n,i,s,o,a,l,u,c,h,p,d,f,y,m,g,x,v,b,w,_,S,A,k,I,P,T,C)}emplace(e,t,r,n,i,s,o,a,l,u,c,h,p,d,f,y,m,g,x,v,b,w,_,S,A,k,I,P,T,C,E){const M=38*e,D=19*e;return this.int16[M+0]=t,this.int16[M+1]=r,this.int16[M+2]=n,this.float32[D+2]=i,this.float32[D+3]=s,this.int16[M+8]=o,this.int16[M+9]=a,this.int16[M+10]=l,this.int16[M+11]=u,this.int16[M+12]=c,this.int16[M+13]=h,this.uint16[M+14]=p,this.uint16[M+15]=d,this.uint16[M+16]=f,this.uint16[M+17]=y,this.uint16[M+18]=m,this.uint16[M+19]=g,this.uint16[M+20]=x,this.uint16[M+21]=v,this.uint16[M+22]=b,this.uint16[M+23]=w,this.uint16[M+24]=_,this.uint16[M+25]=S,this.uint16[M+26]=A,this.uint16[M+27]=k,this.uint16[M+28]=I,this.uint32[D+15]=P,this.float32[D+16]=T,this.float32[D+17]=C,this.float32[D+18]=E,e}}StructArrayLayout3i2f6i15ui1ul3f76.prototype.bytesPerElement=76,ko(StructArrayLayout3i2f6i15ui1ul3f76,"StructArrayLayout3i2f6i15ui1ul3f76");class StructArrayLayout1f4 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}StructArrayLayout1f4.prototype.bytesPerElement=4,ko(StructArrayLayout1f4,"StructArrayLayout1f4");class StructArrayLayout7f28 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s,o)}emplace(e,t,r,n,i,s,o,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=s,this.float32[l+5]=o,this.float32[l+6]=a,e}}StructArrayLayout7f28.prototype.bytesPerElement=28,ko(StructArrayLayout7f28,"StructArrayLayout7f28");class StructArrayLayout5f20 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){const o=5*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,this.float32[o+4]=s,e}}StructArrayLayout5f20.prototype.bytesPerElement=20,ko(StructArrayLayout5f20,"StructArrayLayout5f20");class StructArrayLayout1ul3ui12 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=6*e;return this.uint32[3*e+0]=t,this.uint16[s+2]=r,this.uint16[s+3]=n,this.uint16[s+4]=i,e}}StructArrayLayout1ul3ui12.prototype.bytesPerElement=12,ko(StructArrayLayout1ul3ui12,"StructArrayLayout1ul3ui12");class StructArrayLayout2ui4 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,e}}StructArrayLayout2ui4.prototype.bytesPerElement=4,ko(StructArrayLayout2ui4,"StructArrayLayout2ui4");class StructArrayLayout1ui2 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}StructArrayLayout1ui2.prototype.bytesPerElement=2,ko(StructArrayLayout1ui2,"StructArrayLayout1ui2");class StructArrayLayout2f8 extends StructArray{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=r,e}}StructArrayLayout2f8.prototype.bytesPerElement=8,ko(StructArrayLayout2f8,"StructArrayLayout2f8");class FillExtrusionExtStruct extends Struct{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}FillExtrusionExtStruct.prototype.size=12;class FillExtrusionExtArray extends StructArrayLayout6i12{get(e){return new FillExtrusionExtStruct(this,e)}}ko(FillExtrusionExtArray,"FillExtrusionExtArray");class CollisionBoxStruct extends Struct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}CollisionBoxStruct.prototype.size=40;class CollisionBoxArray extends StructArrayLayout5i4f1i1ul2ui40{get(e){return new CollisionBoxStruct(this,e)}}ko(CollisionBoxArray,"CollisionBoxArray");class PlacedSymbolStruct extends Struct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}PlacedSymbolStruct.prototype.size=60;class PlacedSymbolArray extends StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60{get(e){return new PlacedSymbolStruct(this,e)}}ko(PlacedSymbolArray,"PlacedSymbolArray");class SymbolInstanceStruct extends Struct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}SymbolInstanceStruct.prototype.size=76;class SymbolInstanceArray extends StructArrayLayout3i2f6i15ui1ul3f76{get(e){return new SymbolInstanceStruct(this,e)}}ko(SymbolInstanceArray,"SymbolInstanceArray");class GlyphOffsetArray extends StructArrayLayout1f4{getoffsetX(e){return this.float32[1*e+0]}}ko(GlyphOffsetArray,"GlyphOffsetArray");class SymbolLineVertexArray extends StructArrayLayout3i6{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ko(SymbolLineVertexArray,"SymbolLineVertexArray");class FeatureIndexStruct extends Struct{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}FeatureIndexStruct.prototype.size=12;class FeatureIndexArray extends StructArrayLayout1ul3ui12{get(e){return new FeatureIndexStruct(this,e)}}ko(FeatureIndexArray,"FeatureIndexArray");class FillExtrusionCentroidStruct extends Struct{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}FillExtrusionCentroidStruct.prototype.size=4;class FillExtrusionCentroidArray extends StructArrayLayout2ui4{get(e){return new FillExtrusionCentroidStruct(this,e)}}ko(FillExtrusionCentroidArray,"FillExtrusionCentroidArray");class CircleGlobeExtStruct extends Struct{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}CircleGlobeExtStruct.prototype.size=12;class CircleGlobeExtArray extends StructArrayLayout6i12{get(e){return new CircleGlobeExtStruct(this,e)}}ko(CircleGlobeExtArray,"CircleGlobeExtArray");const yl=dl([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ml=dl([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var gl=M((function(e){e.exports=function(e,t){var r,n,i,s,o,a,l,u;for(n=e.length-(r=3&e.length),i=t,o=3432918353,a=461845907,u=0;u<n;)l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,i=27492+(65535&(s=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),xl=M((function(e){e.exports=function(e,t){for(var r,n=e.length,i=t^n,s=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(s)|(255&e.charCodeAt(++s))<<8|(255&e.charCodeAt(++s))<<16|(255&e.charCodeAt(++s))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:i^=(255&e.charCodeAt(s+2))<<16;case 2:i^=(255&e.charCodeAt(s+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(s)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),vl=gl,bl=xl;vl.murmur3=gl,vl.murmur2=bl;class FeaturePositionMap{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,r,n){this.ids.push(wl(e)),this.positions.push(t,r,n)}getPositions(e){const t=wl(e);let r=0,n=this.ids.length-1;for(;r<n;){const e=r+n>>1;this.ids[e]>=t?n=e:r=e+1}const i=[];for(;this.ids[r]===t;)i.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return i}static serialize(e,t){const r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return _l(r,n,0,r.length-1),t&&t.push(r.buffer,n.buffer),{ids:r,positions:n}}static deserialize(e){const t=new FeaturePositionMap;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function wl(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:vl(String(e))}function _l(e,t,r,n){for(;r<n;){const i=e[r+n>>1];let s=r-1,o=n+1;for(;;){do{s++}while(e[s]<i);do{o--}while(e[o]>i);if(s>=o)break;Sl(e,s,o),Sl(t,3*s,3*o),Sl(t,3*s+1,3*o+1),Sl(t,3*s+2,3*o+2)}o-r<n-o?(_l(e,t,r,o),r=o+1):(_l(e,t,o+1,n),n=o)}}function Sl(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}ko(FeaturePositionMap,"FeaturePositionMap");class Uniform{constructor(e,t){this.gl=e.gl,this.location=t}}class Uniform1f extends Uniform{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Uniform4f extends Uniform{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class UniformColor extends Uniform{constructor(e,t){super(e,t),this.current=z.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}function Al(e){return[hl(255*e.r,255*e.g),hl(255*e.b,255*e.a)]}class ConstantBinder{constructor(e,t,r){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=r}setUniform(e,t,r){e.set(r.constantOr(this.value))}getBinding(e,t,r){return"color"===this.type?new UniformColor(e,t):new Uniform1f(e,t)}}class CrossFadedConstantBinder{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,r,n){const i="u_pattern_to"===n||"u_dash_to"===n?this.patternTo:"u_pattern_from"===n||"u_dash_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;i&&e.set(i)}getBinding(e,t,r){return"u_pattern_from"===r||"u_pattern_to"===r||"u_dash_from"===r||"u_dash_to"===r?new Uniform4f(e,t):new Uniform1f(e,t)}}class SourceExpressionBinder{constructor(e,t,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(e,t,r,n,i,s){const o=this.paintVertexArray.length,a=this.expression.evaluate(new EvaluationParameters(0),t,{},i,n,s);this.paintVertexArray.resize(e),this._setPaintValue(o,e,a)}updatePaintArray(e,t,r,n,i){const s=this.expression.evaluate({zoom:0},r,n,void 0,i);this._setPaintValue(e,t,s)}_setPaintValue(e,t,r){if("color"===this.type){const n=Al(r);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class CompositeExpressionBinder{constructor(e,t,r,n,i,s){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0}))),this.paintVertexArray=new s}populatePaintArray(e,t,r,n,i,s){const o=this.expression.evaluate(new EvaluationParameters(this.zoom),t,{},i,n,s),a=this.expression.evaluate(new EvaluationParameters(this.zoom+1),t,{},i,n,s),l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(l,e,o,a)}updatePaintArray(e,t,r,n,i){const s=this.expression.evaluate({zoom:this.zoom},r,n,void 0,i),o=this.expression.evaluate({zoom:this.zoom+1},r,n,void 0,i);this._setPaintValue(e,t,s,o)}_setPaintValue(e,t,r,n){if("color"===this.type){const i=Al(r),s=Al(n);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1],s[0],s[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,n=a(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(n)}getBinding(e,t,r){return new Uniform1f(e,t)}}class CrossFadedCompositeBinder{constructor(e,t,r,n,i,s,o){this.expression=e,this.type=r,this.useIntegerZoom=n,this.zoom=i,this.layerId=o,this.paintVertexAttributes=("array"===r?ml:yl).members;for(let e=0;e<t.length;++e);this.zoomInPaintVertexArray=new s,this.zoomOutPaintVertexArray=new s}populatePaintArray(e,t,r){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,n,i,s){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],s)}_setPaintValues(e,t,r,n){if(!n||!r)return;const{min:i,mid:s,max:o}=r,a=n[i],l=n[s],u=n[o];if(a&&l&&u)for(let r=e;r<t;r++)this._setPaintValue(this.zoomInPaintVertexArray,r,l,a),this._setPaintValue(this.zoomOutPaintVertexArray,r,l,u)}_setPaintValue(e,t,r,n){e.emplace(t,r.tl[0],r.tl[1],r.br[0],r.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],r.pixelRatio,n.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ProgramConfiguration{constructor(e,t,r=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const i in e.paint._values){if(!r(i))continue;const s=e.paint.get(i);if(!(s instanceof PossiblyEvaluatedPropertyValue&&Dt(s.property.specification)))continue;const o=Il(i,e.type),a=s.value,l=s.property.specification.type,u=s.property.useIntegerZoom,c=s.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c,p="line-dasharray"===String(i)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||p)if("source"===a.kind||p||h){const r=Cl(i,l,"source");this.binders[i]=h?new CrossFadedCompositeBinder(a,o,l,u,t,r,e.id):new SourceExpressionBinder(a,o,l,r),n.push(`/a_${i}`)}else{const e=Cl(i,l,"composite");this.binders[i]=new CompositeExpressionBinder(a,o,l,u,t,e),n.push(`/z_${i}`)}else this.binders[i]=h?new CrossFadedConstantBinder(a.value,o):new ConstantBinder(a.value,o,l),n.push(`/u_${i}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof SourceExpressionBinder||t instanceof CompositeExpressionBinder?t.maxValue:0}populatePaintArrays(e,t,r,n,i,s){for(const o in this.binders){const a=this.binders[o];(a instanceof SourceExpressionBinder||a instanceof CompositeExpressionBinder||a instanceof CrossFadedCompositeBinder)&&a.populatePaintArray(e,t,r,n,i,s)}}setConstantPatternPositions(e,t){for(const r in this.binders){const n=this.binders[r];n instanceof CrossFadedConstantBinder&&n.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,r,n,i,s){let o=!1;for(const a in e){const l=t.getPositions(a);for(const t of l){const l=r.feature(t.index);for(const r in this.binders){const u=this.binders[r];if((u instanceof SourceExpressionBinder||u instanceof CompositeExpressionBinder||u instanceof CrossFadedCompositeBinder)&&!0===u.expression.isStateDependent){const c=n.paint.get(r);u.expression=c.value,u.updatePaintArray(t.start,t.end,l,e[a],i,s),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof ConstantBinder||r instanceof CrossFadedConstantBinder)&&e.push(...r.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof SourceExpressionBinder||r instanceof CompositeExpressionBinder||r instanceof CrossFadedCompositeBinder)for(let t=0;t<r.paintVertexAttributes.length;t++)e.push(r.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof ConstantBinder||r instanceof CrossFadedConstantBinder||r instanceof CompositeExpressionBinder)for(const t of r.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const r=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof ConstantBinder||i instanceof CrossFadedConstantBinder||i instanceof CompositeExpressionBinder)for(const s of i.uniformNames)if(t[s]){const o=i.getBinding(e,t[s],s);r.push({name:s,property:n,binding:o})}}return r}setUniforms(e,t,r,n){for(const{name:e,property:i,binding:s}of t)this.binders[i].setUniform(s,n,r.get(i),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const r=this.binders[t];if(e&&r instanceof CrossFadedCompositeBinder){const t=2===e.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(r instanceof SourceExpressionBinder||r instanceof CompositeExpressionBinder)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof SourceExpressionBinder||r instanceof CompositeExpressionBinder||r instanceof CrossFadedCompositeBinder)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof SourceExpressionBinder||t instanceof CompositeExpressionBinder||t instanceof CrossFadedCompositeBinder)&&t.destroy()}}}class ProgramConfigurationSet{constructor(e,t,r=(()=>!0)){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new ProgramConfiguration(n,t,r);this.needsUpload=!1,this._featureMap=new FeaturePositionMap,this._bufferOffset=0}populatePaintArrays(e,t,r,n,i,s,o){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,t,n,i,s,o);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,n,i){for(const s of r)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,t,s,n,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const kl={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Il(e,t){return kl[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Pl={"line-pattern":{source:StructArrayLayout10ui20,composite:StructArrayLayout10ui20},"fill-pattern":{source:StructArrayLayout10ui20,composite:StructArrayLayout10ui20},"fill-extrusion-pattern":{source:StructArrayLayout10ui20,composite:StructArrayLayout10ui20},"line-dasharray":{source:StructArrayLayout8ui16,composite:StructArrayLayout8ui16}},Tl={color:{source:StructArrayLayout2f8,composite:StructArrayLayout4f16},number:{source:StructArrayLayout1f4,composite:StructArrayLayout2f8}};function Cl(e,t,r){const n=Pl[e];return n&&n[r]||Tl[t][r]}ko(ConstantBinder,"ConstantBinder"),ko(CrossFadedConstantBinder,"CrossFadedConstantBinder"),ko(SourceExpressionBinder,"SourceExpressionBinder"),ko(CrossFadedCompositeBinder,"CrossFadedCompositeBinder"),ko(CompositeExpressionBinder,"CompositeExpressionBinder"),ko(ProgramConfiguration,"ProgramConfiguration",{omit:["_buffers"]}),ko(ProgramConfigurationSet,"ProgramConfigurationSet");const El="-transition";class StyleLayer extends Evented{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Layout(t.layout)),t.paint)){this._transitionablePaint=new Transitionable(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new PossiblyEvaluated(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){null!=t&&this._validate(ya,`layers.${this.id}.layout.${e}`,e,t,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return m(e,El)?this._transitionablePaint.getTransition(e.slice(0,-El.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(null!=t&&this._validate(fa,`layers.${this.id}.paint.${e}`,e,t,r))return!1;if(m(e,El))return this._transitionablePaint.setTransition(e.slice(0,-El.length),t||void 0),!1;{const r=this._transitionablePaint._values[e],n="cross-faded-data-driven"===r.property.specification["property-type"],i=r.value.isDataDriven(),s=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value;return o.isDataDriven()||i||n||this._handleOverridablePaintPropertyUpdate(e,s,o)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),function(e,t,r){const n={};for(const r in e)t.call(this,e[r],r,e)&&(n[r]=e[r]);return n}(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,r,n,i={}){return(!i||!1!==i.validate)&&function(e,t){let r=!1;if(t&&t.length)for(const n of t)e.fire(new ErrorEvent(new Error(n.message))),r=!0;return r}(this,e.call(da,{key:t,layerType:this.type,objectKey:r,value:n,styleSpec:Do,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof PossiblyEvaluatedPropertyValue&&Dt(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ko(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Ml=dl([{name:"a_pos",components:2,type:"Int16"}],4),Dl=dl([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class SegmentVector{constructor(e=[]){this.segments=e}prepareSegment(e,t,r,n){let i=this.segments[this.segments.length-1];return e>SegmentVector.MAX_VERTEX_ARRAY_LENGTH&&b(`Max vertices per segment is ${SegmentVector.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!i||i.vertexLength+e>SegmentVector.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,n){return new SegmentVector([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}SegmentVector.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ko(SegmentVector,"SegmentVector");var zl=8192;class LngLatBounds{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof LngLat?new LngLat(e.lng,e.lat):LngLat.convert(e),this}setSouthWest(e){return this._sw=e instanceof LngLat?new LngLat(e.lng,e.lat):LngLat.convert(e),this}extend(e){const t=this._sw,r=this._ne;let n,i;if(e instanceof LngLat)n=e,i=e;else{if(!(e instanceof LngLatBounds))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(LngLatBounds.convert(e)):this.extend(LngLat.convert(e)):this;if(n=e._sw,i=e._ne,!n||!i)return this}return t||r?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new LngLat(n.lng,n.lat),this._ne=new LngLat(i.lng,i.lat)),this}getCenter(){return new LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=LngLat.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){return!e||e instanceof LngLatBounds?e:new LngLatBounds(e)}}const Bl=6371008.8;class LngLat{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new LngLat(l(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,r=this.lat*t,n=e.lat*t,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return Bl*Math.acos(Math.min(i,1))}toBounds(e=0){const t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new LngLatBounds(new LngLat(this.lng-r,this.lat-t),new LngLat(this.lng+r,this.lat+t))}static convert(e){if(e instanceof LngLat)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new LngLat(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new LngLat(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Vl=2*Math.PI*Bl;function Ll(e){return Vl*Math.cos(e*Math.PI/180)}function Fl(e){return(180+e)/360}function Rl(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Ol(e,t){return e/Ll(t)}function jl(e){return 360*e-180}function ql(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}const $l=85.051129;class MercatorCoordinate{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){const r=LngLat.convert(e);return new MercatorCoordinate(Fl(r.lng),Rl(r.lat),Ol(t,r.lat))}toLngLat(){return new LngLat(jl(this.x),ql(this.y))}toAltitude(){return this.z*Ll(ql(this.y))}meterInMercatorCoordinateUnits(){return 1/Vl*(e=ql(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ul(t,r,n,i,s,o,a,l,u){const c=(r+i)/2,h=(n+s)/2,p=new e(c,h);l(p),function(e,t,r,n,i,s){const o=r-i,a=n-s;return Math.abs((n-t)*o-(r-e)*a)/Math.hypot(o,a)}(p.x,p.y,o.x,o.y,a.x,a.y)>=u?(Ul(t,r,n,c,h,o,p,l,u),Ul(t,c,h,i,s,p,a,l,u)):t.push(a)}function Nl(e,t,r){let n=e[0],i=n.x,s=n.y;t(n);const o=[n];for(let a=1;a<e.length;a++){const l=e[a],{x:u,y:c}=l;t(l),Ul(o,i,s,u,c,n,l,t,r),i=u,s=c,n=l}return o}function Kl(e,t,r,n,i){if(i(t,r)){const s=t.add(r).mult(.5);n(s),Kl(e,t,s,n,i),Kl(e,s,r,n,i)}else e.push(r)}function Zl(e,t,r){let n=e[0];t(n);const i=[n];for(let s=1;s<e.length;s++){const o=e[s];t(o),Kl(i,n,o,t,r),n=o}return i}const Gl=Math.pow(2,14)-1,Xl=-Gl-1;function Yl(e,t){const r=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=a(r,Xl,Gl),e.y=a(n,Xl,Gl),(r<e.x||r>e.x+1||n<e.y||n>e.y+1)&&b("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Wl(e,t,r){const n=e.loadGeometry(),i=e.extent,s=zl/i;if(t&&r&&r.projection.isReprojectedInTileSpace){const s=1<<t.z,{scale:o,x:a,y:l,projection:u}=r,c=e=>{const r=jl((t.x+e.x/i)/s),n=ql((t.y+e.y/i)/s),c=u.project(r,n);e.x=(c.x*o-a)*i,e.y=(c.y*o-l)*i};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=Nl(n[t],c,1);else{const e=[];for(const r of n[t])r.x<0||r.x>=i||r.y<0||r.y>=i||(c(r),e.push(r));n[t]=e}}for(const e of n)for(const t of e)Yl(t,s);return n}function Jl(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Wl(e):[]}}function Hl(e,t,r,n,i){e.emplaceBack(2*t+(n+1)/2,2*r+(i+1)/2)}function Ql(e,t,r){const n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}class CircleBucket{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new StructArrayLayout2i4,this.indexArray=new StructArrayLayout3ui6,this.segments=new SegmentVector,this.programConfigurations=new ProgramConfigurationSet(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,n){const i=this.layers[0],s=[];let o=null;"circle"===i.type&&(o=i.layout.get("circle-sort-key"));for(const{feature:t,id:i,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Jl(t,e);if(!this.layers[0]._featureFilter.filter(new EvaluationParameters(this.zoom),u,r))continue;const c=o?o.evaluate(u,{},r):void 0,h={id:i,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?u.geometry:Wl(t,r,n),patterns:{},sortKey:c};s.push(h)}o&&s.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new CircleGlobeExtArray,a=n.projection);for(const n of s){const{geometry:i,index:s,sourceLayerIndex:o}=n,l=e[s].feature;this.addFeature(n,i,s,t.availableImages,r,a),t.featureIndex.insert(l,i,s,o,this.index)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ml.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Dl.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,r,n,i,s){for(const r of t)for(const t of r){const r=t.x,n=t.y;if(r<0||r>=zl||n<0||n>=zl)continue;if(s){const e=s.projectTilePoint(r,n,i),t=s.upVector(i,r,n),o=this.globeExtVertexArray;Ql(o,e,t),Ql(o,e,t),Ql(o,e,t),Ql(o,e,t)}const o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=o.vertexLength;Hl(this.layoutVertexArray,r,n,-1,-1),Hl(this.layoutVertexArray,r,n,1,-1),Hl(this.layoutVertexArray,r,n,1,1),Hl(this.layoutVertexArray,r,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),o.vertexLength+=4,o.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,i)}}function eu(e,t){for(let r=0;r<e.length;r++)if(uu(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(uu(e,t[r]))return!0;return!!iu(e,t)}function tu(e,t,r){return!!uu(e,t)||!!ou(t,e,r)}function ru(e,t){if(1===e.length)return lu(t,e[0]);for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length;t++)if(uu(e,n[t]))return!0}for(let r=0;r<e.length;r++)if(lu(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(iu(e,t[r]))return!0;return!1}function nu(e,t,r){if(e.length>1){if(iu(e,t))return!0;for(let n=0;n<t.length;n++)if(ou(t[n],e,r))return!0}for(let n=0;n<e.length;n++)if(ou(e[n],t,r))return!0;return!1}function iu(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)if(su(n,i,t[e],t[e+1]))return!0}return!1}function su(e,t,r,n){return w(e,r,n)!==w(t,r,n)&&w(e,t,r)!==w(e,t,n)}function ou(e,t,r){const n=r*r;if(1===t.length)return e.distSqr(t[0])<n;for(let r=1;r<t.length;r++)if(au(e,t[r-1],t[r])<n)return!0;return!1}function au(e,t,r){const n=t.distSqr(r);if(0===n)return e.distSqr(t);const i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return e.distSqr(i<0?t:i>1?r:r.sub(t)._mult(i)._add(t))}function lu(e,t){let r,n,i,s=!1;for(let o=0;o<e.length;o++){r=e[o];for(let e=0,o=r.length-1;e<r.length;o=e++)n=r[e],i=r[o],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(s=!s)}return s}function uu(e,t){let r=!1;for(let n=0,i=e.length-1;n<e.length;i=n++){const s=e[n],o=e[i];s.y>t.y!=o.y>t.y&&t.x<(o.x-s.x)*(t.y-s.y)/(o.y-s.y)+s.x&&(r=!r)}return r}function cu(e,t,r){const n=r[0],i=r[2];if(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y)return!1;const s=w(e,t,r[0]);return s!==w(e,t,r[1])||s!==w(e,t,r[2])||s!==w(e,t,r[3])}function hu(e,t,r){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function pu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function du(t,r,n,i,s){if(!r[0]&&!r[1])return t;const o=e.convert(r)._mult(s);"viewport"===n&&o._rotate(-i);const a=[];for(let e=0;e<t.length;e++)a.push(t[e].sub(o));return a}function fu(t,r,n,i){const s=e.convert(t)._mult(i);return"viewport"===r&&s._rotate(-n),s}ko(CircleBucket,"CircleBucket",{omit:["layers"]});const yu=new Properties({"circle-sort-key":new DataDrivenProperty(Do.layout_circle["circle-sort-key"])});var mu={paint:new Properties({"circle-radius":new DataDrivenProperty(Do.paint_circle["circle-radius"]),"circle-color":new DataDrivenProperty(Do.paint_circle["circle-color"]),"circle-blur":new DataDrivenProperty(Do.paint_circle["circle-blur"]),"circle-opacity":new DataDrivenProperty(Do.paint_circle["circle-opacity"]),"circle-translate":new DataConstantProperty(Do.paint_circle["circle-translate"]),"circle-translate-anchor":new DataConstantProperty(Do.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new DataConstantProperty(Do.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new DataConstantProperty(Do.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new DataDrivenProperty(Do.paint_circle["circle-stroke-width"]),"circle-stroke-color":new DataDrivenProperty(Do.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new DataDrivenProperty(Do.paint_circle["circle-stroke-opacity"])}),layout:yu},gu=1e-6,xu="undefined"!=typeof Float32Array?Float32Array:Array;function vu(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bu(e,t,r){var n=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],p=t[9],d=t[10],f=t[11],y=t[12],m=t[13],g=t[14],x=t[15],v=r[0],b=r[1],w=r[2],_=r[3];return e[0]=v*n+b*a+w*h+_*y,e[1]=v*i+b*l+w*p+_*m,e[2]=v*s+b*u+w*d+_*g,e[3]=v*o+b*c+w*f+_*x,e[4]=(v=r[4])*n+(b=r[5])*a+(w=r[6])*h+(_=r[7])*y,e[5]=v*i+b*l+w*p+_*m,e[6]=v*s+b*u+w*d+_*g,e[7]=v*o+b*c+w*f+_*x,e[8]=(v=r[8])*n+(b=r[9])*a+(w=r[10])*h+(_=r[11])*y,e[9]=v*i+b*l+w*p+_*m,e[10]=v*s+b*u+w*d+_*g,e[11]=v*o+b*c+w*f+_*x,e[12]=(v=r[12])*n+(b=r[13])*a+(w=r[14])*h+(_=r[15])*y,e[13]=v*i+b*l+w*p+_*m,e[14]=v*s+b*u+w*d+_*g,e[15]=v*o+b*c+w*f+_*x,e}function wu(e,t,r){var n,i,s,o,a,l,u,c,h,p,d,f,y=r[0],m=r[1],g=r[2];return t===e?(e[12]=t[0]*y+t[4]*m+t[8]*g+t[12],e[13]=t[1]*y+t[5]*m+t[9]*g+t[13],e[14]=t[2]*y+t[6]*m+t[10]*g+t[14],e[15]=t[3]*y+t[7]*m+t[11]*g+t[15]):(i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],p=t[9],d=t[10],f=t[11],e[0]=n=t[0],e[1]=i,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=p,e[10]=d,e[11]=f,e[12]=n*y+a*m+h*g+t[12],e[13]=i*y+l*m+p*g+t[13],e[14]=s*y+u*m+d*g+t[14],e[15]=o*y+c*m+f*g+t[15]),e}function _u(e,t,r){var n=r[0],i=r[1],s=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Su(){var e=new xu(3);return xu!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Au(e){var t=new xu(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ku(e){return Math.hypot(e[0],e[1],e[2])}function Iu(e,t,r){var n=new xu(3);return n[0]=e,n[1]=t,n[2]=r,n}function Pu(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Tu(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Cu(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function Eu(e,t){var r=t[0],n=t[1],i=t[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function Mu(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Du(e,t,r){var n=t[0],i=t[1],s=t[2],o=r[3]*n+r[7]*i+r[11]*s+r[15];return e[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/(o=o||1),e[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/o,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var zu,Bu=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e};function Vu(e,t,r){var n=t[0],i=t[1],s=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*o,e}function Lu(){var e=new xu(4);return xu!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Su(),function(){var e;e=new xu(4),xu!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}(),Su(),Iu(1,0,0),Iu(0,1,0),Lu(),Lu(),zu=new xu(9),xu!=Float32Array&&(zu[1]=0,zu[2]=0,zu[3]=0,zu[5]=0,zu[6]=0,zu[7]=0),zu[0]=1,zu[4]=1,zu[8]=1;class Ray{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){const n=Mu(t,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,r[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(e,t,r){if(function(e,t){var r=e[0],n=e[1],i=e[2],s=t[0],o=t[1],a=t[2];return Math.abs(r-s)<=gu*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=gu*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=gu*Math.max(1,Math.abs(i),Math.abs(a))}(this.pos,e)||0===t)return r[0]=r[1]=r[2]=0,!1;const[n,i,s]=this.dir,o=this.pos[0]-e[0],a=this.pos[1]-e[1],l=this.pos[2]-e[2],u=n*n+i*i+s*s,c=2*(o*n+a*i+l*s),h=c*c-4*u*(o*o+a*a+l*l-t*t);if(h<0){const e=Math.max(-c/2,0),u=o+n*e,h=a+i*e,p=l+s*e,d=Math.hypot(u,h,p);return r[0]=u*t/d,r[1]=h*t/d,r[2]=p*t/d,!1}{const e=(-c-Math.sqrt(h))/(2*u);if(e<0){const e=Math.hypot(o,a,l);return r[0]=o*t/e,r[1]=a*t/e,r[2]=l*t/e,!1}return r[0]=o+n*e,r[1]=a+i*e,r[2]=l+s*e,!0}}}class Aabb{constructor(e,t){this.min=e,this.max=t,this.center=Tu([],Pu([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],r=Au(this.min),n=Au(this.max);for(let e=0;e<t.length;e++)r[e]=t[e]?this.min[e]:this.center[e],n[e]=t[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new Aabb(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let r=!0;for(let n=0;n<e.planes.length;n++){const i=e.planes[n];let s=0;for(let e=0;e<t.length;e++)s+=Mu(i,t[e])+i[3]>=0;if(0===s)return 0;s!==t.length&&(r=!1)}if(r)return 2;for(let t=0;t<3;t++){let r=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let i=0;i<e.points.length;i++){const s=e.points[i][t]-this.min[t];r=Math.min(r,s),n=Math.max(n,s)}if(n<0||r>this.max[t]-this.min[t])return 0}return 1}}function Fu(e,t,r,n,i,s,o,a,l){if(s&&e.queryGeometry.isAboveHorizon)return!1;s&&(l*=e.pixelToTileUnitsFactor);const u=e.tileID.canonical,c=r.projection.upVectorScale(u,r.center.lat,r.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),p=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(h.x,h.y,!0):0,d=r.projection.projectTilePoint(h.x,h.y,u);if(p>0){const e=r.projection.upVector(u,h.x,h.y);d.x+=e[0]*c*p,d.y+=e[1]*c*p,d.z+=e[2]*c*p}const f=s?h:Ru(d.x,d.y,d.z,n),y=s?e.tilespaceRays.map((e=>qu(e,p))):e.queryGeometry.screenGeometry,m=Vu([],[d.x,d.y,d.z,1],n);if(!o&&s?l*=m[3]/r.cameraToCenterDistance:o&&!s&&(l*=r.cameraToCenterDistance/m[3]),s){const e=ql((t.y/zl+u.y)/(1<<u.z));l/=r.projection.pixelsPerMeter(e,1)/Ol(1,e)}if(tu(y,f,l))return!0}return!1}function Ru(t,r,n,i){const s=Vu([],[t,r,n,1],i);return new e(s[0]/s[3],s[1]/s[3])}const Ou=Iu(0,0,0),ju=Iu(0,0,1);function qu(t,r){const n=Su();return Ou[2]=r,t.intersectsPlane(Ou,ju,n),new e(n[0],n[1])}class HeatmapBucket extends CircleBucket{}function $u(e,{width:t,height:r},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*r*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(t*r*n);return e.width=t,e.height=r,e.data=i,e}function Uu(e,t,r){const{width:n,height:i}=t;n===e.width&&i===e.height||(Nu(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r),e.width=n,e.height=i,e.data=t.data)}function Nu(e,t,r,n,i,s){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const o=e.data,a=t.data;for(let l=0;l<i.height;l++){const u=((r.y+l)*e.width+r.x)*s,c=((n.y+l)*t.width+n.x)*s;for(let e=0;e<i.width*s;e++)a[c+e]=o[u+e]}return t}ko(HeatmapBucket,"HeatmapBucket",{omit:["layers"]});class AlphaImage{constructor(e,t){$u(this,e,1,t)}resize(e){Uu(this,new AlphaImage(e),1)}clone(){return new AlphaImage({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){Nu(e,t,r,n,i,1)}}class RGBAImage{constructor(e,t){$u(this,e,4,t)}resize(e){Uu(this,new RGBAImage(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new RGBAImage({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){Nu(e,t,r,n,i,4)}}ko(AlphaImage,"AlphaImage"),ko(RGBAImage,"RGBAImage");var Ku={paint:new Properties({"heatmap-radius":new DataDrivenProperty(Do.paint_heatmap["heatmap-radius"]),"heatmap-weight":new DataDrivenProperty(Do.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new DataConstantProperty(Do.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ColorRampProperty(Do.paint_heatmap["heatmap-color"]),"heatmap-opacity":new DataConstantProperty(Do.paint_heatmap["heatmap-opacity"])})};function Zu(e){const t={},r=e.resolution||256,n=e.clips?e.clips.length:1,i=e.image||new RGBAImage({width:r,height:n}),s=(r,n,s)=>{t[e.evaluationKey]=s;const o=e.expression.evaluate(t);i.data[r+n+0]=Math.floor(255*o.r/o.a),i.data[r+n+1]=Math.floor(255*o.g/o.a),i.data[r+n+2]=Math.floor(255*o.b/o.a),i.data[r+n+3]=Math.floor(255*o.a)};if(e.clips)for(let t=0,i=0;t<n;++t,i+=4*r)for(let n=0,o=0;n<r;n++,o+=4){const a=n/(r-1),{start:l,end:u}=e.clips[t];s(i,o,l*(1-a)+u*a)}else for(let e=0,t=0;e<r;e++,t+=4)s(0,t,e/(r-1));return i}var Gu={paint:new Properties({"hillshade-illumination-direction":new DataConstantProperty(Do.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new DataConstantProperty(Do.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new DataConstantProperty(Do.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new DataConstantProperty(Do.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new DataConstantProperty(Do.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new DataConstantProperty(Do.paint_hillshade["hillshade-accent-color"])})};const Xu=dl([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yu}=Xu;var Wu=Hu,Ju=Hu;function Hu(e,t,r){r=r||2;var n,i,s,o,a,l,u,c=t&&t.length,h=c?t[0]*r:e.length,p=Qu(e,0,h,r,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(e,t,r,n){var i,s,o,a=[];for(i=0,s=t.length;i<s;i++)(o=Qu(e,t[i]*n,i<s-1?t[i+1]*n:e.length,n,!1))===o.next&&(o.steiner=!0),a.push(cc(o));for(a.sort(oc),i=0;i<a.length;i++)r=ec(r=ac(a[i],r),r.next);return r}(e,t,p,r)),e.length>80*r){n=s=e[0],i=o=e[1];for(var f=r;f<h;f+=r)(a=e[f])<n&&(n=a),(l=e[f+1])<i&&(i=l),a>s&&(s=a),l>o&&(o=l);u=0!==(u=Math.max(s-n,o-i))?1/u:0}return tc(p,d,r,n,i,u),d}function Qu(e,t,r,n,i){var s,o;if(i===Sc(e,t,r,n)>0)for(s=t;s<r;s+=n)o=bc(s,e[s],e[s+1],o);else for(s=r-n;s>=t;s-=n)o=bc(s,e[s],e[s+1],o);return o&&fc(o,o.next)&&(wc(o),o=o.next),o}function ec(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!fc(n,n.next)&&0!==dc(n.prev,n,n.next))n=n.next;else{if(wc(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function tc(e,t,r,n,i,s,o){if(e){!o&&s&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=uc(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,s,o,a,l,u=1;do{for(r=e,e=null,s=null,o=0;r;){for(o++,n=r,a=0,t=0;t<u&&(a++,n=n.nextZ);t++);for(l=u;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=n}s.nextZ=null,u*=2}while(o>1)}(i)}(e,n,i,s);for(var a,l,u=e;e.prev!==e.next;)if(a=e.prev,l=e.next,s?nc(e,n,i,s):rc(e))t.push(a.i/r),t.push(e.i/r),t.push(l.i/r),wc(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?tc(e=ic(ec(e),t,r),t,r,n,i,s,2):2===o&&sc(e,t,r,n,i,s):tc(ec(e),t,r,n,i,s,1);break}}}function rc(e){var t=e.prev,r=e,n=e.next;if(dc(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(hc(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&dc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function nc(e,t,r,n){var i=e.prev,s=e,o=e.next;if(dc(i,s,o)>=0)return!1;for(var a=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,l=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,u=uc(i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,t,r,n),c=uc(a,l,t,r,n),h=e.prevZ,p=e.nextZ;h&&h.z>=u&&p&&p.z<=c;){if(h!==e.prev&&h!==e.next&&hc(i.x,i.y,s.x,s.y,o.x,o.y,h.x,h.y)&&dc(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==e.prev&&p!==e.next&&hc(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&dc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=u;){if(h!==e.prev&&h!==e.next&&hc(i.x,i.y,s.x,s.y,o.x,o.y,h.x,h.y)&&dc(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==e.prev&&p!==e.next&&hc(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&dc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function ic(e,t,r){var n=e;do{var i=n.prev,s=n.next.next;!fc(i,s)&&yc(i,n,n.next,s)&&xc(i,s)&&xc(s,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(s.i/r),wc(n),wc(n.next),n=e=s),n=n.next}while(n!==e);return ec(n)}function sc(e,t,r,n,i,s){var o=e;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&pc(o,a)){var l=vc(o,a);return o=ec(o,o.next),l=ec(l,l.next),tc(o,t,r,n,i,s),void tc(l,t,r,n,i,s)}a=a.next}o=o.next}while(o!==e)}function oc(e,t){return e.x-t.x}function ac(e,t){var r=function(e,t){var r,n=t,i=e.x,s=e.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>o){if(o=a,a===i){if(s===n.y)return n;if(s===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r;var l,u=r,c=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&hc(s<h?i:o,s,c,h,s<h?o:i,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(i-n.x),xc(n,e)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&lc(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(e,t);if(!r)return t;var n=vc(r,e),i=ec(r,r.next);return ec(n,n.next),t===r?i:t}function lc(e,t){return dc(e.prev,e,t.prev)<0&&dc(t.next,e,e.next)<0}function uc(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function cc(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function hc(e,t,r,n,i,s,o,a){return(i-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(r-o)*(t-a)>=0&&(r-o)*(s-a)-(i-o)*(n-a)>=0}function pc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&yc(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(xc(e,t)&&xc(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(dc(e.prev,e,t.prev)||dc(e,t.prev,t))||fc(e,t)&&dc(e.prev,e,e.next)>0&&dc(t.prev,t,t.next)>0)}function dc(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function fc(e,t){return e.x===t.x&&e.y===t.y}function yc(e,t,r,n){var i=gc(dc(e,t,r)),s=gc(dc(e,t,n)),o=gc(dc(r,n,e)),a=gc(dc(r,n,t));return i!==s&&o!==a||!(0!==i||!mc(e,r,t))||!(0!==s||!mc(e,n,t))||!(0!==o||!mc(r,e,n))||!(0!==a||!mc(r,t,n))}function mc(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function gc(e){return e>0?1:e<0?-1:0}function xc(e,t){return dc(e.prev,e,e.next)<0?dc(e,t,e.next)>=0&&dc(e,e.prev,t)>=0:dc(e,t,e.prev)<0||dc(e,e.next,t)<0}function vc(e,t){var r=new _c(e.i,e.x,e.y),n=new _c(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function bc(e,t,r,n){var i=new _c(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function wc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _c(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sc(e,t,r,n){for(var i=0,s=t,o=r-n;s<r;s+=n)i+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return i}function Ac(e,t,r,n,i){kc(e,t,r||0,n||e.length-1,i||Pc)}function kc(e,t,r,n,i){for(;n>r;){if(n-r>600){var s=n-r+1,o=t-r+1,a=Math.log(s),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1);kc(e,t,Math.max(r,Math.floor(t-o*l/s+u)),Math.min(n,Math.floor(t+(s-o)*l/s+u)),i)}var c=e[t],h=r,p=n;for(Ic(e,r,t),i(e[n],c)>0&&Ic(e,r,n);h<p;){for(Ic(e,h,p),h++,p--;i(e[h],c)<0;)h++;for(;i(e[p],c)>0;)p--}0===i(e[r],c)?Ic(e,r,p):Ic(e,++p,n),p<=t&&(r=p+1),t<=p&&(n=p-1)}}function Ic(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function Pc(e,t){return e<t?-1:e>t?1:0}function Tc(e,t){const r=e.length;if(r<=1)return[e];const n=[];let i,s;for(let t=0;t<r;t++){const r=_(e[t]);0!==r&&(e[t].area=Math.abs(r),void 0===s&&(s=r<0),s===r<0?(i&&n.push(i),i=[e[t]]):i.push(e[t]))}if(i&&n.push(i),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(Ac(n[e],t,1,n[e].length-1,Cc),n[e]=n[e].slice(0,t));return n}function Cc(e,t){return t.area-e.area}function Ec(e,t,r){const n=r.patternDependencies;let i=!1;for(const r of t){const t=r.paint.get(`${e}-pattern`);t.isConstant()||(i=!0);const s=t.constantOr(null);s&&(i=!0,n[s.to]=!0,n[s.from]=!0)}return i}function Mc(e,t,r,n,i){const s=i.patternDependencies;for(const o of t){const t=o.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n-1},r,{},i.availableImages),a=t.evaluate({zoom:n},r,{},i.availableImages),l=t.evaluate({zoom:n+1},r,{},i.availableImages);e=e&&e.name?e.name:e,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,s[e]=!0,s[a]=!0,s[l]=!0,r.patterns[o.id]={min:e,mid:a,max:l}}}return r}Hu.deviation=function(e,t,r,n){var i=t&&t.length,s=Math.abs(Sc(e,0,i?t[0]*r:e.length,r));if(i)for(var o=0,a=t.length;o<a;o++)s-=Math.abs(Sc(e,t[o]*r,o<a-1?t[o+1]*r:e.length,r));var l=0;for(o=0;o<n.length;o+=3){var u=n[o]*r,c=n[o+1]*r,h=n[o+2]*r;l+=Math.abs((e[u]-e[h])*(e[c+1]-e[u+1])-(e[u]-e[c])*(e[h+1]-e[u+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},Hu.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var s=0;s<e[i].length;s++)for(var o=0;o<t;o++)r.vertices.push(e[i][s][o]);i>0&&r.holes.push(n+=e[i-1].length)}return r},Wu.default=Ju;class FillBucket{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new StructArrayLayout2i4,this.indexArray=new StructArrayLayout3ui6,this.indexArray2=new StructArrayLayout2ui4,this.programConfigurations=new ProgramConfigurationSet(e.layers,e.zoom),this.segments=new SegmentVector,this.segments2=new SegmentVector,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,r,n){this.hasPattern=Ec("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),s=[];for(const{feature:o,id:a,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Jl(o,e);if(!this.layers[0]._featureFilter.filter(new EvaluationParameters(this.zoom),c,r))continue;const h=i?i.evaluate(c,{},r,t.availableImages):void 0,p={id:a,properties:o.properties,type:o.type,sourceLayerIndex:u,index:l,geometry:e?c.geometry:Wl(o,r,n),patterns:{},sortKey:h};s.push(p)}i&&s.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of s){const{geometry:i,index:s,sourceLayerIndex:o}=n;if(this.hasPattern){const e=Mc("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,s,r,{},t.availableImages);t.featureIndex.insert(e[s].feature,i,s,o,this.index)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}addFeatures(e,t,r,n,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,n,i,s=[]){for(const e of Tc(t,500)){let t=0;for(const r of e)t+=r.length;const r=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=r.vertexLength,i=[],s=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&s.push(i.length/2);const r=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),n=r.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(n+t.length-1,n),i.push(t[0].x),i.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),i.push(t[e].x),i.push(t[e].y);r.vertexLength+=t.length,r.primitiveLength+=t.length}const o=Wu(i,s);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(n+o[e],n+o[e+1],n+o[e+2]);r.vertexLength+=t,r.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,s,n)}}ko(FillBucket,"FillBucket",{omit:["layers","patternFeatures"]});const Dc=new Properties({"fill-sort-key":new DataDrivenProperty(Do.layout_fill["fill-sort-key"])});var zc={paint:new Properties({"fill-antialias":new DataConstantProperty(Do.paint_fill["fill-antialias"]),"fill-opacity":new DataDrivenProperty(Do.paint_fill["fill-opacity"]),"fill-color":new DataDrivenProperty(Do.paint_fill["fill-color"]),"fill-outline-color":new DataDrivenProperty(Do.paint_fill["fill-outline-color"]),"fill-translate":new DataConstantProperty(Do.paint_fill["fill-translate"]),"fill-translate-anchor":new DataConstantProperty(Do.paint_fill["fill-translate-anchor"]),"fill-pattern":new CrossFadedDataDrivenProperty(Do.paint_fill["fill-pattern"])}),layout:Dc};const Bc=dl([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Vc=dl([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Lc=dl([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Fc}=Bc;var Rc=Oc;function Oc(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(jc,this,t)}function jc(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function qc(e){for(var t,r,n=0,i=0,s=e.length,o=s-1;i<s;o=i++)n+=((r=e[o]).x-(t=e[i]).x)*(t.y+r.y);return n}Oc.types=["Unknown","Point","LineString","Polygon"],Oc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var r,n=t.readVarint()+t.pos,i=1,s=0,o=0,a=0,l=[];t.pos<n;){if(s<=0){var u=t.readVarint();i=7&u,s=u>>3}if(s--,1===i||2===i)o+=t.readSVarint(),a+=t.readSVarint(),1===i&&(r&&l.push(r),r=[]),r.push(new e(o,a));else{if(7!==i)throw new Error("unknown command "+i);r&&r.push(r[0].clone())}}return r&&l.push(r),l},Oc.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,s=0,o=1/0,a=-1/0,l=1/0,u=-1/0;e.pos<t;){if(n<=0){var c=e.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=e.readSVarint())<o&&(o=i),i>a&&(a=i),(s+=e.readSVarint())<l&&(l=s),s>u&&(u=s);else if(7!==r)throw new Error("unknown command "+r)}return[o,l,a,u]},Oc.prototype.toGeoJSON=function(e,t,r){var n,i,s=this.extent*Math.pow(2,r),o=this.extent*e,a=this.extent*t,l=this.loadGeometry(),u=Oc.types[this.type];function c(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+o)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+a)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];c(l=h);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],s=0;s<t;s++){var o=qc(e[s]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(r&&i.push(r),r=[e[s]]):r.push(e[s]))}return r&&i.push(r),i}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var $c=Uc;function Uc(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Nc,this,t),this.length=this._features.length}function Nc(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(r))}function Kc(e,t,r){if(3===e){var n=new $c(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}Uc.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Rc(this._pbf,t,this.extent,this._keys,this._values)};var Zc={VectorTile:function(e,t){this.layers=e.readFields(Kc,{},t)},VectorTileFeature:Rc,VectorTileLayer:$c};function Gc(t,r,n,i){const s=[],o=0===i?(t,r,n,i,s,o)=>{t.push(new e(o,n+(o-r)/(i-r)*(s-n)))}:(t,r,n,i,s,o)=>{t.push(new e(r+(o-n)/(s-n)*(i-r),o))};for(const e of t){const t=[];for(const s of e){if(s.length<=2)continue;const e=[];for(let t=0;t<s.length-1;t++){const a=s[t].x,l=s[t].y,u=s[t+1].x,c=s[t+1].y,h=0===i?a:l,p=0===i?u:c;h<r?p>r&&o(e,a,l,u,c,r):h>n?p<n&&o(e,a,l,u,c,n):e.push(s[t]),p<r&&h>=r&&o(e,a,l,u,c,r),p>n&&h<=n&&o(e,a,l,u,c,n)}let a=s[s.length-1];const l=0===i?a.x:a.y;l>=r&&l<=n&&e.push(a),e.length&&(a=e[e.length-1],e[0].x===a.x&&e[0].y===a.y||e.push(e[0]),t.push(e))}t.length&&s.push(t)}return s}const Xc=Zc.VectorTileFeature.types,Yc=Math.pow(2,13);function Wc(e,t,r,n,i,s,o,a){e.emplaceBack((t<<1)+o,(r<<1)+s,(Math.floor(n*Yc)<<1)+i,Math.round(a))}function Jc(e,t,r){const n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}class PartMetadata{constructor(){this.acc=new e(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new e(t.x,t.y),this.max=new e(t.x,t.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,n=this.max;e.x<r.x?r.x=e.x:e.x>n.x&&(n.x=e.x),e.y<r.y?r.y=e.y:e.y>n.y&&(n.y=e.y),((0===e.x||e.x===zl)&&e.x===t.x)!=((0===e.y||e.y===zl)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Oe(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>zl!=e.x>zl&&this.addBorderIntersection(1,Oe(t.y,e.y,(zl-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Oe(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>zl!=e.y>zl&&this.addBorderIntersection(3,Oe(t.x,e.x,(zl-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){const t=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==t?this.acc.div(t)._round():new e(0,0)}span(){return new e(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class FillExtrusionBucket{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new StructArrayLayout4i8,this.centroidVertexArray=new FillExtrusionCentroidArray,this.indexArray=new StructArrayLayout3ui6,this.programConfigurations=new ProgramConfigurationSet(e.layers,e.zoom),this.segments=new SegmentVector,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,r,n){this.features=[],this.hasPattern=Ec("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/zl/(1<<e.z)}(r);for(const{feature:i,id:s,index:o,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Jl(i,e);if(!this.layers[0]._featureFilter.filter(new EvaluationParameters(this.zoom),l,r))continue;const u={id:s,sourceLayerIndex:a,index:o,geometry:e?l.geometry:Wl(i,r,n),properties:i.properties,type:i.type,patterns:{}},c=this.layoutVertexArray.length;this.hasPattern?this.features.push(Mc("fill-extrusion",this.layers,u,this.zoom,t)):this.addFeature(u,u.geometry,o,r,{},t.availableImages,n),t.featureIndex.insert(i,u.geometry,o,a,this.index,c)}this.sortBorders()}addFeatures(e,t,r,n,i){for(const e of this.features){const{geometry:s}=e;this.addFeature(e,s,e.index,t,r,n,i)}this.sortBorders()}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Lc.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Vc.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,n,i,s,o,a){const l=[new e(0,0),new e(zl,zl)],u=a.projection,c="globe"===u.name,h=this.enableTerrain&&!c?new PartMetadata:null;c&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new FillExtrusionExtArray);const p=Tc(r,500);for(let e=p.length-1;e>=0;e--){const t=p[e];(0===t.length||(d=t[0]).every((e=>e.x<=0))||d.every((e=>e.x>=zl))||d.every((e=>e.y<=0))||d.every((e=>e.y>=zl)))&&p.splice(e,1)}var d;let f;if(c)f=Qc(p,l,i);else{f=[];for(const e of p)f.push({polygon:e,bounds:l})}for(const e of f){const r=e.polygon;let n=0,s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let t=0;t<r.length;t++){const o=r[t];if(0===o.length)continue;n+=o.length;let a=0;h&&h.startRing(o[0]);for(let t=0;t<o.length;t++){const r=o[t];if(t>=1){const n=o[t-1];if(!Hc(r,n,e.bounds)){h&&h.append(r,n),s.vertexLength+4>SegmentVector.MAX_VERTEX_ARRAY_LENGTH&&(s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=r.sub(n)._perp(),t=e.x/(Math.abs(e.x)+Math.abs(e.y)),o=e.y>0?1:0,l=n.dist(r);a+l>32768&&(a=0),Wc(this.layoutVertexArray,r.x,r.y,t,o,0,0,a),Wc(this.layoutVertexArray,r.x,r.y,t,o,0,1,a),a+=l,Wc(this.layoutVertexArray,n.x,n.y,t,o,0,0,a),Wc(this.layoutVertexArray,n.x,n.y,t,o,0,1,a);const p=s.vertexLength;if(this.indexArray.emplaceBack(p,p+2,p+1),this.indexArray.emplaceBack(p+1,p+2,p+3),s.vertexLength+=4,s.primitiveLength+=2,c){const e=this.layoutVertexExtArray,t=u.projectTilePoint(r.x,r.y,i),s=u.projectTilePoint(n.x,n.y,i),o=u.upVector(i,r.x,r.y),a=u.upVector(i,n.x,n.y);Jc(e,t,o),Jc(e,t,o),Jc(e,s,a),Jc(e,s,a)}}}}}if(s.vertexLength+n>SegmentVector.MAX_VERTEX_ARRAY_LENGTH&&(s=this.segments.prepareSegment(n,this.layoutVertexArray,this.indexArray)),"Polygon"!==Xc[t.type])continue;const o=[],a=[],l=s.vertexLength;for(let e=0;e<r.length;e++){const t=r[e];if(0!==t.length){t!==r[0]&&a.push(o.length/2);for(let e=0;e<t.length;e++){const r=t[e];Wc(this.layoutVertexArray,r.x,r.y,0,0,1,1,0),o.push(r.x),o.push(r.y),h&&h.currentPolyCount.top++,c&&Jc(this.layoutVertexExtArray,u.projectTilePoint(r.x,r.y,i),u.upVector(i,r.x,r.y))}}}const p=Wu(o,a);for(let e=0;e<p.length;e+=3)this.indexArray.emplaceBack(l+p[e],l+p[e+2],l+p[e+1]);s.primitiveLength+=p.length/3,s.vertexLength+=n}if(h&&h.polyCount.length>0){if(h.borders){h.vertexArrayOffset=this.centroidVertexArray.length;const e=h.borders,t=this.featuresOnBorder.push(h)-1;for(let r=0;r<4;r++)e[r][0]!==Number.MAX_VALUE&&this.borders[r].push(t)}this.encodeCentroid(h.borders?void 0:h.centroid(),h)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,s,o,i)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0]))}encodeCentroid(e,t,r=!0){let n,i;if(e)if(0!==e.y){const r=t.span()._mult(this.tileToMeter);n=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(r.x/10)),i=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(r.y/10))}else n=Math.ceil(7*(e.x+450)),i=0;else n=0,i=+r;let s=r?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(s++,0,i),this.centroidVertexArray.emplace(s++,n,i);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(s++,n,i)}}}function Hc(e,t,r){return e.x===t.x&&(e.x<r[0].x||e.x>r[1].x)||e.y===t.y&&(e.y<r[0].y||e.y>r[1].y)}function Qc(t,r,n){const i=1<<n.z,s=jl(n.x/i),o=jl((n.x+1)/i),a=ql(n.y/i),l=ql((n.y+1)/i);return function(t,r,n,i,s=0,o){const a=[];if(!t.length||!n||!i)return a;const l=(e,t)=>{for(const r of e)a.push({polygon:r,bounds:t})},u=Math.ceil(Math.log2(n)),c=Math.ceil(Math.log2(i)),h=u-c,p=[];for(let e=0;e<Math.abs(h);e++)p.push(h>0?0:1);for(let e=0;e<Math.min(u,c);e++)p.push(0),p.push(1);let d=t;if(d=Gc(d,r[0].y-s,r[1].y+s,1),d=Gc(d,r[0].x-s,r[1].x+s,0),!d.length)return a;const f=[];for(p.length?f.push({polygons:d,bounds:r,depth:0}):l(d,r);f.length;){const t=f.pop(),r=t.depth,n=p[r],i=t.bounds[0],a=t.bounds[1],u=0===n?i.x:i.y,c=0===n?a.x:a.y,h=o?o(n,u,c):.5*(u+c),d=Gc(t.polygons,u-s,h+s,n),y=Gc(t.polygons,h-s,c+s,n);if(d.length){const t=[i,new e(0===n?h:a.x,1===n?h:a.y)];p.length>r+1?f.push({polygons:d,bounds:t,depth:r+1}):l(d,t)}if(y.length){const t=[new e(0===n?h:i.x,1===n?h:i.y),a];p.length>r+1?f.push({polygons:y,bounds:t,depth:r+1}):l(y,t)}}return a}(t,r,Math.ceil((o-s)/11.25),Math.ceil((a-l)/11.25),1,((e,t,r)=>{if(0===e)return.5*(t+r);{const e=ql((n.y+t/zl)/i);return(Rl(.5*(ql((n.y+r/zl)/i)+e))*i-n.y)*zl}}))}ko(FillExtrusionBucket,"FillExtrusionBucket",{omit:["layers","features"]}),ko(PartMetadata,"PartMetadata");var eh={paint:new Properties({"fill-extrusion-opacity":new DataConstantProperty(Do["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new DataDrivenProperty(Do["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new DataConstantProperty(Do["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new DataConstantProperty(Do["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new CrossFadedDataDrivenProperty(Do["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new DataDrivenProperty(Do["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new DataDrivenProperty(Do["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new DataConstantProperty(Do["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function th(e,t,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class CanonicalTileID{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=rh(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const r=(i=this.y,s=this.z,o=th(256*(n=this.x),256*(i=Math.pow(2,s)-i-1),s),a=th(256*(n+1),256*(i+1),s),o[0]+","+o[1]+","+a[0]+","+a[1]);var n,i,s,o,a;const l=function(e,t,r){let n,i="";for(let s=e;s>0;s--)n=1<<s-1,i+=(t&n?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class UnwrappedTileID{constructor(e,t){this.wrap=e,this.canonical=t,this.key=rh(e,t.z,t.z,t.x,t.y)}}class OverscaledTileID{constructor(e,t,r,n,i){this.overscaledZ=e,this.wrap=t,this.canonical=new CanonicalTileID(r,+n,+i),this.key=0===t&&e===r?this.canonical.key:rh(t,e,r,n,i)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new OverscaledTileID(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new OverscaledTileID(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return rh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return rh(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new OverscaledTileID(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new OverscaledTileID(t,this.wrap,t,r,n),new OverscaledTileID(t,this.wrap,t,r+1,n),new OverscaledTileID(t,this.wrap,t,r,n+1),new OverscaledTileID(t,this.wrap,t,r+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new OverscaledTileID(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new OverscaledTileID(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new UnwrappedTileID(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rh(e,t,r,n,i){const s=1<<Math.min(r,22);let o=s*(i%s)+n%s;return e&&r<22&&(o+=s*s*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*o+r)+(t-r)}function nh(e,t){return e.x*t.x+e.y*t.y}function ih(e,t){if(1===e.length){let r=0;const n=t[r++];let i;for(;!i||n.equals(i);)if(i=t[r++],!i)return 1/0;for(;r<t.length;r++){const s=t[r],o=e[0],a=i.sub(n),l=s.sub(n),u=o.sub(n),c=nh(a,a),h=nh(a,l),p=nh(l,l),d=nh(u,a),f=nh(u,l),y=c*p-h*h,m=(p*d-h*f)/y,g=(c*f-h*d)/y,x=n.z*(1-m-g)+i.z*m+s.z*g;if(isFinite(x))return x}return 1/0}{let e=1/0;for(const r of t)e=Math.min(e,r.z);return e}}function sh(t){const r=new e(t[0],t[1]);return r.z=t[2],r}function oh(e,t,r,n,i,s,o,a){const l=o*i.getElevationAt(e,t,!0,!0),u=0!==s[0],c=u?0===s[1]?o*(s[0]/7-450):o*function(e,t,r){const n=Math.floor(t[0]/8),i=Math.floor(t[1]/8),s=10*(t[0]-8*n),o=10*(t[1]-8*i),a=e.getElevationAt(n,i,!0,!0),l=e.getMeterToDEM(r),u=Math.floor(.5*(s*l-1)),c=Math.floor(.5*(o*l-1)),h=e.tileCoordToPixel(n,i),p=2*u+1,d=2*c+1,f=function(e,t,r,n,i){return[e.getElevationAtPixel(t,r,!0),e.getElevationAtPixel(t+i,r,!0),e.getElevationAtPixel(t,r+i,!0),e.getElevationAtPixel(t+n,r+i,!0)]}(e,h.x-u,h.y-c,p,d),y=Math.abs(f[0]-f[1]),m=Math.abs(f[2]-f[3]),g=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),x=Math.min(.25,.5*l*(y+m)/p),v=Math.min(.25,.5*l*g/d);return a+Math.max(x*s,v*o)}(i,s,a):l;return{base:l+(0===r)?-1:r,top:u?Math.max(c+n,l+r+2):l+n}}ko(CanonicalTileID,"CanonicalTileID"),ko(OverscaledTileID,"OverscaledTileID",{omit:["projMatrix"]});const ah=dl([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:lh}=ah,uh=dl([{name:"a_packed",components:4,type:"Float32"}]),{members:ch}=uh,hh=Zc.VectorTileFeature.types,ph=Math.cos(Math.PI/180*37.5);class LineBucket{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new StructArrayLayout2i4ub1f12,this.layoutVertexArray2=new StructArrayLayout4f16,this.indexArray=new StructArrayLayout3ui6,this.programConfigurations=new ProgramConfigurationSet(e.layers,e.zoom),this.segments=new SegmentVector,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,n){this.hasPattern=Ec("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),s=[];for(const{feature:t,id:o,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Jl(t,e);if(!this.layers[0]._featureFilter.filter(new EvaluationParameters(this.zoom),u,r))continue;const c=i?i.evaluate(u,{},r):void 0,h={id:o,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?u.geometry:Wl(t,r,n),patterns:{},sortKey:c};s.push(h)}i&&s.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:o,featureIndex:a}=t,l=this.addConstantDashes(o);for(const n of s){const{geometry:i,index:s,sourceLayerIndex:u}=n;if(l&&this.addFeatureDashes(n,o),this.hasPattern){const e=Mc("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,s,r,o.positions,t.availableImages);a.insert(e[s].feature,i,s,u,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,i=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==i.kind)t=!0;else{const t=i.value,r=n.value;if(!r)continue;e.addDash(r.from,t),e.addDash(r.to,t),r.other&&e.addDash(r.other,t)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===s.kind)continue;let o,a,l,u,c,h;if("constant"===i.kind){const e=i.value;if(!e)continue;o=e.other||e.to,a=e.to,l=e.from}else o=i.evaluate({zoom:r-1},e),a=i.evaluate({zoom:r},e),l=i.evaluate({zoom:r+1},e);"constant"===s.kind?u=c=h=s.value:(u=s.evaluate({zoom:r-1},e),c=s.evaluate({zoom:r},e),h=s.evaluate({zoom:r+1},e)),t.addDash(o,u),t.addDash(a,c),t.addDash(l,h);const p=t.getKey(o,u),d=t.getKey(a,c),f=t.getKey(l,h);e.patterns[n.id]={min:p,mid:d,max:f}}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}addFeatures(e,t,r,n,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ch)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,n,i,s){const o=this.layers[0].layout,a=o.get("line-join").evaluate(e,{}),l=o.get("line-cap").evaluate(e,{}),u=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const r of t)this.addLine(r,e,a,l,u,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,s,n)}addLine(e,t,r,n,i,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===hh[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(o?3:2))return;"bevel"===r&&(i=1.05);const u=this.overscaling<=16?122880/(512*this.overscaling):0,c=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,p,d,f,y;this.e1=this.e2=-1,o&&(h=e[a-2],y=e[l].sub(h)._unit()._perp());for(let t=l;t<a;t++){if(d=t===a-1?o?e[l+1]:void 0:e[t+1],d&&e[t].equals(d))continue;y&&(f=y),h&&(p=h),h=e[t],y=d?d.sub(h)._unit()._perp():f,f=f||y;let m=f.add(y);0===m.x&&0===m.y||m._unit();const g=f.x*y.x+f.y*y.y,x=m.x*y.x+m.y*y.y,v=0!==x?1/x:1/0,b=2*Math.sqrt(2-2*x),w=x<ph&&p&&d,_=f.x*y.y-f.y*y.x>0;if(w&&t>l){const e=h.dist(p);if(e>2*u){const t=h.sub(h.sub(p)._mult(u/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,f,0,0,c),p=t}}const S=p&&d;let A=S?r:o?"butt":n;if(S&&"round"===A&&(v<s?A="miter":v<=2&&(A="fakeround")),"miter"===A&&v>i&&(A="bevel"),"bevel"===A&&(v>2&&(A="flipbevel"),v<i&&(A="miter")),p&&this.updateDistance(p,h),"miter"===A)m._mult(v),this.addCurrentVertex(h,m,0,0,c);else if("flipbevel"===A){if(v>100)m=y.mult(-1);else{const e=v*f.add(y).mag()/f.sub(y).mag();m._perp()._mult(e*(_?-1:1))}this.addCurrentVertex(h,m,0,0,c),this.addCurrentVertex(h,m.mult(-1),0,0,c)}else if("bevel"===A||"fakeround"===A){const e=-Math.sqrt(v*v-1),t=_?e:0,r=_?0:e;if(p&&this.addCurrentVertex(h,f,t,r,c),"fakeround"===A){const e=Math.round(180*b/Math.PI/20);for(let t=1;t<e;t++){let r=t/e;if(.5!==r){const e=r-.5;r+=r*e*(r-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)))}const n=y.sub(f)._mult(r)._add(f)._unit()._mult(_?-1:1);this.addHalfVertex(h,n.x,n.y,!1,_,0,c)}}d&&this.addCurrentVertex(h,y,-t,-r,c)}else if("butt"===A)this.addCurrentVertex(h,m,0,0,c);else if("square"===A){const e=p?1:-1;p||this.addCurrentVertex(h,m,e,e,c),this.addCurrentVertex(h,m,0,0,c),p&&this.addCurrentVertex(h,m,e,e,c)}else"round"===A&&(p&&(this.addCurrentVertex(h,f,0,0,c),this.addCurrentVertex(h,f,1,1,c,!0)),d&&(this.addCurrentVertex(h,y,-1,-1,c,!0),this.addCurrentVertex(h,y,0,0,c)));if(w&&t<a-1){const e=h.dist(d);if(e>2*u){const t=h.add(d.sub(h)._mult(u/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,y,0,0,c),h=t}}}}addCurrentVertex(e,t,r,n,i,s=!1){const o=t.y*n-t.x,a=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,s,!1,r,i),this.addHalfVertex(e,o,a,s,!0,-n,i)}addHalfVertex({x:e,y:t},r,n,i,s,o,a){this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(s?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),s?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}ko(LineBucket,"LineBucket",{omit:["layers","patternFeatures"]});const dh=new Properties({"line-cap":new DataDrivenProperty(Do.layout_line["line-cap"]),"line-join":new DataDrivenProperty(Do.layout_line["line-join"]),"line-miter-limit":new DataConstantProperty(Do.layout_line["line-miter-limit"]),"line-round-limit":new DataConstantProperty(Do.layout_line["line-round-limit"]),"line-sort-key":new DataDrivenProperty(Do.layout_line["line-sort-key"])});var fh={paint:new Properties({"line-opacity":new DataDrivenProperty(Do.paint_line["line-opacity"]),"line-color":new DataDrivenProperty(Do.paint_line["line-color"]),"line-translate":new DataConstantProperty(Do.paint_line["line-translate"]),"line-translate-anchor":new DataConstantProperty(Do.paint_line["line-translate-anchor"]),"line-width":new DataDrivenProperty(Do.paint_line["line-width"]),"line-gap-width":new DataDrivenProperty(Do.paint_line["line-gap-width"]),"line-offset":new DataDrivenProperty(Do.paint_line["line-offset"]),"line-blur":new DataDrivenProperty(Do.paint_line["line-blur"]),"line-dasharray":new CrossFadedDataDrivenProperty(Do.paint_line["line-dasharray"]),"line-pattern":new CrossFadedDataDrivenProperty(Do.paint_line["line-pattern"]),"line-gradient":new ColorRampProperty(Do.paint_line["line-gradient"]),"line-trim-offset":new DataConstantProperty(Do.paint_line["line-trim-offset"])}),layout:dh};const yh=new class LineFloorwidthProperty extends DataDrivenProperty{possiblyEvaluate(e,t){return t=new EvaluationParameters(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,n){return t=h({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,n)}}(fh.paint.properties["line-width"].specification);function mh(e,t){return t>0?t+2*e:e}yh.useIntegerZoom=!0;const gh=dl([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xh=dl([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),vh=dl([{name:"a_projected_pos",components:4,type:"Float32"}],4);dl([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bh=dl([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),wh=dl([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);dl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _h=dl([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);dl([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),dl([{name:"triangle",components:3,type:"Uint16"}]),dl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),dl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),dl([{type:"Float32",name:"offsetX"}]),dl([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Sh=24;const Ah=128;function kh(e,t){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new EvaluationParameters(e+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:n}=r;let i=0;for(;i<t.length&&t[i]<=e;)i++;i=Math.max(0,i-1);let s=i;for(;s<t.length&&t[s]<e+1;)s++;s=Math.min(t.length-1,s);const o=t[i],a=t[s];return"composite"===r.kind?{kind:"composite",minZoom:o,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:o,maxZoom:a,minSize:r.evaluate(new EvaluationParameters(o)),maxSize:r.evaluate(new EvaluationParameters(a)),interpolationType:n}}}function Ih(e,{uSize:t,uSizeT:r},{lowerSize:n,upperSize:i}){return"source"===e.kind?n/Ah:"composite"===e.kind?Oe(n/Ah,i/Ah,r):t}function Ph(e,t){let r=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){const{interpolationType:i,minZoom:s,maxZoom:o}=e,l=i?a(st.interpolationFactor(i,t,s,o),0,1):0;"camera"===e.kind?n=Oe(e.minSize,e.maxSize,l):r=l}return{uSizeT:r,uSize:n}}function Th(e,t,r){return e.sections.forEach((e=>{e.text=function(e,t,r){const n=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),cl.applyArabicShaping&&(e=cl.applyArabicShaping(e)),e}(e.text,t,r)})),e}const Ch={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Eh(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}function Mh(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}var Dh=function(e,t,r,n,i){var s,o,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=r?i-1:0,p=r?-1:1,d=e[t+h];for(h+=p,s=d&(1<<-c)-1,d>>=-c,c+=a;c>0;s=256*s+e[t+h],h+=p,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+e[t+h],h+=p,c-=8);if(0===s)s=1-u;else{if(s===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=u}return(d?-1:1)*o*Math.pow(2,s-n)},zh=function(e,t,r,n,i,s){var o,a,l,u=8*s-i-1,c=(1<<u)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,f=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=c?(a=0,o=c):o+h>=1?(a=(t*l-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+d]=255&a,d+=f,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[r+d]=255&o,d+=f,o/=256,u-=8);e[r+d-f]|=128*y},Bh=Vh;function Vh(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Vh.Varint=0,Vh.Fixed64=1,Vh.Bytes=2,Vh.Fixed32=5;var Lh=4294967296,Fh=1/Lh,Rh="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Oh(e){return e.type===Vh.Bytes?e.readVarint()+e.pos:e.pos+1}function jh(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function qh(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function $h(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Uh(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Nh(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Kh(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Zh(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function Gh(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Xh(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Yh(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Wh(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Jh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Hh(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function Qh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function ep(e){let t=0,r=0;for(const n of e)t+=n.w*n.h,r=Math.max(r,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,s=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const r=n[e];if(!(t.w>r.w||t.h>r.h)){if(t.x=r.x,t.y=r.y,s=Math.max(s,t.y+t.h),i=Math.max(i,t.x+t.w),t.w===r.w&&t.h===r.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===r.h?(r.x+=t.w,r.w-=t.w):t.w===r.w?(r.y+=t.h,r.h-=t.h):(n.push({x:r.x+t.w,y:r.y,w:r.w-t.w,h:t.h}),r.y+=t.h,r.h-=t.h);break}}return{w:i,h:s,fill:t/(i*s)||0}}Vh.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=7&n,e(i,t,this),this.pos===s&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Jh(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Qh(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Jh(this.buf,this.pos)+Jh(this.buf,this.pos+4)*Lh;return this.pos+=8,e},readSFixed64:function(){var e=Jh(this.buf,this.pos)+Qh(this.buf,this.pos+4)*Lh;return this.pos+=8,e},readFloat:function(){var e=Dh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Dh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function(e,t,r){var n,i,s=r.buf;if(n=(112&(i=s[r.pos++]))>>4,i<128)return jh(e,n,t);if(n|=(127&(i=s[r.pos++]))<<3,i<128)return jh(e,n,t);if(n|=(127&(i=s[r.pos++]))<<10,i<128)return jh(e,n,t);if(n|=(127&(i=s[r.pos++]))<<17,i<128)return jh(e,n,t);if(n|=(127&(i=s[r.pos++]))<<24,i<128)return jh(e,n,t);if(n|=(1&(i=s[r.pos++]))<<31,i<128)return jh(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Rh?function(e,t,r){return Rh.decode(e.subarray(t,r))}(this.buf,t,e):function(e,t,r){for(var n="",i=t;i<r;){var s,o,a,l=e[i],u=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(s=e[i+1]))&&(u=(31&l)<<6|63&s)<=127&&(u=null):3===c?(o=e[i+2],128==(192&(s=e[i+1]))&&128==(192&o)&&((u=(15&l)<<12|(63&s)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=e[i+2],a=e[i+3],128==(192&(s=e[i+1]))&&128==(192&o)&&128==(192&a)&&((u=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=c}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Vh.Bytes)return e.push(this.readVarint(t));var r=Oh(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Vh.Bytes)return e.push(this.readSVarint());var t=Oh(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Vh.Bytes)return e.push(this.readBoolean());var t=Oh(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Vh.Bytes)return e.push(this.readFloat());var t=Oh(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Vh.Bytes)return e.push(this.readDouble());var t=Oh(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Vh.Bytes)return e.push(this.readFixed32());var t=Oh(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Vh.Bytes)return e.push(this.readSFixed32());var t=Oh(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Vh.Bytes)return e.push(this.readFixed64());var t=Oh(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Vh.Bytes)return e.push(this.readSFixed64());var t=Oh(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Vh.Varint)for(;this.buf[this.pos++]>127;);else if(t===Vh.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Vh.Fixed32)this.pos+=4;else{if(t!==Vh.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Hh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Hh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Hh(this.buf,-1&e,this.pos),Hh(this.buf,Math.floor(e*Fh),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Hh(this.buf,-1&e,this.pos),Hh(this.buf,Math.floor(e*Fh),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var n,i,s=0;s<t.length;s++){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){n>56319||s+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&qh(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),zh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),zh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&qh(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,Vh.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,$h,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Uh,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Zh,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Nh,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Kh,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Gh,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Xh,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Yh,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Wh,t)},writeBytesField:function(e,t){this.writeTag(e,Vh.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Vh.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Vh.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Vh.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Vh.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Vh.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Vh.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Vh.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Vh.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Vh.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class ImagePosition{constructor(e,{pixelRatio:t,version:r,stretchX:n,stretchY:i,content:s}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=i,this.content=s,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ImageAtlas{constructor(e,t){const r={},n={};this.haveRenderCallbacks=[];const i=[];this.addImages(e,r,i),this.addImages(t,n,i);const{w:s,h:o}=ep(i),a=new RGBAImage({width:s||1,height:o||1});for(const t in e){const n=e[t],i=r[t].paddedRect;RGBAImage.copy(n.data,a,{x:0,y:0},{x:i.x+1,y:i.y+1},n.data)}for(const e in t){const r=t[e],i=n[e].paddedRect,s=i.x+1,o=i.y+1,l=r.data.width,u=r.data.height;RGBAImage.copy(r.data,a,{x:0,y:0},{x:s,y:o},r.data),RGBAImage.copy(r.data,a,{x:0,y:u-1},{x:s,y:o-1},{width:l,height:1}),RGBAImage.copy(r.data,a,{x:0,y:0},{x:s,y:o+u},{width:l,height:1}),RGBAImage.copy(r.data,a,{x:l-1,y:0},{x:s-1,y:o},{width:1,height:u}),RGBAImage.copy(r.data,a,{x:0,y:0},{x:s+l,y:o},{width:1,height:u})}this.image=a,this.iconPositions=r,this.patternPositions=n}addImages(e,t,r){for(const n in e){const i=e[n],s={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(s),t[n]=new ImagePosition(s,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}patchUpdatedImage(e,t,r){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,i]=e.tl;r.update(t.data,void 0,{x:n,y:i})}}ko(ImagePosition,"ImagePosition"),ko(ImageAtlas,"ImageAtlas");const tp={horizontal:1,vertical:2,horizontalOnly:3};class SectionOptions{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new SectionOptions;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new SectionOptions;return t.imageName=e,t}}class TaggedString{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const r=new TaggedString;for(let n=0;n<e.sections.length;n++){const i=e.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(e,t){let r="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,s=e.charCodeAt(n-1)||null;r+=!t&&(i&&Ga(i)&&!Ch[e[n+1]]||s&&Ga(s)&&!Ch[e[n-1]])||!Ch[e[n]]?e[n]:Ch[e[n]]}return r}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&np[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&np[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new TaggedString;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(SectionOptions.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(r)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void b("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(SectionOptions.forImage(t)),this.sectionIndex.push(this.sections.length-1)):b("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rp(e,t,r,n,i,s,o,a,l,u,c,h,p,d,f,y){const m=TaggedString.fromFeature(e,i);let g;h===tp.vertical&&m.verticalizePunctuation(p);const{processBidirectionalText:x,processStyledBidirectionalText:v}=cl;if(x&&1===m.sections.length){g=[];const e=x(m.toString(),cp(m,u,s,t,n,d,f));for(const t of e){const e=new TaggedString;e.text=t,e.sections=m.sections;for(let r=0;r<t.length;r++)e.sectionIndex.push(0);g.push(e)}}else if(v){g=[];const e=v(m.text,m.sectionIndex,cp(m,u,s,t,n,d,f));for(const t of e){const e=new TaggedString;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const r=[],n=e.text;let i=0;for(const n of t)r.push(e.substring(i,n)),i=n;return i<n.length&&r.push(e.substring(i,n.length)),r}(m,cp(m,u,s,t,n,d,f));const b=[],w={positionedLines:b,text:m.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,r,n,i,s,o,a,l,u,c,h){let p=0,d=0,f=0;const y="right"===a?1:"left"===a?0:.5;let m=!1;for(const e of i){const r=e.getSections();for(const e of r){if(e.imageName)continue;const r=t[e.fontStack];if(r&&(m=void 0!==r.ascender&&void 0!==r.descender,!m))break}if(!m)break}let g=0;for(const o of i){o.trim();const i=o.getMaxScale(),a=(i-1)*Sh,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=v;const b=v.positionedGlyphs;let w=0;if(!o.length()){d+=s,++g;continue}let _=0,S=0;for(let s=0;s<o.length();s++){const a=o.getSection(s),f=o.getSectionIndex(s),y=o.getCharCode(s);let g=a.scale,v=null,A=null,k=null,I=Sh,P=0;const T=!(l===tp.horizontal||!c&&!Za(y)||c&&(np[y]||(x=y,ga(x)||xa(x)||va(x)||Fa(x)||qa(x))));if(a.imageName){const t=n[a.imageName];if(!t)continue;k=a.imageName,e.iconsInText=e.iconsInText||!0,A=t.paddedRect;const r=t.displaySize;g=g*Sh/h,v={width:r[0],height:r[1],left:1,top:-3,advance:T?r[1]:r[0],localGlyph:!1},P=m?-v.height*g:i*Sh-17-r[1]*g,I=v.advance;const s=(T?r[0]:r[1])*g-Sh*i;s>0&&s>w&&(w=s)}else{const e=r[a.fontStack];if(!e)continue;e[y]&&(A=e[y]);const n=t[a.fontStack];if(!n)continue;const s=n.glyphs[y];if(!s)continue;if(v=s.metrics,I=8203!==y?Sh:0,m){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,r=(e+t)*g;_<r&&(_=r,S=(e-t)/2*g),P=-e*g}else P=(i-g)*Sh-17}T?(e.verticalizable=!0,b.push({glyph:y,imageName:k,x:p,y:d+P,vertical:T,scale:g,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:A}),p+=I*g+u):(b.push({glyph:y,imageName:k,x:p,y:d+P,vertical:T,scale:g,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:A}),p+=v.advance*g+u)}0!==b.length&&(f=Math.max(p-u,f),m?pp(b,y,w,S,s*i/2):pp(b,y,w,0,s/2)),p=0;const A=s*i+w;v.lineOffset=Math.max(w,a),d+=A,++g}var x;const v=d,{horizontalAlign:b,verticalAlign:w}=hp(o);(function(e,t,r,n,i,s){const o=(t-r)*i,a=-s*n;for(const t of e)for(const e of t.positionedGlyphs)e.x+=o,e.y+=a})(e.positionedLines,y,b,w,f,v),e.top+=-w*v,e.bottom=e.top+v,e.left+=-b*f,e.right=e.left+f,e.hasBaseline=m}(w,t,r,n,g,o,a,l,h,u,p,y),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b)&&w}const np={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ip={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function sp(e,t,r,n,i,s){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*Sh/s+i:0}{const n=r[t.fontStack],s=n&&n.glyphs[e];return s?s.metrics.advance*t.scale+i:0}}function op(e,t,r,n){const i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function ap(e,t,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function lp(e,t,r,n,i,s){let o=null,a=op(t,r,i,s);for(const e of n){const n=op(t-e.x,r,i,s)+e.badness;n<=a&&(o=e,a=n)}return{index:e,x:t,priorBreak:o,badness:a}}function up(e){return e?up(e.priorBreak).concat(e.index):[]}function cp(e,t,r,n,i,s,o){if("point"!==s)return[];if(!e)return[];const a=[],l=function(e,t,r,n,i,s){let o=0;for(let r=0;r<e.length();r++){const a=e.getSection(r);o+=sp(e.getCharCode(r),a,n,i,t,s)}return o/Math.max(1,Math.ceil(o/r))}(e,t,r,n,i,o),u=e.text.indexOf("")>=0;let c=0;for(let r=0;r<e.length();r++){const s=e.getSection(r),p=e.getCharCode(r);if(np[p]||(c+=sp(p,s,n,i,t,o)),r<e.length()-1){const t=!((h=p)<11904||!(Pa(h)||Ia(h)||Oa(h)||La(h)||Ma(h)||ba(h)||Ta(h)||Sa(h)||Da(h)||za(h)||Ea(h)||$a(h)||Aa(h)||_a(h)||wa(h)||Ca(h)||ka(h)||Ra(h)||Va(h)||Ba(h)));(ip[p]||t||s.imageName)&&a.push(lp(r+1,c,l,a,ap(p,e.getCharCode(r+1),t&&u),!1))}}var h;return up(lp(e.length(),c,l,a,0,!0))}function hp(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function pp(e,t,r,n,i){if(!(t||r||n||i))return;const s=e.length-1,o=e[s],a=(o.x+o.metrics.advance*o.scale)*t;for(let t=0;t<=s;t++)e[t].x-=a,e[t].y+=r+n+i}function dp(e,t,r){const{horizontalAlign:n,verticalAlign:i}=hp(r),s=t[0]-e.displaySize[0]*n,o=t[1]-e.displaySize[1]*i;return{image:e,top:o,bottom:o+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function fp(e,t,r,n,i,s){const o=e.image;let a;if(o.content){const e=o.content,t=o.pixelRatio||1;a=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}const l=t.left*s,u=t.right*s;let c,h,p,d;"width"===r||"both"===r?(d=i[0]+l-n[3],h=i[0]+u+n[1]):(d=i[0]+(l+u-o.displaySize[0])/2,h=d+o.displaySize[0]);const f=t.top*s,y=t.bottom*s;return"height"===r||"both"===r?(c=i[1]+f-n[0],p=i[1]+y+n[2]):(c=i[1]+(f+y-o.displaySize[1])/2,p=c+o.displaySize[1]),{image:o,top:c,right:h,bottom:p,left:d,collisionPadding:a}}class Anchor extends e{constructor(e,t,r,n,i){super(e,t),this.angle=n,this.z=r,void 0!==i&&(this.segment=i)}clone(){return new Anchor(this.x,this.y,this.z,this.angle,this.segment)}}function yp(e,t,r,n,i){if(void 0===t.segment)return!0;let s=t,o=t.segment+1,a=0;for(;a>-r/2;){if(o--,o<0)return!1;a-=e[o].dist(s),s=e[o]}a+=e[o].dist(e[o+1]),o++;const l=[];let u=0;for(;a<r/2;){const t=e[o],r=e[o+1];if(!r)return!1;let s=e[o-1].angleTo(t)-t.angleTo(r);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:s}),u+=s;a-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;o++,a+=t.dist(r)}return!0}function mp(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function gp(e,t,r){return e?.6*t*r:0}function xp(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function vp(e,t,r,n,i,s){const o=gp(r,i,s),a=xp(r,n)*s;let l=0;const u=mp(e)/2;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1],s=n.dist(i);if(l+s>u){const c=(u-l)/s,h=Oe(n.x,i.x,c),p=Oe(n.y,i.y,c),d=new Anchor(h,p,0,i.angleTo(n),r);return!o||yp(e,d,a,o,t)?d:void 0}l+=s}}function bp(e,t,r,n,i,s,o,a,l){const u=gp(n,s,o),c=xp(n,i),h=c*o,p=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),wp(e,p?t/2*a%t:(c/2+2*s)*o*a%t,t,u,r,h,p,!1,l)}function wp(e,t,r,n,i,s,o,a,l){const u=s/2,c=mp(e);let h=0,p=t-r,d=[];for(let t=0;t<e.length-1;t++){const o=e[t],a=e[t+1],f=o.dist(a),y=a.angleTo(o);for(;p+r<h+f;){p+=r;const m=(p-h)/f,g=Oe(o.x,a.x,m),x=Oe(o.y,a.y,m);if(g>=0&&g<l&&x>=0&&x<l&&p-u>=0&&p+u<=c){const r=new Anchor(g,x,0,y,t);r._round(),n&&!yp(e,r,s,n,i)||d.push(r)}}h+=f}return a||d.length||o||(d=wp(e,h/2,r,n,i,s,o,!0,l)),d}function _p(t,r,n,i){const s=[],o=t.image,a=o.pixelRatio,l=o.paddedRect.w-2,u=o.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,p=o.stretchX||[[0,l]],d=o.stretchY||[[0,u]],f=(e,t)=>e+t[1]-t[0],y=p.reduce(f,0),m=d.reduce(f,0),g=l-y,x=u-m;let v=0,b=y,w=0,_=m,S=0,A=g,k=0,I=x;if(o.content&&i){const e=o.content;v=Sp(p,0,e[0]),w=Sp(d,0,e[1]),b=Sp(p,e[0],e[2]),_=Sp(d,e[1],e[3]),S=e[0]-v,k=e[1]-w,A=e[2]-e[0]-b,I=e[3]-e[1]-_}const P=(i,s,l,u)=>{const p=kp(i.stretch-v,b,c,t.left),d=Ip(i.fixed-S,A,i.stretch,y),f=kp(s.stretch-w,_,h,t.top),g=Ip(s.fixed-k,I,s.stretch,m),x=kp(l.stretch-v,b,c,t.left),P=Ip(l.fixed-S,A,l.stretch,y),T=kp(u.stretch-w,_,h,t.top),C=Ip(u.fixed-k,I,u.stretch,m),E=new e(p,f),M=new e(x,f),D=new e(x,T),z=new e(p,T),B=new e(d/a,g/a),V=new e(P/a,C/a),L=r*Math.PI/180;if(L){const e=Math.sin(L),t=Math.cos(L),r=[t,-e,e,t];E._matMult(r),M._matMult(r),z._matMult(r),D._matMult(r)}const F=i.stretch+i.fixed,R=s.stretch+s.fixed;return{tl:E,tr:M,bl:z,br:D,tex:{x:o.paddedRect.x+1+F,y:o.paddedRect.y+1+R,w:l.stretch+l.fixed-F,h:u.stretch+u.fixed-R},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:B,pixelOffsetBR:V,minFontScaleX:A/a/c,minFontScaleY:I/a/h,isSDF:n}};if(i&&(o.stretchX||o.stretchY)){const e=Ap(p,g,y),t=Ap(d,x,m);for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)s.push(P(n,t[e],i,t[e+1]))}}else s.push(P({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:u+1}));return s}function Sp(e,t,r){let n=0;for(const i of e)n+=Math.max(t,Math.min(r,i[1]))-Math.max(t,Math.min(r,i[0]));return n}function Ap(e,t,r){const n=[{fixed:-1,stretch:0}];for(const[t,r]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(r-t)})}return n.push({fixed:t+1,stretch:r}),n}function kp(e,t,r,n){return e/t*r+n}function Ip(e,t,r,n){return e-t*r/n}function Pp(e,t,r,n){const i=t+e.positionedLines[n].lineOffset;return 0===n?r+i/2:r+(i+(t+e.positionedLines[n-1].lineOffset))/2}ko(Anchor,"Anchor");class TinyQueue{constructor(e=[],t=Tp){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;e>0;){const i=e-1>>1,s=t[i];if(r(n,s)>=0)break;t[e]=s,e=i}t[e]=n}_down(e){const{data:t,compare:r}=this,n=this.length>>1,i=t[e];for(;e<n;){let n=1+(e<<1),s=t[n];const o=n+1;if(o<this.length&&r(t[o],s)<0&&(n=o,s=t[o]),r(s,i)>=0)break;t[e]=s,e=n}t[e]=i}}function Tp(e,t){return e<t?-1:e>t?1:0}function Cp(t,r=1,n=!1){let i=1/0,s=1/0,o=-1/0,a=-1/0;const l=t[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<i)&&(i=t.x),(!e||t.y<s)&&(s=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>a)&&(a=t.y)}const u=Math.min(o-i,a-s);let c=u/2;const h=new TinyQueue([],Ep);if(0===u)return new e(i,s);for(let e=i;e<o;e+=u)for(let r=s;r<a;r+=u)h.push(new Mp(e+c,r+c,c,t));let p=function(e){let t=0,r=0,n=0;const i=e[0];for(let e=0,s=i.length,o=s-1;e<s;o=e++){const s=i[e],a=i[o],l=s.x*a.y-a.x*s.y;r+=(s.x+a.x)*l,n+=(s.y+a.y)*l,t+=3*l}return new Mp(r/t,n/t,0,e)}(t),d=h.length;for(;h.length;){const e=h.pop();(e.d>p.d||!p.d)&&(p=e,n&&console.log("found best %d after %d probes",Math.round(1e4*e.d)/1e4,d)),e.max-p.d<=r||(c=e.h/2,h.push(new Mp(e.p.x-c,e.p.y-c,c,t)),h.push(new Mp(e.p.x+c,e.p.y-c,c,t)),h.push(new Mp(e.p.x-c,e.p.y+c,c,t)),h.push(new Mp(e.p.x+c,e.p.y+c,c,t)),d+=4)}return n&&(console.log(`num probes: ${d}`),console.log(`best distance: ${p.d}`)),p.p}function Ep(e,t){return t.max-e.max}function Mp(t,r,n,i){this.p=new e(t,r),this.h=n,this.d=function(e,t){let r=!1,n=1/0;for(let i=0;i<t.length;i++){const s=t[i];for(let t=0,i=s.length,o=i-1;t<i;o=t++){const i=s[t],a=s[o];i.y>e.y!=a.y>e.y&&e.x<(a.x-i.x)*(e.y-i.y)/(a.y-i.y)+i.x&&(r=!r),n=Math.min(n,au(e,i,a))}}return(r?1:-1)*Math.sqrt(n)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const Dp=Number.POSITIVE_INFINITY,zp=Math.sqrt(2);function Bp(e,t,r,n,i,s,o,a,l,u){e.createArrays(),e.tilePixelRatio=zl/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const c=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:r}=e.textSizeData;p.compositeTextSizes=[h["text-size"].possiblyEvaluate(new EvaluationParameters(t),a),h["text-size"].possiblyEvaluate(new EvaluationParameters(r),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:r}=e.iconSizeData;p.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new EvaluationParameters(t),a),h["icon-size"].possiblyEvaluate(new EvaluationParameters(r),a)]}p.layoutTextSize=h["text-size"].possiblyEvaluate(new EvaluationParameters(l+1),a),p.layoutIconSize=h["icon-size"].possiblyEvaluate(new EvaluationParameters(l+1),a),p.textMaxSize=h["text-size"].possiblyEvaluate(new EvaluationParameters(18),a);const d="map"===c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement"),f=c.get("text-size");for(const s of e.features){const l=c.get("text-font").evaluate(s,{},a).join(","),h=f.evaluate(s,{},a),g=p.layoutTextSize.evaluate(s,{},a),x=(p.layoutIconSize.evaluate(s,{},a),{horizontal:{},vertical:void 0}),v=s.text;let w,_=[0,0];if(v){const n=v.toString(),o=c.get("text-letter-spacing").evaluate(s,{},a)*Sh,u=c.get("text-line-height").evaluate(s,{},a)*Sh,p=Na(n)?o:0,f=c.get("text-anchor").evaluate(s,{},a),b=c.get("text-variable-anchor");if(!b){const e=c.get("text-radial-offset").evaluate(s,{},a);e?(y=f,_=(m=[e*Sh,Dp])[1]!==Dp?function(e,t,r){let n=0,i=0;switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":i=r-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-r}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}return[n,i]}(y,m[0],m[1]):function(e,t){let r=0,n=0;t<0&&(t=0);const i=t/zp;switch(e){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-t;break;case"top":n=t-7}switch(e){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=t;break;case"right":r=-t}return[r,n]}(y,m[0])):_=c.get("text-offset").evaluate(s,{},a).map((e=>e*Sh))}let w=d?"center":c.get("text-justify").evaluate(s,{},a);const S=c.get("symbol-placement"),A="point"===S,k="point"===S?c.get("text-max-width").evaluate(s,{},a)*Sh:0,I=s=>{e.allowVerticalPlacement&&Ua(n)&&(x.vertical=rp(v,t,r,i,l,k,u,f,s,p,_,tp.vertical,!0,S,g,h))};if(!d&&b){const e="auto"===w?b.map((e=>Vp(e))):[w];let n=!1;for(let s=0;s<e.length;s++){const o=e[s];if(!x.horizontal[o])if(n)x.horizontal[o]=x.horizontal[0];else{const e=rp(v,t,r,i,l,k,u,"center",o,p,_,tp.horizontal,!1,S,g,h);e&&(x.horizontal[o]=e,n=1===e.positionedLines.length)}}I("left")}else{if("auto"===w&&(w=Vp(f)),A||c.get("text-writing-mode").indexOf("horizontal")>=0||!Ua(n)){const e=rp(v,t,r,i,l,k,u,f,w,p,_,tp.horizontal,!1,S,g,h);e&&(x.horizontal[w]=e)}I("point"===S?"left":w)}}let S=!1;if(s.icon&&s.icon.name){const t=n[s.icon.name];t&&(w=dp(i[s.icon.name],c.get("icon-offset").evaluate(s,{},a),c.get("icon-anchor").evaluate(s,{},a)),S=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&b("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==c.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const A=Op(x.horizontal)||x.vertical;e.iconsInText||(e.iconsInText=!!A&&A.iconsInText),(A||w)&&Lp(e,s,x,w,n,p,g,0,_,S,o,a,u)}var y,m;s&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function Vp(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lp(t,r,n,i,o,a,l,u,c,h,p,d,f){let y=a.textMaxSize.evaluate(r,{},d);void 0===y&&(y=l);const m=t.layers[0].layout,g=m.get("icon-offset").evaluate(r,{},d),x=Op(n.horizontal)||n.vertical,v="globe"===f.name,w=l/24,_=t.tilePixelRatio*y/24,S=(M=t.overscaling,t.zoom>18&&M>2&&(M>>=1),Math.max(zl/(512*M),1)*m.get("symbol-spacing")),A=m.get("text-padding")*t.tilePixelRatio,k=m.get("icon-padding")*t.tilePixelRatio,I=s(m.get("text-max-angle")),P="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),T="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),C=m.get("symbol-placement"),E=S/2;var M;const D=m.get("icon-text-fit");let z;i&&"none"!==D&&(t.allowVerticalPlacement&&n.vertical&&(z=fp(i,n.vertical,D,m.get("icon-text-fit-padding"),g,w)),x&&(i=fp(i,x,D,m.get("icon-text-fit-padding"),g,w)));const B=(e,s,l)=>{if(s.x<0||s.x>=zl||s.y<0||s.y>=zl)return;let u=null;if(v){const{x:e,y:t,z:r}=f.projectTilePoint(s.x,s.y,l);u={anchor:new Anchor(e,t,r,0,void 0),up:f.upVector(l,s.x,s.y)}}!function(e,t,r,n,i,s,o,a,l,u,c,h,p,d,f,y,m,g,x,v,w,_,S,A,k){const I=e.addToLineVertexArray(t,n);let P,T,C,E,M,D,z,B=0,V=0,L=0,F=0,R=-1,O=-1;const j={};let q=vl("");const $=r?r.anchor:t;let U=0,N=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[U,N]=l.layout.get("text-offset").evaluate(w,{},k).map((e=>e*Sh)):(U=l.layout.get("text-radial-offset").evaluate(w,{},k)*Sh,N=Dp),e.allowVerticalPlacement&&i.vertical){const e=i.vertical;if(f)D=qp(e),a&&(z=qp(a));else{const r=l.layout.get("text-rotate").evaluate(w,{},k)+90;C=jp(u,$,t,c,h,p,e,d,r,y),a&&(E=jp(u,$,t,c,h,p,a,g,r))}}if(s){const n=l.layout.get("icon-rotate").evaluate(w,{},k),i="none"!==l.layout.get("icon-text-fit"),o=_p(s,n,S,i),d=a?_p(a,n,S,i):void 0;T=jp(u,$,t,c,h,p,s,g,n),B=4*o.length;const f=e.iconSizeData;let y=null;"source"===f.kind?(y=[Ah*l.layout.get("icon-size").evaluate(w,{},k)],y[0]>Fp&&b(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(y=[Ah*_.compositeIconSizes[0].evaluate(w,{},k),Ah*_.compositeIconSizes[1].evaluate(w,{},k)],(y[0]>Fp||y[1]>Fp)&&b(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,o,y,v,x,w,!1,r,t,I.lineStartIndex,I.lineLength,-1,A,k),R=e.icon.placedSymbolArray.length-1,d&&(V=4*d.length,e.addSymbols(e.icon,d,y,v,x,w,tp.vertical,r,t,I.lineStartIndex,I.lineLength,-1,A,k),O=e.icon.placedSymbolArray.length-1)}for(const n in i.horizontal){const s=i.horizontal[n];P||(q=vl(s.text),f?M=qp(s):P=jp(u,$,t,c,h,p,s,d,l.layout.get("text-rotate").evaluate(w,{},k),y));const a=1===s.positionedLines.length;if(L+=Rp(e,r,t,s,o,l,f,w,y,I,i.vertical?tp.horizontal:tp.horizontalOnly,a?Object.keys(i.horizontal):[n],j,R,_,A,k),a)break}i.vertical&&(F+=Rp(e,r,t,i.vertical,o,l,f,w,y,I,tp.vertical,["vertical"],j,O,_,A,k));let K=-1;const Z=(e,t)=>e?Math.max(e,t):t;K=Z(M,K),K=Z(D,K),K=Z(z,K);const G=K>-1?1:0;e.glyphOffsetArray.length>=SymbolBucket.MAX_GLYPHS&&b("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==w.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,w.sortKey),e.symbolInstances.emplaceBack($.x,$.y,$.z,t.x,t.y,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,R,O,q,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,void 0!==T?T:e.collisionBoxArray.length,void 0!==T?T+1:e.collisionBoxArray.length,E||e.collisionBoxArray.length,E?E+1:e.collisionBoxArray.length,c,L,F,B,V,G,0,U,N,K)}(t,s,u,e,n,i,o,z,t.layers[0],t.collisionBoxArray,r.index,r.sourceLayerIndex,t.index,A,P,c,0,k,T,g,r,a,h,p,d)};if("line"===C)for(const s of function(t,r,n,i,s){const o=[];for(let r=0;r<t.length;r++){const n=t[r];let a;for(let t=0;t<n.length-1;t++){let r=n[t],l=n[t+1];r.x<0&&l.x<0||(r.x<0?r=new e(0,r.y+(0-r.x)/(l.x-r.x)*(l.y-r.y))._round():l.x<0&&(l=new e(0,r.y+(0-r.x)/(l.x-r.x)*(l.y-r.y))._round()),r.y<0&&l.y<0||(r.y<0?r=new e(r.x+(0-r.y)/(l.y-r.y)*(l.x-r.x),0)._round():l.y<0&&(l=new e(r.x+(0-r.y)/(l.y-r.y)*(l.x-r.x),0)._round()),r.x>=i&&l.x>=i||(r.x>=i?r=new e(i,r.y+(i-r.x)/(l.x-r.x)*(l.y-r.y))._round():l.x>=i&&(l=new e(i,r.y+(i-r.x)/(l.x-r.x)*(l.y-r.y))._round()),r.y>=s&&l.y>=s||(r.y>=s?r=new e(r.x+(s-r.y)/(l.y-r.y)*(l.x-r.x),s)._round():l.y>=s&&(l=new e(r.x+(s-r.y)/(l.y-r.y)*(l.x-r.x),s)._round()),a&&r.equals(a[a.length-1])||(a=[r],o.push(a)),a.push(l)))))}}return o}(r.geometry,0,0,zl,zl)){const e=bp(s,S,I,n.vertical||x,i,24,_,t.overscaling,zl);for(const r of e){const e=x;e&&$p(t,e.text,E,r)||B(s,r,d)}}else if("line-center"===C){for(const e of r.geometry)if(e.length>1){const t=vp(e,I,n.vertical||x,i,24,_);t&&B(e,t,d)}}else if("Polygon"===r.type)for(const e of Tc(r.geometry,0)){const t=Cp(e,16);B(e[0],new Anchor(t.x,t.y,0,0,void 0),d)}else if("LineString"===r.type)for(const e of r.geometry)B(e,new Anchor(e[0].x,e[0].y,0,0,void 0),d);else if("Point"===r.type)for(const e of r.geometry)for(const t of e)B([t],new Anchor(t.x,t.y,0,0,void 0),d)}const Fp=32640;function Rp(t,r,n,i,s,o,a,l,u,c,h,p,d,f,y,m,g){const x=function(t,r,n,i,s,o,a,l){const u=[];if(0===r.positionedLines.length)return u;const c=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,h=function(e){const t=e[0],r=e[1],n=t*r;return n>0?[t,-r]:n<0?[-t,r]:0===t?[r,t]:[r,-t]}(n);let p=Math.abs(r.top-r.bottom);for(const e of r.positionedLines)p-=e.lineOffset;const d=r.positionedLines.length,f=p/d;let y=r.top-n[1];for(let t=0;t<d;++t){const i=r.positionedLines[t];y=Pp(r,f,y,t);for(const t of i.positionedGlyphs){if(!t.rect)continue;const i=t.rect||{};let o=4,p=!0,d=1,f=0;if(t.imageName){const e=a[t.imageName];if(!e)continue;if(e.sdf){b("SDF images are not supported in formatted text and will be ignored.");continue}p=!1,d=e.pixelRatio,o=1/d}const m=(s||l)&&t.vertical,g=t.metrics.advance*t.scale/2,x=t.metrics,v=t.rect;if(null===v)continue;l&&r.verticalizable&&(f=t.imageName?g-t.metrics.width*t.scale/2:0);const w=s?[t.x+g,t.y]:[0,0];let _=[0,0],S=[0,0],A=!1;s||(m?(S=[t.x+g+h[0],t.y+h[1]-f],A=!0):_=[t.x+g+n[0],t.y+n[1]-f]);const k=v.w*t.scale/(d*(t.localGlyph?2:1)),I=v.h*t.scale/(d*(t.localGlyph?2:1));let P,T,C,E;if(m){const r=t.y-y,n=new e(-g,g-r),i=-Math.PI/2,s=new e(...S);P=new e(-g+_[0],_[1]),P._rotateAround(i,n)._add(s),P.x+=-r+g,P.y-=(x.left-o)*t.scale;const a=t.imageName?x.advance*t.scale:Sh*t.scale,l=String.fromCharCode(t.glyph);Eh(l)?P.x+=(1-o)*t.scale:Mh(l)?P.x+=a-x.height*t.scale+(-o-1)*t.scale:P.x+=t.imageName||x.width+2*o===v.w&&x.height+2*o===v.h?(a-I)/2:(a-(x.height+2*o)*t.scale)/2,T=new e(P.x,P.y-k),C=new e(P.x+I,P.y),E=new e(P.x+I,P.y-k)}else{const r=(x.left-o)*t.scale-g+_[0],n=(-x.top-o)*t.scale+_[1],i=r+k,s=n+I;P=new e(r,n),T=new e(i,n),C=new e(r,s),E=new e(i,s)}if(c){let t;t=s?new e(0,0):A?new e(h[0],h[1]):new e(n[0],n[1]),P._rotateAround(c,t),T._rotateAround(c,t),C._rotateAround(c,t),E._rotateAround(c,t)}const M=new e(0,0),D=new e(0,0);u.push({tl:P,tr:T,bl:C,br:E,tex:i,writingMode:r.writingMode,glyphOffset:w,sectionIndex:t.sectionIndex,isSDF:p,pixelOffsetTL:M,pixelOffsetBR:D,minFontScaleX:0,minFontScaleY:0})}}return u}(0,i,u,o,a,l,s,t.allowVerticalPlacement),v=t.textSizeData;let w=null;"source"===v.kind?(w=[Ah*o.layout.get("text-size").evaluate(l,{},g)],w[0]>Fp&&b(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===v.kind&&(w=[Ah*y.compositeTextSizes[0].evaluate(l,{},g),Ah*y.compositeTextSizes[1].evaluate(l,{},g)],(w[0]>Fp||w[1]>Fp)&&b(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,x,w,u,a,l,h,r,n,c.lineStartIndex,c.lineLength,f,m,g);for(const e of p)d[e]=t.text.placedSymbolArray.length-1;return 4*x.length}function Op(e){for(const t in e)return e[t];return null}function jp(t,r,n,i,o,a,l,u,c,h){let p=l.top,d=l.bottom,f=l.left,y=l.right;const m=l.collisionPadding;if(m&&(f-=m[0],p-=m[1],y+=m[2],d+=m[3]),c){const t=new e(f,p),r=new e(y,p),n=new e(f,d),i=new e(y,d),o=s(c);let a=new e(0,0);h&&(a=new e(h[0],h[1])),t._rotateAround(o,a),r._rotateAround(o,a),n._rotateAround(o,a),i._rotateAround(o,a),f=Math.min(t.x,r.x,n.x,i.x),y=Math.max(t.x,r.x,n.x,i.x),p=Math.min(t.y,r.y,n.y,i.y),d=Math.max(t.y,r.y,n.y,i.y)}return t.emplaceBack(r.x,r.y,r.z,n.x,n.y,f,p,y,d,u,i,o,a),t.length-1}function qp(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function $p(e,t,r,n){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<r)return!0}else i[t]=[];return i[t].push(n),!1}dl([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]);const Up=dl([{name:"a_pos_3",components:3,type:"Int16"}]);var Np=dl([{name:"a_pos",type:"Int16",components:2}]);const Kp=zl/Math.PI/2,Zp=2*Ol(1,0)*Kp*Math.PI,Gp=-Kp,Xp=Kp,Yp=[new Aabb([Gp,Gp,Gp],[Xp,Xp,Xp]),new Aabb([Gp,Gp,Gp],[0,0,Xp]),new Aabb([0,Gp,Gp],[Xp,0,Xp]),new Aabb([Gp,0,Gp],[0,Xp,Xp]),new Aabb([0,0,Gp],[Xp,Xp,Xp])];function Wp(e,t,r,n=!0){const i=Tu([],e._camera.position,e.worldSize),s=[t,r,1,1];Vu(s,s,e.pixelMatrixInverse),function(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r}(s,s,1/s[3]);const l=Eu([],Bu([],s,i)),u=e.globeMatrix,c=[u[12],u[13],u[14]],h=Bu([],c,i),p=ku(h),d=Eu([],h),f=e.worldSize/(2*Math.PI),y=Mu(d,l),m=Math.asin(f/p);if(m<Math.acos(y)){if(!n)return null;const e=[],t=[];Tu(e,l,p/y),Eu(t,Bu(t,e,h)),Eu(l,Pu(l,h,Tu(l,t,Math.tan(m)*p)))}const g=[];new Ray(i,l).closestPointOnSphere(c,f,g);const x=Eu([],T(u,0)),v=Eu([],T(u,1)),b=Eu([],T(u,2)),w=Mu(x,g),_=Mu(v,g),S=Mu(b,g),A=o(Math.asin(-_/f));let k=o(Math.atan2(w,S));k=e.center.lng+function(e,t){const r=(t-e+180)%360-180;return r<-180?r+360:r}(e.center.lng,k);const I=Fl(k),P=a(Rl(A),0,1);return new MercatorCoordinate(I,P)}function Jp(e){if(e.z<=1)return Yp[e.z+2*e.y+e.x];const[t,r]=function(e){const t=1<<e.z,r=e.x/t,n=(e.x+1)/t,i=(e.y+1)/t;return[[ql(e.y/t),jl(r)],[ql(i),jl(n)]]}(e),n=[Hp(t[0],t[1]),Hp(t[0],r[1]),Hp(r[0],t[1]),Hp(r[0],r[1])],i=[Xp,Xp,Xp],s=[Gp,Gp,Gp];for(const e of n)i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.min(i[2],e[2]),s[0]=Math.max(s[0],e[0]),s[1]=Math.max(s[1],e[1]),s[2]=Math.max(s[2],e[2]);return new Aabb(i,s)}function Hp(e,t,r){return function(e,t,r,n=Kp){return r=s(r),[e*Math.sin(r)*n,-t*n,e*Math.cos(r)*n]}(Math.cos(s(e)),Math.sin(s(e)),t,r)}function Qp(e,t,r){const n=Math.pow(2,r.z),i=(e/zl+r.x)/n;return Hp(ql((t/zl+r.y)/n),jl(i))}function ed(e){return 16383/Math.max(...Bu([],e.max,e.min))}function td(e){const t=vu(new Float64Array(16)),r=ed(e);return _u(t,t,[r,r,r]),wu(t,t,function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}([],e.min)),t}function rd(e,t){const r=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),s=Math.sin(r)*i/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),o=Math.sin(e._pitch)*s+i;return Math.min(1.01*o,i*(1/e._horizonShift))}function nd(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),n=e.x*r,i=(e.x+1)*r,s=e.y*r,o=(e.y+1)*r,a=jl(n),l=jl(i),u=ql(s),c=ql(o),h=t.project(a,u),p=t.project(l,u),d=t.project(l,c),f=t.project(a,c);let y=Math.min(h.x,p.x,d.x,f.x),m=Math.min(h.y,p.y,d.y,f.y),g=Math.max(h.x,p.x,d.x,f.x),x=Math.max(h.y,p.y,d.y,f.y);const v=r/16;function b(e,r,n,i,s,o){const a=(n+s)/2,l=(i+o)/2,u=t.project(jl(a),ql(l)),c=Math.max(0,y-u.x,m-u.y,u.x-g,u.y-x);y=Math.min(y,u.x),g=Math.max(g,u.x),m=Math.min(m,u.y),x=Math.max(x,u.y),c>v&&(b(e,u,n,i,a,l),b(u,r,a,l,s,o))}b(h,p,n,s,i,s),b(p,d,i,s,i,o),b(d,f,i,o,n,o),b(f,h,n,o,n,s),y-=v,m-=v,g+=v,x+=v;const w=1/Math.max(g-y,x-m);return{scale:w,x:y*w,y:m*w,x2:g*w,y2:x*w,projection:t}}const id=vu(new Float32Array(16));class Projection{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new LngLat(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r=!0){return e._coordinatePoint(e.locationCoordinate(t),r)}pixelsPerMeter(e,t){return Ol(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return rd(e,e.pixelsPerMeter)}pointCoordinate(t,r,n,i){const s=t.horizonLineFromTop(!1),o=new e(r,Math.max(s,n));return t.rayIntersectionCoordinate(t.pointRayIntersection(o,i))}pointCoordinate3D(t,r,n){const i=new e(r,n);if(t.elevation)return t.elevation.pointCoordinate(i);{const e=this.pointCoordinate(t,i.x,i.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return id}createTileMatrix(e,t,r){let n,i,s;const o=r.canonical,a=vu(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=nd(o,this);n=1,i=l.x+r.wrap*l.scale,s=l.y,_u(a,a,[n/l.scale,n/l.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(o.z),i=(o.x+Math.pow(2,o.z)*r.wrap)*n,s=o.y*n;return wu(a,a,[i,s,0]),_u(a,a,[n/zl,n/zl,1]),a}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class Albers extends Projection{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(s(t));this.n=(n+Math.sin(s(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:n,r0:i}=this,o=s(e-this.center[0]),a=s(t),l=Math.sqrt(n-2*r*Math.sin(a))/r;return{x:l*Math.sin(o*r),y:l*Math.cos(o*r)-i,z:0}}unproject(e,t){const{n:r,c:n,r0:i}=this,u=i+t;let c=Math.atan2(e,Math.abs(u))*Math.sign(u);u*r<0&&(c-=Math.PI*Math.sign(e)*Math.sign(u));const h=s(this.center[0])*r;c=l(c,-Math.PI-h,Math.PI-h);const p=o(c/r)+this.center[0],d=Math.asin(a((n-(e*e+u*u)*r*r)/(2*r),-1,1)),f=a(o(d),-85.051129,$l);return new LngLat(p,f)}}const sd=1.340264,od=-.081106,ad=893e-6,ld=.003796,ud=Math.sqrt(3)/2;class EqualEarth extends Projection{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(ud*Math.sin(t)),n=r*r,i=n*n*n;return{x:.5*(e*Math.cos(r)/(ud*(sd+3*od*n+i*(7*ad+9*ld*n)))/Math.PI+.5),y:1-.5*(r*(sd+od*n+i*(ad+ld*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=r*r,i=n*n*n;for(let e,s,o,l=0;l<12&&(s=r*(sd+od*n+i*(ad+ld*n))-t,o=sd+3*od*n+i*(7*ad+9*ld*n),e=s/o,r=a(r-e,-Math.PI/3,Math.PI/3),n=r*r,i=n*n*n,!(Math.abs(e)<1e-12));++l);const s=ud*e*(sd+3*od*n+i*(7*ad+9*ld*n))/Math.cos(r),o=Math.asin(Math.sin(r)/ud),l=a(180*s/Math.PI,-180,180),u=a(180*o/Math.PI,-85.051129,$l);return new LngLat(l,u)}}class Equirectangular extends Projection{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),n=a(360*(.5-t),-85.051129,$l);return new LngLat(r,n)}}const cd=Math.PI/2;function hd(e){return Math.tan((cd+e)/2)}class LambertConformalConic extends Projection{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30],n=s(t),i=s(r),o=Math.cos(n);this.n=n===i?Math.sin(n):Math.log(o/Math.cos(i))/Math.log(hd(i)/hd(n)),this.f=o*Math.pow(hd(n),this.n)/this.n}project(e,t){t=s(t),e=s(e-this.center[0]);const r=1e-6,{n:n,f:i}=this;i>0?t<-cd+r&&(t=-cd+r):t>cd-r&&(t=cd-r);const o=i/Math.pow(hd(t),n),a=o*Math.sin(n*e),l=i-o*Math.cos(n*e);return{x:.5*(a/Math.PI+.5),y:1-.5*(l/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:r,f:n}=this,i=n-t,s=Math.sign(i),l=Math.sign(r)*Math.sqrt(e*e+i*i);let u=Math.atan2(e,Math.abs(i))*s;i*r<0&&(u-=Math.PI*Math.sign(e)*s);const c=a(o(u/r)+this.center[0],-180,180),h=a(o(2*Math.atan(Math.pow(n/l,1/r))-cd),-85.051129,$l);return new LngLat(c,h)}}class Mercator extends Projection{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Fl(e),y:Rl(t),z:0}}unproject(e,t){const r=jl(e),n=ql(t);return new LngLat(r,n)}}const pd=s($l);class NaturalEarth extends Projection{project(e,t){const r=(t=s(t))*t,n=r*r;return{x:.5*((e=s(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=25,i=0,s=r*r;do{s=r*r;const e=s*s;i=(r*(1.007226+s*(.015085+e*(.028874*s-.044475-.005916*e)))-t)/(1.007226+s*(.045255+e*(.259866*s-.311325-.005916*11*e))),r=a(r-i,-pd,pd)}while(Math.abs(i)>1e-6&&--n>0);s=r*r;const l=a(o(e/(.8707+s*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979))),-180,180),u=o(r);return new LngLat(l,u)}}const dd=s($l);class WinkelTripel extends Projection{project(e,t){t=s(t),e=s(e);const r=Math.cos(t),n=2/Math.PI,i=Math.acos(r*Math.cos(e/2)),o=Math.sin(i)/i,a=.5*(e*n+2*r*Math.sin(e/2)/o)||0,l=.5*(t+Math.sin(t)/o)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(l/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,i=25;const s=1e-6;let l=0,u=0;do{const i=Math.cos(n),s=Math.sin(n),o=2*s*i,c=s*s,h=i*i,p=Math.cos(r/2),d=Math.sin(r/2),f=2*p*d,y=d*d,m=1-h*p*p,g=m?1/m:0,x=m?Math.acos(i*p)*Math.sqrt(1/m):0,v=.5*(2*x*i*d+2*r/Math.PI)-e,b=.5*(x*s+n)-t,w=.5*g*(h*y+x*i*p*c)+1/Math.PI,_=g*(f*o/4-x*s*d),S=.125*g*(o*d-x*s*h*f),A=.5*g*(c*p+x*y*i)+.5,k=_*S-A*w;l=(b*_-v*A)/k,u=(v*S-b*w)/k,r=a(r-l,-Math.PI,Math.PI),n=a(n-u,-dd,dd)}while((Math.abs(l)>s||Math.abs(u)>s)&&--i>0);return new LngLat(o(r),o(n))}}class CylindricalEqualArea extends Projection{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(s(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:n}=this;return{x:s(e)*n*r+.5,y:-Math.sin(s(t))/n*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:n}=this,i=-(t-.5)/r,s=a(o((e-.5)/r)/n,-180,180),l=Math.asin(a(i*n,-1,1)),u=a(o(l),-85.051129,$l);return new LngLat(s,u)}}class Globe extends Mercator{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,r){const n=Math.pow(2,r.z),i=(e/zl+r.x)/n,s=Hp(ql((t/zl+r.y)/n),jl(i));return Du(s,s,td(Jp(r))),{x:s[0],y:s[1],z:s[2]}}locationPoint(t,r){const n=Hp(r.lat,r.lng),i=Eu([],n),s=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude;Cu(n,n,i,Ol(1,0)*zl*s);const o=vu(new Float64Array(16));return bu(o,t.pixelMatrix,t.globeMatrix),Du(n,n,o),new e(n[0],n[1])}pixelsPerMeter(e,t){return Ol(1,0)*t}pixelSpaceConversion(e,t,r){const n=Oe(Ol(1,45)*t,Ol(1,e)*t,r);return this.pixelsPerMeter(e,t)/n}createTileMatrix(e,t,r){const n=function(e){const t=vu(new Float64Array(16)),r=1/ed(e);return wu(t,t,e.min),_u(t,t,[r,r,r]),t}(Jp(r.canonical));return bu(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,t){const{center:r}=e,n=vu(new Float64Array(16));return bu(n,n,td(Jp(t))),function(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],u=t[8],c=t[9],h=t[10],p=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-u*n,e[1]=o*i-c*n,e[2]=a*i-h*n,e[3]=l*i-p*n,e[8]=s*n+u*i,e[9]=o*n+c*i,e[10]=a*n+h*i,e[11]=l*n+p*i}(n,n,s(r.lng)),function(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],c=t[9],h=t[10],p=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+u*n,e[5]=o*i+c*n,e[6]=a*i+h*n,e[7]=l*i+p*n,e[8]=u*i-s*n,e[9]=c*i-o*n,e[10]=h*i-a*n,e[11]=p*i-l*n}(n,n,s(r.lat)),_u(n,n,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(n)}pointCoordinate(e,t,r,n){return Wp(e,t,r,!0)||new MercatorCoordinate(0,0)}pointCoordinate3D(e,t,r){const n=this.pointCoordinate(e,t,r,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!Wp(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const r=e.cameraToCenterDistance,n=e._centerAltitude*t,i=e._camera,s=e._camera.forward(),o=Pu([],Tu([],s,-r),[0,0,n]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],u=e.width/e.height,c=Math.tan(e.fovAboveCenter),h=Tu([],i.up(),c),p=Tu([],i.right(),c*u),d=Eu([],Pu([],Pu([],s,h),p)),f=[];let y;if(new Ray(o,d).closestPointOnSphere(l,a,f)){const t=Pu([],f,l),r=Bu([],t,o);y=Math.cos(e.fovAboveCenter)*ku(r)}else{const e=Bu([],o,l),t=Bu([],l,o);Eu(t,t);const r=ku(e)-a;y=Math.sqrt(r*(r+2*a));const n=Math.acos(y/(a+r))-Math.acos(Mu(s,t));y*=Math.cos(n)}return 1.01*y}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=(n=a(((n=e.zoom)-5)/1,0,1))*n*(3-2*n);var n;if(r>0){const n=rd(e,Ol(1,e.center.lat)*e.worldSize),i=e.worldSize/(2*Math.PI),s=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Oe(t,n+i*(1-Math.cos(s)),Math.pow(r,10))}return t}upVector(e,t,r){const n=1<<e.z,i=(t/zl+e.x)/n;return Hp(ql((r/zl+e.y)/n),jl(i),1)}upVectorScale(e){return{metersToTile:Zp*ed(Jp(e))}}}function fd(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Mercator(e);case"equirectangular":return new Equirectangular(e);case"naturalEarth":return new NaturalEarth(e);case"equalEarth":return new EqualEarth(e);case"winkelTripel":return new WinkelTripel(e);case"albers":return r?new CylindricalEqualArea(e):new Albers(e);case"lambertConformalConic":return r?new CylindricalEqualArea(e):new LambertConformalConic(e);case"globe":return new Globe(e)}throw new Error(`Invalid projection name: ${e.name}`)}const yd=Zc.VectorTileFeature.types,md=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gd(e,t,r,n,i,s,o,a,l,u,c,h,p){const d=a?Math.min(Fp,Math.round(a[0])):0,f=a?Math.min(Fp,Math.round(a[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),s,o,(d<<1)+(l?1:0),f,16*u,16*c,256*h,256*p)}function xd(e,t,r,n,i,s,o){e.emplaceBack(t,r,n,i,s,o)}function vd(e,t,r,n,i){e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i)}function bd(e){for(const t of e.sections)if(Wa(t.text))return!0;return!1}class SymbolBuffers{constructor(e){this.layoutVertexArray=new StructArrayLayout4i4ui4i24,this.indexArray=new StructArrayLayout3ui6,this.programConfigurations=e,this.segments=new SegmentVector,this.dynamicLayoutVertexArray=new StructArrayLayout4f16,this.opacityVertexArray=new StructArrayLayout1ul4,this.placedSymbolArray=new PlacedSymbolArray,this.globeExtVertexArray=new StructArrayLayout3i3f20}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,md,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xh.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ko(SymbolBuffers,"SymbolBuffers");class CollisionBuffers{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new SegmentVector,this.collisionVertexArray=new StructArrayLayout2ub2f12,this.collisionVertexArrayExt=new StructArrayLayout3f12}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,bh.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,wh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ko(CollisionBuffers,"CollisionBuffers");class SymbolBucket{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vu([]),this.placementViewportMatrix=vu([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kh(this.zoom,t["text-size"]),this.iconSizeData=kh(this.zoom,t["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map((e=>tp[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new SymbolBuffers(new ProgramConfigurationSet(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new SymbolBuffers(new ProgramConfigurationSet(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new GlyphOffsetArray,this.lineVertexArray=new SymbolLineVertexArray,this.symbolInstances=new SymbolInstanceArray}calculateGlyphDependencies(e,t,r,n,i){for(let r=0;r<e.length;r++)if(t[e.charCodeAt(r)]=!0,n&&i){const n=Ch[e.charAt(r)];n&&(t[n.charCodeAt(0)]=!0)}}populate(e,t,r,n){const i=this.layers[0],s=i.layout,o="globe"===this.projection.name,a=s.get("text-font"),l=s.get("text-field"),u=s.get("icon-image"),c=("constant"!==l.value.kind||l.value.value instanceof Formatted&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,p=s.get("symbol-sort-key");if(this.features=[],!c&&!h)return;const d=t.iconDependencies,f=t.glyphDependencies,y=t.availableImages,m=new EvaluationParameters(this.zoom);for(const{feature:t,id:l,index:u,sourceLayerIndex:g}of e){const e=i._featureFilter.needGeometry,x=Jl(t,e);if(!i._featureFilter.filter(m,x,r))continue;if(e||(x.geometry=Wl(t,r,n)),o&&1!==t.type&&r.z<=5){const e=x.geometry,t=1<<r.z,n=r.x,i=r.y,s=.98078528056;for(let r=0;r<e.length;r++)e[r]=Zl(e[r],(e=>e),((e,r)=>Mu(Hp(ql((e.y/zl+i)/t),jl((e.x/zl+n)/t),1),Hp(ql((r.y/zl+i)/t),jl((r.x/zl+n)/t),1))<s))}let v,b;if(c){const e=i.getValueAndResolveTokens("text-field",x,r,y),t=Formatted.factory(e);bd(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ll()||this.hasRTLText&&cl.isParsed())&&(v=Th(t,i,x))}if(h){const e=i.getValueAndResolveTokens("icon-image",x,r,y);b=e instanceof ResolvedImage?e:ResolvedImage.fromString(e)}if(!v&&!b)continue;const w=this.sortFeaturesByKey?p.evaluate(x,{},r):void 0;if(this.features.push({id:l,text:v,icon:b,index:u,sourceLayerIndex:g,geometry:x.geometry,properties:t.properties,type:yd[t.type],sortKey:w}),b&&(d[b.name]=!0),v){const e=a.evaluate(x,{},r).join(","),t="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tp.vertical)>=0;for(const r of v.sections)if(r.image)d[r.image.name]=!0;else{const n=Ua(v.toString()),i=r.fontStack||e,s=f[i]=f[i]||{};this.calculateGlyphDependencies(r.text,s,t,this.allowVerticalPlacement,n)}}}"line"===s.get("symbol-placement")&&(this.features=function(e){const t={},r={},n=[];let i=0;function s(t){n.push(e[t]),i++}function o(e,t,i){const s=r[e];return delete r[e],r[t]=s,n[s].geometry[0].pop(),n[s].geometry[0]=n[s].geometry[0].concat(i[0]),s}function a(e,r,i){const s=t[r];return delete t[r],t[e]=s,n[s].geometry[0].shift(),n[s].geometry[0]=i[0].concat(n[s].geometry[0]),s}function l(e,t,r){const n=r?t[0][t[0].length-1]:t[0][0];return`${e}:${n.x}:${n.y}`}for(let u=0;u<e.length;u++){const c=e[u],h=c.geometry,p=c.text?c.text.toString():null;if(!p){s(u);continue}const d=l(p,h),f=l(p,h,!0);if(d in r&&f in t&&r[d]!==t[f]){const e=a(d,f,h),i=o(d,f,n[e].geometry);delete t[d],delete r[f],r[l(p,n[i].geometry,!0)]=i,n[e].geometry=null}else d in r?o(d,f,h):f in t?a(d,f,h):(s(u),t[d]=i-1,r[f]=i-1)}return n.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=fd(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length,n=e.segment;if(void 0!==n){let r=e.dist(t[n+1]),i=e.dist(t[n]);const s={};for(let e=n+1;e<t.length;e++)s[e]={x:t[e].x,y:t[e].y,tileUnitDistanceFromAnchor:r},e<t.length-1&&(r+=t[e+1].dist(t[e]));for(let e=n||0;e>=0;e--)s[e]={x:t[e].x,y:t[e].y,tileUnitDistanceFromAnchor:i},e>0&&(i+=t[e-1].dist(t[e]));for(let e=0;e<t.length;e++){const t=s[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,n,i,s,o,a,l,u,c,h,p,d){const f=e.indexArray,y=e.layoutVertexArray,m=e.globeExtVertexArray,g=e.segments.prepareSegment(4*t.length,y,f,this.canOverlap?s.sortKey:void 0),x=this.glyphOffsetArray.length,v=g.vertexLength,b=this.allowVerticalPlacement&&o===tp.vertical?Math.PI/2:0,w=s.text&&s.text.sections;for(let n=0;n<t.length;n++){const{tl:i,tr:o,bl:u,br:c,tex:h,pixelOffsetTL:x,pixelOffsetBR:v,minFontScaleX:_,minFontScaleY:S,glyphOffset:A,isSDF:k,sectionIndex:I}=t[n],P=g.vertexLength,T=A[1];if(gd(y,l.x,l.y,i.x,T+i.y,h.x,h.y,r,k,x.x,x.y,_,S),gd(y,l.x,l.y,o.x,T+o.y,h.x+h.w,h.y,r,k,v.x,x.y,_,S),gd(y,l.x,l.y,u.x,T+u.y,h.x,h.y+h.h,r,k,x.x,v.y,_,S),gd(y,l.x,l.y,c.x,T+c.y,h.x+h.w,h.y+h.h,r,k,v.x,v.y,_,S),a){const t=a.anchor,r=a.up;xd(m,t.x,t.y,t.z,r[0],r[1],r[2]),xd(m,t.x,t.y,t.z,r[0],r[1],r[2]),xd(m,t.x,t.y,t.z,r[0],r[1],r[2]),xd(m,t.x,t.y,t.z,r[0],r[1],r[2]),vd(e.dynamicLayoutVertexArray,t.x,t.y,t.z,b)}else vd(e.dynamicLayoutVertexArray,l.x,l.y,l.z,b);f.emplaceBack(P,P+1,P+2),f.emplaceBack(P+1,P+2,P+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(A[0]),n!==t.length-1&&I===t[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(y.length,s,s.index,{},p,d,w&&w[I])}const _=a?a.anchor:l;e.placedSymbolArray.emplaceBack(_.x,_.y,_.z,l.x,l.y,x,this.glyphOffsetArray.length-x,v,u,c,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],o,0,!1,0,h,0)}_commitLayoutVertex(e,t,r,n,i,s,o){e.emplaceBack(t,r,n,i,s,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(t,r,n,i,s,o,a){const l=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),u=l.vertexLength,c=a.tileAnchorX,h=a.tileAnchorY;for(let e=0;e<4;e++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-t.padding,-t.padding),n.collisionVertexArrayExt.emplaceBack(r,t.padding,-t.padding),n.collisionVertexArrayExt.emplaceBack(r,t.padding,t.padding),n.collisionVertexArrayExt.emplaceBack(r,-t.padding,t.padding),this._commitLayoutVertex(n.layoutVertexArray,i,s,o,c,h,new e(t.x1,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,s,o,c,h,new e(t.x2,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,s,o,c,h,new e(t.x2,t.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,s,o,c,h,new e(t.x1,t.y2)),l.vertexLength+=4;const p=n.indexArray;p.emplaceBack(u,u+1),p.emplaceBack(u+1,u+2),p.emplaceBack(u+2,u+3),p.emplaceBack(u+3,u),l.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,n,i,s){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceTextSize(e,s,t,o);this._addCollisionDebugVertices(n,i,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}_addIconDebugCollisionBoxes(e,t,r,n,i,s){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceIconSize(e,t,o);this._addCollisionDebugVertices(n,i,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new CollisionBuffers(StructArrayLayout3i2i2i16,_h.members,StructArrayLayout2ui4),this.iconCollisionBox=new CollisionBuffers(StructArrayLayout3i2i2i16,_h.members,StructArrayLayout2ui4);const r=Ph(this.iconSizeData,e),n=Ph(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(n,e,t,s.textBoxStartIndex,s.textBoxEndIndex,s),this._addTextDebugCollisionBoxes(n,e,t,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._addIconDebugCollisionBoxes(r,e,t,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._addIconDebugCollisionBoxes(r,e,t,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}}getSymbolInstanceTextSize(e,t,r,n){const i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),s=Ih(this.textSizeData,e,i)/Sh;return this.tilePixelRatio*s}getSymbolInstanceIconSize(e,t,r){const n=this.icon.placedSymbolArray.get(r),i=Ih(this.iconSizeData,e,n);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(e,t,r){e.emplaceBack(t,-r,-r),e.emplaceBack(t,r,-r),e.emplaceBack(t,r,r),e.emplaceBack(t,-r,r)}_updateTextDebugCollisionBoxes(e,t,r,n,i,s){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceTextSize(e,s,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,n.padding)}}_updateIconDebugCollisionBoxes(e,t,r,n,i){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceIconSize(e,t,s);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,n.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Ph(this.iconSizeData,e),n=Ph(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(n,e,t,s.textBoxStartIndex,s.textBoxEndIndex,s),this._updateTextDebugCollisionBoxes(n,e,t,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._updateIconDebugCollisionBoxes(r,e,t,s.iconBoxStartIndex,s.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(r,e,t,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,r,n,i,s,o,a,l){const u={};for(let n=t;n<r;n++){const t=e.get(n);u.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,projectedAnchorX:t.projectedAnchorX,projectedAnchorY:t.projectedAnchorY,projectedAnchorZ:t.projectedAnchorZ,tileAnchorX:t.tileAnchorX,tileAnchorY:t.tileAnchorY},u.textFeatureIndex=t.featureIndex;break}for(let t=n;t<i;t++){const r=e.get(t);u.verticalTextBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,padding:r.padding,projectedAnchorX:r.projectedAnchorX,projectedAnchorY:r.projectedAnchorY,projectedAnchorZ:r.projectedAnchorZ,tileAnchorX:r.tileAnchorX,tileAnchorY:r.tileAnchorY},u.verticalTextFeatureIndex=r.featureIndex;break}for(let t=s;t<o;t++){const r=e.get(t);u.iconBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,padding:r.padding,projectedAnchorX:r.projectedAnchorX,projectedAnchorY:r.projectedAnchorY,projectedAnchorZ:r.projectedAnchorZ,tileAnchorX:r.tileAnchorX,tileAnchorY:r.tileAnchorY},u.iconFeatureIndex=r.featureIndex;break}for(let t=a;t<l;t++){const r=e.get(t);u.verticalIconBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,padding:r.padding,projectedAnchorX:r.projectedAnchorX,projectedAnchorY:r.projectedAnchorY,projectedAnchorZ:r.projectedAnchorZ,tileAnchorX:r.tileAnchorX,tileAnchorY:r.tileAnchorY},u.verticalIconFeatureIndex=r.featureIndex;break}return u}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),n=r.vertexStartIndex+4*r.numGlyphs;for(let t=r.vertexStartIndex;t<n;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),n=[],i=[],s=[];for(let e=0;e<this.symbolInstances.length;++e){s.push(e);const o=this.symbolInstances.get(e);n.push(0|Math.round(t*o.tileAnchorX+r*o.tileAnchorY)),i.push(o.featureIndex)}return s.sort(((e,t)=>n[e]-n[t]||i[t]-i[e])),s}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,r)=>{e>=0&&r.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ko(SymbolBucket,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),SymbolBucket.MAX_GLYPHS=65535,SymbolBucket.addDynamicAttributes=vd;const wd=new Properties({"symbol-placement":new DataConstantProperty(Do.layout_symbol["symbol-placement"]),"symbol-spacing":new DataConstantProperty(Do.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new DataConstantProperty(Do.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new DataDrivenProperty(Do.layout_symbol["symbol-sort-key"]),"symbol-z-order":new DataConstantProperty(Do.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new DataConstantProperty(Do.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new DataConstantProperty(Do.layout_symbol["icon-ignore-placement"]),"icon-optional":new DataConstantProperty(Do.layout_symbol["icon-optional"]),"icon-rotation-alignment":new DataConstantProperty(Do.layout_symbol["icon-rotation-alignment"]),"icon-size":new DataDrivenProperty(Do.layout_symbol["icon-size"]),"icon-text-fit":new DataConstantProperty(Do.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new DataConstantProperty(Do.layout_symbol["icon-text-fit-padding"]),"icon-image":new DataDrivenProperty(Do.layout_symbol["icon-image"]),"icon-rotate":new DataDrivenProperty(Do.layout_symbol["icon-rotate"]),"icon-padding":new DataConstantProperty(Do.layout_symbol["icon-padding"]),"icon-keep-upright":new DataConstantProperty(Do.layout_symbol["icon-keep-upright"]),"icon-offset":new DataDrivenProperty(Do.layout_symbol["icon-offset"]),"icon-anchor":new DataDrivenProperty(Do.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new DataConstantProperty(Do.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new DataConstantProperty(Do.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new DataConstantProperty(Do.layout_symbol["text-rotation-alignment"]),"text-field":new DataDrivenProperty(Do.layout_symbol["text-field"]),"text-font":new DataDrivenProperty(Do.layout_symbol["text-font"]),"text-size":new DataDrivenProperty(Do.layout_symbol["text-size"]),"text-max-width":new DataDrivenProperty(Do.layout_symbol["text-max-width"]),"text-line-height":new DataDrivenProperty(Do.layout_symbol["text-line-height"]),"text-letter-spacing":new DataDrivenProperty(Do.layout_symbol["text-letter-spacing"]),"text-justify":new DataDrivenProperty(Do.layout_symbol["text-justify"]),"text-radial-offset":new DataDrivenProperty(Do.layout_symbol["text-radial-offset"]),"text-variable-anchor":new DataConstantProperty(Do.layout_symbol["text-variable-anchor"]),"text-anchor":new DataDrivenProperty(Do.layout_symbol["text-anchor"]),"text-max-angle":new DataConstantProperty(Do.layout_symbol["text-max-angle"]),"text-writing-mode":new DataConstantProperty(Do.layout_symbol["text-writing-mode"]),"text-rotate":new DataDrivenProperty(Do.layout_symbol["text-rotate"]),"text-padding":new DataConstantProperty(Do.layout_symbol["text-padding"]),"text-keep-upright":new DataConstantProperty(Do.layout_symbol["text-keep-upright"]),"text-transform":new DataDrivenProperty(Do.layout_symbol["text-transform"]),"text-offset":new DataDrivenProperty(Do.layout_symbol["text-offset"]),"text-allow-overlap":new DataConstantProperty(Do.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new DataConstantProperty(Do.layout_symbol["text-ignore-placement"]),"text-optional":new DataConstantProperty(Do.layout_symbol["text-optional"])});var _d={paint:new Properties({"icon-opacity":new DataDrivenProperty(Do.paint_symbol["icon-opacity"]),"icon-color":new DataDrivenProperty(Do.paint_symbol["icon-color"]),"icon-halo-color":new DataDrivenProperty(Do.paint_symbol["icon-halo-color"]),"icon-halo-width":new DataDrivenProperty(Do.paint_symbol["icon-halo-width"]),"icon-halo-blur":new DataDrivenProperty(Do.paint_symbol["icon-halo-blur"]),"icon-translate":new DataConstantProperty(Do.paint_symbol["icon-translate"]),"icon-translate-anchor":new DataConstantProperty(Do.paint_symbol["icon-translate-anchor"]),"text-opacity":new DataDrivenProperty(Do.paint_symbol["text-opacity"]),"text-color":new DataDrivenProperty(Do.paint_symbol["text-color"],{runtimeType:q,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new DataDrivenProperty(Do.paint_symbol["text-halo-color"]),"text-halo-width":new DataDrivenProperty(Do.paint_symbol["text-halo-width"]),"text-halo-blur":new DataDrivenProperty(Do.paint_symbol["text-halo-blur"]),"text-translate":new DataConstantProperty(Do.paint_symbol["text-translate"]),"text-translate-anchor":new DataConstantProperty(Do.paint_symbol["text-translate-anchor"])}),layout:wd};class FormatSectionOverride{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:F,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ko(FormatSectionOverride,"FormatSectionOverride",{omit:["defaultValue"]});class SymbolStyleLayer extends StyleLayer{constructor(e){super(e,_d)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,n){const i=this.layout.get(e).evaluate(t,{},r,n),s=this._unevaluatedLayout._values[e];return s.isDataDriven()||Nt(s.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,((t,r)=>r in e?String(e[r]):""))}(t.properties,i)}createBucket(e){return new SymbolBucket(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of _d.paint.overridableProperties){if(!SymbolStyleLayer.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new FormatSectionOverride(t),n=new StyleExpression(r,t.property.specification);let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new ZoomConstantExpression("source",n):new ZoomDependentExpression("composite",n,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new PossiblyEvaluatedPropertyValue(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&SymbolStyleLayer.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),n=_d.paint.properties[t];let i=!1;const s=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof Formatted)s(r.value.value.sections);else if("source"===r.value.kind){const e=t=>{i||(t instanceof ne&&te(t.value)===K?s(t.value.sections):t instanceof FormatExpression?s(t.sections):t.eachChild(e))},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return i}getProgramConfiguration(e){return new ProgramConfiguration(this,e)}}var Sd={paint:new Properties({"background-color":new DataConstantProperty(Do.paint_background["background-color"]),"background-pattern":new CrossFadedProperty(Do.paint_background["background-pattern"]),"background-opacity":new DataConstantProperty(Do.paint_background["background-opacity"])})},Ad={paint:new Properties({"raster-opacity":new DataConstantProperty(Do.paint_raster["raster-opacity"]),"raster-hue-rotate":new DataConstantProperty(Do.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new DataConstantProperty(Do.paint_raster["raster-brightness-min"]),"raster-brightness-max":new DataConstantProperty(Do.paint_raster["raster-brightness-max"]),"raster-saturation":new DataConstantProperty(Do.paint_raster["raster-saturation"]),"raster-contrast":new DataConstantProperty(Do.paint_raster["raster-contrast"]),"raster-resampling":new DataConstantProperty(Do.paint_raster["raster-resampling"]),"raster-fade-duration":new DataConstantProperty(Do.paint_raster["raster-fade-duration"])})};class CustomStyleLayer extends StyleLayer{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var kd={paint:new Properties({"sky-type":new DataConstantProperty(Do.paint_sky["sky-type"]),"sky-atmosphere-sun":new DataConstantProperty(Do.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new DataConstantProperty(Do.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new DataConstantProperty(Do.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new DataConstantProperty(Do.paint_sky["sky-gradient-radius"]),"sky-gradient":new ColorRampProperty(Do.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new DataConstantProperty(Do.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new DataConstantProperty(Do.paint_sky["sky-atmosphere-color"]),"sky-opacity":new DataConstantProperty(Do.paint_sky["sky-opacity"])})};function Id(e,t,r){const n=[0,0,1],i=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}([]);return function(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);e[0]=n*l-s*a,e[1]=i*l+o*a,e[2]=s*l+n*a,e[3]=o*l-i*a}(i,i,r?-s(e)+Math.PI:s(e)),function(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);e[0]=n*l+o*a,e[1]=i*l+s*a,e[2]=s*l-i*a,e[3]=o*l-n*a}(i,i,-s(t)),function(e,t,r){var n=r[0],i=r[1],s=r[2],o=t[0],a=t[1],l=t[2],u=i*l-s*a,c=s*o-n*l,h=n*a-i*o,p=i*h-s*c,d=s*u-n*h,f=n*c-i*u,y=2*r[3];c*=y,h*=y,d*=2,f*=2,e[0]=o+(u*=y)+(p*=2),e[1]=a+c+d,e[2]=l+h+f}(n,n,i),Eu(n,n)}const Pd={circle:class CircleStyleLayer extends StyleLayer{constructor(e){super(e,mu)}createBucket(e){return new CircleBucket(e)}queryRadius(e){const t=e;return hu("circle-radius",this,t)+hu("circle-stroke-width",this,t)+pu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,n,i,s,o,a){const l=fu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Fu(e,n,s,o,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,u)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new ProgramConfiguration(this,e)}},heatmap:class HeatmapStyleLayer extends StyleLayer{createBucket(e){return new HeatmapBucket(e)}constructor(e){super(e,Ku),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return hu("heatmap-radius",this,e)}queryIntersectsFeature(t,r,n,i,s,o,a,l){const u=this.paint.get("heatmap-radius").evaluate(r,n);return Fu(t,i,o,a,l,!0,!0,new e(0,0),u)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new ProgramConfiguration(this,e)}},hillshade:class HillshadeStyleLayer extends StyleLayer{constructor(e){super(e,Gu)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class FillStyleLayer extends StyleLayer{constructor(e){super(e,zc)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(e){return new ProgramConfiguration(this,e)}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new FillBucket(e)}queryRadius(){return pu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,n,i,s){return!e.queryGeometry.isAboveHorizon&&ru(du(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class FillExtrusionStyleLayer extends StyleLayer{constructor(e){super(e,eh)}createBucket(e){return new FillExtrusionBucket(e)}queryRadius(){return pu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new ProgramConfiguration(this,e)}queryIntersectsFeature(t,r,n,i,s,o,a,l,u){const c=fu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(r,n),p=this.paint.get("fill-extrusion-base").evaluate(r,n),d=[0,0],f=l&&o.elevation,y=o.elevation?o.elevation.exaggeration():1,m=t.tile.getBucket(this);if(f&&m instanceof FillExtrusionBucket){const e=m.centroidVertexArray,t=u+1;if(t<e.length){const r=e.get(t);d[0]=r.a_centroid_pos0,d[1]=r.a_centroid_pos1}}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(i=Qc([i],[new e(0,0),new e(zl,zl)],t.tileID.canonical).map((e=>e.polygon)).flat());const g=function(t,r,n,i,s,o,a,l,u,c,h){return"globe"===t.projection.name?function(e,t,r,n,i,s,o,a,l,u,c){const h=[],p=[],d=e.projection.upVectorScale(c,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],y=[0,0,0,1],m=(e,t,r,n)=>{e[0]=t,e[1]=r,e[2]=n,e[3]=1},g=function(){const e=Math.PI/32,t=Math.tan(e),r=Bl;return r*Math.sqrt(1+2*t*t)-r}();r>0&&(r+=g),n+=g;for(const g of t){const t=[],x=[];for(const h of g){const p=h.x+i.x,g=h.y+i.y,v=e.projection.projectTilePoint(p,g,c),b=e.projection.upVector(c,h.x,h.y);let w=r,_=n;if(o){const e=oh(p,g,r,n,o,a,l,u);w+=e.base,_+=e.top}0!==r?m(f,v.x+b[0]*d*w,v.y+b[1]*d*w,v.z+b[2]*d*w):m(f,v.x,v.y,v.z),m(y,v.x+b[0]*d*_,v.y+b[1]*d*_,v.z+b[2]*d*_),Du(f,f,s),Du(y,y,s),t.push(sh(f)),x.push(sh(y))}h.push(t),p.push(x)}return[h,p]}(t,r,n,i,s,o,a,l,u,c,h):a?function(e,t,r,n,i,s,o,a,l){const u=[],c=[],h=[0,0,0,1];for(const p of e){const e=[],d=[];for(const u of p){const c=u.x+n.x,p=u.y+n.y,f=oh(c,p,t,r,s,o,a,l);h[0]=c,h[1]=p,h[2]=f.base,h[3]=1,Vu(h,h,i),h[3]=Math.max(h[3],1e-5);const y=sh([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=c,h[1]=p,h[2]=f.top,h[3]=1,Vu(h,h,i),h[3]=Math.max(h[3],1e-5);const m=sh([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);e.push(y),d.push(m)}u.push(e),c.push(d)}return[u,c]}(r,n,i,s,o,a,l,u,c):function(t,r,n,i,s){const o=[],a=[],l=s[8]*r,u=s[9]*r,c=s[10]*r,h=s[11]*r,p=s[8]*n,d=s[9]*n,f=s[10]*n,y=s[11]*n;for(const r of t){const t=[],n=[];for(const o of r){const r=o.x+i.x,a=o.y+i.y,m=s[0]*r+s[4]*a+s[12],g=s[1]*r+s[5]*a+s[13],x=s[2]*r+s[6]*a+s[14],v=s[3]*r+s[7]*a+s[15],b=m+l,w=g+u,_=x+c,S=Math.max(v+h,1e-5),A=m+p,k=g+d,I=x+f,P=Math.max(v+y,1e-5),T=new e(b/S,w/S);T.z=_/S,t.push(T);const C=new e(A/P,k/P);C.z=I/P,n.push(C)}o.push(t),a.push(n)}return[o,a]}(r,n,i,s,o)}(o,i,p,h,c,a,f?l:null,d,y,o.center.lat,t.tileID.canonical),x=t.queryGeometry;return function(e,t,r){let n=1/0;ru(r,t)&&(n=ih(r,t[0]));for(let i=0;i<t.length;i++){const s=t[i],o=e[i];for(let e=0;e<s.length-1;e++){const t=s[e],i=[t,s[e+1],o[e+1],o[e],t];eu(r,i)&&(n=Math.min(n,ih(r,i)))}}return n!==1/0&&n}(g[0],g[1],x.isPointQuery()?x.screenBounds:x.screenGeometry)}},line:class LineStyleLayer extends StyleLayer{constructor(e){super(e,fh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Le,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=yh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new LineBucket(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new ProgramConfiguration(this,e)}queryRadius(e){const t=e,r=mh(hu("line-width",this,t),hu("line-gap-width",this,t)),n=hu("line-offset",this,t);return r/2+Math.abs(n)+pu(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,n,i,s,o){if(t.queryGeometry.isAboveHorizon)return!1;const a=du(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),l=t.pixelToTileUnitsFactor/2*mh(this.paint.get("line-width").evaluate(r,n),this.paint.get("line-gap-width").evaluate(r,n)),u=this.paint.get("line-offset").evaluate(r,n);return u&&(i=function(t,r){const n=[],i=new e(0,0);for(let e=0;e<t.length;e++){const s=t[e],o=[];for(let e=0;e<s.length;e++){const t=s[e-1],n=s[e],a=s[e+1],l=0===e?i:n.sub(t)._unit()._perp(),u=e===s.length-1?i:a.sub(n)._unit()._perp(),c=l._add(u)._unit();c._mult(1/(c.x*u.x+c.y*u.y)),o.push(c._mult(r)._add(n))}n.push(o)}return n}(i,u*t.pixelToTileUnitsFactor)),function(e,t,r){for(let n=0;n<t.length;n++){const i=t[n];if(e.length>=3)for(let t=0;t<i.length;t++)if(uu(e,i[t]))return!0;if(nu(e,i,r))return!0}return!1}(a,i,l)}isTileClipped(){return!0}},symbol:SymbolStyleLayer,background:class BackgroundStyleLayer extends StyleLayer{constructor(e){super(e,Sd)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class RasterStyleLayer extends StyleLayer{constructor(e){super(e,Ad)}getProgramIds(){return["raster"]}},sky:class SkyLayer extends StyleLayer{constructor(e){super(e,kd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Zu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),n=!r,i=e.style.light,s=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&b("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Id(s.azimuthal,90-s.polar,t):Id(r[0],90-r[1],t)}const r=this.paint.get("sky-gradient-center");return Id(r[0],90-r[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};var Td=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Cd(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const r of e)t+=`${Cd(r)},`;return`${t}]`}let t="{";for(const r of Object.keys(e).sort())t+=`${r}:${Cd(e[r])},`;return`${t}}`}function Ed(e){let t="";for(const r of Td)t+=`/${Cd(e[r])}`;return t}class StyleLayerIndex{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(e,t){for(const t of e)this._layerConfigs[t.id]=t,(this._layers[t.id]=(r=t,"custom"===r.type?new CustomStyleLayer(r):new Pd[r.type](r))).compileFilter(),this.keyCache[t.id]&&delete this.keyCache[t.id];var r;for(const e of t)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const n=function(e,t){const r={};for(let n=0;n<e.length;n++){const i=t&&t[e[n].id]||Ed(e[n]);t&&(t[e[n].id]=i);let s=r[i];s||(s=r[i]=[]),s.push(e[n])}const n=[];for(const e in r)n.push(r[e]);return n}(c(this._layerConfigs),this.keyCache);for(const e of n){const t=e.map((e=>this._layers[e.id])),r=t[0];if("none"===r.visibility)continue;const n=r.source||"";let i=this.familiesBySource[n];i||(i=this.familiesBySource[n]={});const s=r.sourceLayer||"_geojsonTileLayer";let o=i[s];o||(o=i[s]=[]),o.push(t)}}}class DictionaryCoder{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Md=["tile","layer","source","sourceLayer","state"];class Feature{constructor(e,t,r,n,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=n,this.properties=e.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Md)void 0!==this[t]&&(e[t]=this[t]);return e}}class Texture{constructor(e,t,r,n){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,n)}update(e,t,n){const{width:i,height:s}=e,{context:o}=this,{gl:a}=o,{HTMLImageElement:l,HTMLCanvasElement:u,HTMLVideoElement:c,ImageData:h,ImageBitmap:p}=r;if(a.bindTexture(a.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!t||!1!==t.premultiply)),n||this.size&&this.size[0]===i&&this.size[1]===s){const{x:t,y:r}=n||{x:0,y:0};e instanceof l||e instanceof u||e instanceof c||e instanceof h||p&&e instanceof p?a.texSubImage2D(a.TEXTURE_2D,0,t,r,a.RGBA,a.UNSIGNED_BYTE,e):a.texSubImage2D(a.TEXTURE_2D,0,t,r,i,s,a.RGBA,a.UNSIGNED_BYTE,e.data)}else this.size=[i,s],e instanceof l||e instanceof u||e instanceof c||e instanceof h||p&&e instanceof p?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,e):a.texImage2D(a.TEXTURE_2D,0,this.format,i,s,0,this.format,a.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}const Dd=32,zd=33,Bd=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,r=0,n=0,i=0,s=0,o=0,a=0;for(1&t?i=s=o=Dd:r=n=a=Dd;(t>>=1)>1;){const e=r+i>>1,l=n+s>>1;1&t?(i=r,s=n,r=o,n=a):(r=i,n=s,i=o,s=a),o=e,a=l}const l=4*e;Bd[l+0]=r,Bd[l+1]=n,Bd[l+2]=i,Bd[l+3]=s}const Vd=new Uint16Array(2178),Ld=new Uint8Array(1089),Fd=new Uint16Array(1089);function Rd(e){return 0===e?-.03125:32===e?.03125:0}var Od=dl([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const jd={type:2,extent:zl,loadGeometry:()=>[[new e(0,0),new e(8193,0),new e(8193,8193),new e(0,8193),new e(0,0)]]};class Tile{constructor(e,t,r,n,i){this.tileID=e,this.uid=p++,this.uses=0,this.tileSize=t,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=i,this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<tl.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=nd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const r={};if(!t)return r;for(const n of e){const e=n.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)r[t.id]=n}}return r}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof SymbolBucket){if(this.hasSymbolBuckets=!0,!r)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof SymbolBucket&&t.hasRTLText){this.hasRTLText=!0,cl.isLoading()||cl.isLoaded()||"deferred"!==ll()||ul();break}}this.queryPadding=0;for(const e in this.buckets){const r=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(r))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new CollisionBoxArray}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const r=this.buckets[t];r.uploadPending()&&r.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Texture(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Texture(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Texture(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,r,n,i,s,o,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:o,transform:s,params:i,tileTransform:this.tileTransform},e,t,r):{}}querySourceFeatures(e,t){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),i=t?t.sourceLayer:"",s=n._geojsonTileLayer||n[i];if(!s)return;const o=Ko(t&&t.filter),{z:a,x:l,y:u}=this.tileID.canonical,c={z:a,x:l,y:u};for(let t=0;t<s.length;t++){const n=s.feature(t);if(o.needGeometry){const e=Jl(n,!0);if(!o.filter(new EvaluationParameters(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!o.filter(new EvaluationParameters(this.tileID.overscaledZ),n))continue;const h=r.getId(n,i),p=new Feature(n,a,l,u,h);p.tile=c,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=A(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let r=!1;if(this.expirationTime>e)r=!1;else if(t)if(this.expirationTime<t)r=!0;else{const n=this.expirationTime-t;n?this.expirationTime=e+Math.max(n,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const r=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages();for(const i in this.buckets){if(!t.style.hasLayer(i))continue;const s=this.buckets[i],o=s.layers[0].sourceLayer||"_geojsonTileLayer",a=r[o],l=e[o];if(!a||!l||0===Object.keys(l).length)continue;if(s.update(l,a,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),s instanceof LineBucket||s instanceof FillBucket){const e=t.style._getSourceCache(s.layers[0].source);t._terrain&&t._terrain.enabled&&e&&s.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const u=t&&t.style&&t.style.getLayer(i);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<tl.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=tl.now()+e}setTexture(e,t){const r=t.context,n=r.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Texture(r,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,t){const r={};for(const e of t)r[e]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const r of t)if(e[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const r=Wl(jd,this.tileID.canonical,this.tileTransform)[0],n=new StructArrayLayout2i4,i=new StructArrayLayout1ui2;for(let e=0;e<r.length;e++){const{x:t,y:s}=r[e];n.emplaceBack(t,s),i.emplaceBack(e)}i.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(i),this._tileDebugBuffer=e.createVertexBuffer(n,Np.members),this._tileDebugSegments=SegmentVector.simpleSegment(0,0,n.length,i.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const r=Wl(jd,this.tileID.canonical,this.tileTransform)[0];let n,i;if(this.isRaster){const e=function(e,t){const r=nd(e,t),n=Math.pow(2,e.z);for(let i=0;i<zd;i++)for(let s=0;s<zd;s++){const o=jl((e.x+(s+Rd(s))/Dd)/n),a=ql((e.y+(i+Rd(i))/Dd)/n),l=t.project(o,a),u=i*zd+s;Vd[2*u+0]=Math.round((l.x*r.scale-r.x)*zl),Vd[2*u+1]=Math.round((l.y*r.scale-r.y)*zl)}Ld.fill(0),Fd.fill(0);for(let e=2045;e>=0;e--){const t=4*e,r=Bd[t+0],n=Bd[t+1],i=Bd[t+2],s=Bd[t+3],o=r+i>>1,a=n+s>>1,l=o+a-n,u=a+r-o,c=n*zd+r,h=s*zd+i,p=a*zd+o,d=Math.hypot((Vd[2*c+0]+Vd[2*h+0])/2-Vd[2*p+0],(Vd[2*c+1]+Vd[2*h+1])/2-Vd[2*p+1])>=16;if(Ld[p]=Ld[p]||(d?1:0),e<1022){const e=(n+u>>1)*zd+(r+l>>1),t=(s+u>>1)*zd+(i+l>>1);Ld[p]=Ld[p]||Ld[e]||Ld[t]}}const i=new StructArrayLayout4i8,s=new StructArrayLayout3ui6;let o=0;function a(e,t){const r=t*zd+e;return 0===Fd[r]&&(i.emplaceBack(Vd[2*r+0],Vd[2*r+1],e*zl/Dd,t*zl/Dd),Fd[r]=++o),Fd[r]-1}function l(e,t,r,n,i,o){const u=e+r>>1,c=t+n>>1;if(Math.abs(e-i)+Math.abs(t-o)>1&&Ld[c*zd+u])l(i,o,e,t,u,c),l(r,n,i,o,u,c);else{const l=a(e,t),u=a(r,n),c=a(i,o);s.emplaceBack(l,u,c)}}return l(0,0,Dd,Dd,Dd,0),l(Dd,Dd,0,0,0,Dd),{vertices:i,indices:s}}(this.tileID.canonical,t);n=e.vertices,i=e.indices}else{n=new StructArrayLayout4i8,i=new StructArrayLayout3ui6;for(const{x:e,y:t}of r)n.emplaceBack(e,t,0,0);const e=Wu(n.int16,void 0,4);for(let t=0;t<e.length;t+=3)i.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,Od.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(i),this._tileBoundsSegments=SegmentVector.simpleSegment(0,0,n.length,i.length)}_makeGlobeTileDebugBuffers(e,t){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!t||"globe"!==t.name)return;const r=this.tileID.canonical,n=td(Jp(r));this._makeGlobeTileDebugBorderBuffer(e,r,n),this._makeGlobeTileDebugTextBuffer(e,r,n)}_makeGlobeTileDebugBorderBuffer(e,t,r){const n=new StructArrayLayout2i4,i=new StructArrayLayout1ui2,s=new StructArrayLayout3i6,o=(e,o,a,l,u)=>{const c=(a-e)/(u-1),h=(l-o)/(u-1),p=n.length;for(let a=0;a<u;a++){const l=e+a*c,u=o+a*h;n.emplaceBack(l,u);const d=Qp(l,u,t),f=Du(d,d,r);s.emplaceBack(f[0],f[1],f[2]),i.emplaceBack(p+a)}},a=zl;o(0,0,a,0,16),o(a,0,a,a,16),o(a,a,0,a,16),o(0,a,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(i),this._tileDebugBuffer=e.createVertexBuffer(n,Np.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(s,Up.members),this._tileDebugSegments=SegmentVector.simpleSegment(0,0,n.length,i.length)}_makeGlobeTileDebugTextBuffer(e,t,r){const n=new StructArrayLayout2i4,i=new StructArrayLayout3ui6,s=new StructArrayLayout3i6,o=25;i.reserve(32),n.reserve(o),s.reserve(o);const a=(e,t)=>o*e+t;for(let e=0;e<o;e++){const i=2048*e;for(let e=0;e<o;e++){const o=2048*e;n.emplaceBack(o,i);const a=Qp(o,i,t),l=Du(a,a,r);s.emplaceBack(l[0],l[1],l[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=a(e,t),n=a(e,t+1),s=a(e+1,t),o=a(e+1,t+1);i.emplaceBack(r,n,s),i.emplaceBack(s,n,o)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(i),this._tileDebugTextBuffer=e.createVertexBuffer(n,Np.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(s,Up.members),this._tileDebugTextSegments=SegmentVector.simpleSegment(0,0,o,32)}}class SourceFeatureState{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,r){const n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},h(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,r){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,t){const r=String(t),n=h({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const r=this.deletedStates[e][t];if(null===r)return{};for(const e in r)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),h(this.state[e][r],this.stateChanges[e][r]),t[r]=this.state[e][r];r[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const r in this.state[e])t[r]={},this.state[e][r]={};else for(const r in this.deletedStates[e]){if(null===this.deletedStates[e][r])this.state[e][r]={};else for(const t of Object.keys(this.deletedStates[e][r]))delete this.state[e][r][t];t[r]=this.state[e][r]}r[e]=r[e]||{},h(r[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const n in e)e[n].setFeatureState(r,t)}}class MipLevel{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function qd(e,t,r,n){let i=0,s=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(r[o]<e[o]||r[o]>t[o])return null}else{const a=1/n[o];let l=(e[o]-r[o])*a,u=(t[o]-r[o])*a;if(l>u){const e=l;l=u,u=e}if(l>i&&(i=l),u<s&&(s=u),i>s)return null}return i}function $d(e,t,r,n,i,s,o,a,l,u,c){const h=n-e,p=i-t,d=s-r,f=o-e,y=a-t,m=l-r,g=c[1]*m-c[2]*y,x=c[2]*f-c[0]*m,v=c[0]*y-c[1]*f,b=h*g+p*x+d*v;if(Math.abs(b)<1e-15)return null;const w=1/b,_=u[0]-e,S=u[1]-t,A=u[2]-r,k=(_*g+S*x+A*v)*w;if(k<0||k>1)return null;const I=S*d-A*p,P=A*h-_*d,T=_*p-S*h,C=(c[0]*I+c[1]*P+c[2]*T)*w;return C<0||k+C>1?null:(f*I+y*P+m*T)*w}function Ud(e,t,r){return(e-t)/(r-t)}function Nd(e,t,r,n,i,s,o,a,l){const u=1<<r,c=s-n,h=o-i,p=(e+1)/u*c+n,d=(t+0)/u*h+i,f=(t+1)/u*h+i;a[0]=(e+0)/u*c+n,a[1]=d,l[0]=p,l[1]=f}class DemMinMaxQuadTree{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),r=[];let n=Math.ceil(Math.pow(2,t));const i=1/n,s=(e,t,r,n,i)=>{const s=n?1:0,o=(e+1)*r-s,a=t*r,l=(t+1)*r-s;i[0]=e*r,i[1]=a,i[2]=o,i[3]=l};let o=new MipLevel(n);const a=[];for(let t=0;t<n*n;t++){s(t%n,Math.floor(t/n),i,!1,a);const r=Zd(a[0],a[1],e),l=Zd(a[2],a[1],e),u=Zd(a[2],a[3],e),c=Zd(a[0],a[3],e);o.minimums.push(Math.min(r,l,u,c)),o.maximums.push(Math.max(r,l,u,c)),o.leaves.push(1)}for(r.push(o),n/=2;n>=1;n/=2){const e=r[r.length-1];o=new MipLevel(n);for(let t=0;t<n*n;t++){s(t%n,Math.floor(t/n),2,!0,a);const r=e.getElevation(a[0],a[1]),i=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),u=e.getElevation(a[0],a[3]),c=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),p=e.isLeaf(a[2],a[3]),d=e.isLeaf(a[0],a[3]),f=Math.min(r.min,i.min,l.min,u.min),y=Math.max(r.max,i.max,l.max,u.max),m=c&&h&&p&&d;o.maximums.push(y),o.minimums.push(f),o.leaves.push(y-f<=5&&m?1:0)}r.push(o)}return r}(this.dem),r=t.length-1,n=t[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,r,0)}raycastRoot(e,t,r,n,i,s,o=1){return qd([e,t,-100],[r,n,this.maximums[0]*o],i,s)}raycast(e,t,r,n,i,s,o=1){if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,r,n,i,s,o);if(null==a)return null;const l=[],u=[],c=[],h=[],p=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:a,t:d,nodex:f,nodey:y,depth:m}=p.pop();if(this.leaves[a]){Nd(f,y,m,e,t,r,n,c,h);const a=1<<m,l=(f+0)/a,u=(f+1)/a,p=(y+0)/a,g=(y+1)/a,x=Zd(l,p,this.dem)*o,v=Zd(u,p,this.dem)*o,b=Zd(u,g,this.dem)*o,w=Zd(l,g,this.dem)*o,_=$d(c[0],c[1],x,h[0],c[1],v,h[0],h[1],b,i,s),S=$d(h[0],h[1],b,c[0],h[1],w,c[0],c[1],x,i,s),A=Math.min(null!==_?_:Number.MAX_VALUE,null!==S?S:Number.MAX_VALUE);if(A!==Number.MAX_VALUE)return A;{const e=Cu([],i,s,d);if(Kd(x,v,w,b,Ud(e[0],c[0],h[0]),Ud(e[1],c[1],h[1]))>=e[2])return d}continue}let g=0;for(let p=0;p<this._siblingOffset.length;p++){Nd((f<<1)+this._siblingOffset[p][0],(y<<1)+this._siblingOffset[p][1],m+1,e,t,r,n,c,h),c[2]=-100,h[2]=this.maximums[this.childOffsets[a]+p]*o;const d=qd(c,h,i,s);if(null!=d){const e=d;l[p]=e;let t=!1;for(let r=0;r<g&&!t;r++)e>=l[u[r]]&&(u.splice(r,0,p),t=!0);t||(u[g]=p),g++}}for(let e=0;e<g;e++){const t=u[e];p.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(y<<1)+this._siblingOffset[t][1],depth:m+1})}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,r,n,i){if(1===e[n].isLeaf(t,r))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const s=n-1,o=e[s];let a=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const n=2*t+this._siblingOffset[e][0],i=2*r+this._siblingOffset[e][1],s=o.getElevation(n,i),u=o.isLeaf(n,i),c=this._addNode(s.min,s.max,u);u&&(a|=1<<e),l||(l=c)}for(let n=0;n<this._siblingOffset.length;n++)a&1<<n||this._construct(e,2*t+this._siblingOffset[n][0],2*r+this._siblingOffset[n][1],s,l+n)}}function Kd(e,t,r,n,i,s){return Oe(Oe(e,r,s),Oe(t,n,s),i)}function Zd(e,t,r){const n=r.dim,i=a(e*n-.5,0,n-1),s=a(t*n-.5,0,n-1),o=Math.floor(i),l=Math.floor(s),u=Math.min(o+1,n-1),c=Math.min(l+1,n-1);return Kd(r.get(o,l),r.get(u,l),r.get(o,c),r.get(u,c),i-o,s-l)}const Gd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class DEMData{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r,n=!1,i=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return b(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const s=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=r||"mapbox",this.borderReady=n,!n){for(let e=0;e<s;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(s,e)]=o[this._idx(s-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,s)]=o[this._idx(e,s-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(s,-1)]=o[this._idx(s-1,0)],o[this._idx(-1,s)]=o[this._idx(0,s-1)],o[this._idx(s,s)]=o[this._idx(s-1,s-1)],i&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new DemMinMaxQuadTree(this)}get(e,t,r=!1){r&&(e=a(e,-1,this.dim),t=a(t,-1,this.dim));const n=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}static getUnpackVector(e){return Gd[e]}get unpackVector(){return Gd[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,r){return(256*e*256+256*t+r)/10-1e4}_unpackTerrarium(e,t,r){return 256*e+t+r/256-32768}static pack(e,t){const r=[0,0,0,0],n=DEMData.getUnpackVector(t);let i=Math.floor((e+n[3])/n[2]);return r[2]=i%256,i=Math.floor(i/256),r[1]=i%256,i=Math.floor(i/256),r[0]=i,r}getPixels(){return new RGBAImage({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,i=t*this.dim+this.dim,s=r*this.dim,o=r*this.dim+this.dim;switch(t){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:s=o-1;break;case 1:o=s+1}const a=-t*this.dim,l=-r*this.dim;for(let t=s;t<o;t++)for(let r=n;r<i;r++){const n=4*this._idx(r,t),i=4*this._idx(r+a,t+l);this.pixels[n+0]=e.pixels[i+0],this.pixels[n+1]=e.pixels[i+1],this.pixels[n+2]=e.pixels[i+2],this.pixels[n+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ko(DEMData,"DEMData"),ko(DemMinMaxQuadTree,"DemMinMaxQuadTree",{omit:["dem"]});class TileCache{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const i={value:t,timeout:void 0};if(void 0!==r&&(i.timeout=setTimeout((()=>{this.remove(e,i)}),r)),this.data[n].push(i),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const r=e.wrapped().key,n=void 0===t?0:this.data[r].indexOf(t),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const r in this.data)for(const n of this.data[r])e(n.value)||t.push(n);for(const e of t)this.remove(e.value.tileID,e)}}class ColorMode{constructor(e,t,r){this.blendFunction=e,this.blendColor=t,this.mask=r}}ColorMode.Replace=[1,0],ColorMode.disabled=new ColorMode(ColorMode.Replace,z.transparent,[!1,!1,!1,!1]),ColorMode.unblended=new ColorMode(ColorMode.Replace,z.transparent,[!0,!0,!0,!0]),ColorMode.alphaBlended=new ColorMode([1,771],z.transparent,[!0,!0,!0,!0]);class SourceCache extends Evented{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new TileCache(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new SourceFeatureState,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_loadTileForOffline(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTileForOffline(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const r=this._tiles[t];this._source.prepareTile(r)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,r.tileID),r.upload(e),r.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return c(this._tiles).map((e=>e.tileID)).sort(Xd).map((e=>e.key))}getRenderableIds(t){const r=[];for(const e in this._tiles)this._isIdRenderable(+e,t)&&r.push(this._tiles[e]);return t?r.sort(((t,r)=>{const n=t.tileID,i=r.tileID,s=new e(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),o=new e(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||o.y-s.y||o.x-s.x})).map((e=>e.tileID.key)):r.map((e=>e.tileID)).sort(Xd).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(e,t,r,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new ErrorEvent(n,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=tl.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Event("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const i=t[n];if(e.neighboringTiles&&e.neighboringTiles[i]){const t=this.getTileByID(i);r(e,t),r(t,e)}}function r(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),s=t.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,n),e.neighboringTiles&&e.neighboringTiles[s]&&(e.neighboringTiles[s].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,n){for(const i in this._tiles){let s=this._tiles[i];if(n[i]||!s.hasData()||s.tileID.overscaledZ<=t||s.tileID.overscaledZ>r)continue;let o=s.tileID;for(;s&&s.tileID.overscaledZ>t+1;){const e=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[e.key],s&&s.hasData()&&(o=e)}let a=o;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){n[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){const t=e.scaledTo(r),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const r=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,i=Math.floor(r*n*5),s="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){const n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;let n;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(n=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter((e=>this._source.hasTile(e))))):n=[];const i=this._updateRetainedTiles(n);if(Yd(this._source.type)&&0!==n.length){const e={},t={},r=Object.keys(i);for(const n of r){const r=i[n],s=this._tiles[n];if(!s||s.fadeEndTime&&s.fadeEndTime<=tl.now())continue;const o=this.findLoadedParent(r,Math.max(r.overscaledZ-SourceCache.maxOverzooming,this._source.minzoom));o&&(this._addTile(o.tileID),e[o.tileID.key]=o.tileID),t[n]=r}const s=n[n.length-1].overscaledZ;for(const e in this._tiles){const r=this._tiles[e];if(i[e]||!r.hasData())continue;let n=r.tileID;for(;n.overscaledZ>s;){n=n.scaledTo(n.overscaledZ-1);const s=this._tiles[n.key];if(s&&s.hasData()&&t[n.key]){i[e]=r.tileID;break}}}for(const t in e)i[t]||(this._coveredTiles[t]=!0,i[t]=e[t])}for(const e in i)this._tiles[e].clearFadeHold();const s=function(e,t){const r=[];for(const n in e)n in t||r.push(n);return r}(this._tiles,i);for(const e of s){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const r={},n=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),i=e[0].overscaledZ,s=Math.max(i-SourceCache.maxOverzooming,this._source.minzoom),o=Math.max(i+SourceCache.maxUnderzooming,this._source.minzoom),a={};for(const r of e){const e=this._addTile(r);t[r.key]=r,e.hasData()||n<this._source.maxzoom&&(a[r.key]=r)}this._retainLoadedChildren(a,n,o,t);for(const n of e){let e=this._tiles[n.key];if(e.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const e=n.children(this._source.maxzoom)[0],r=this.getTile(e);if(r&&r.hasData()){t[e.key]=e;continue}}else{const e=n.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let o=n.overscaledZ-1;o>=s;--o){const s=n.scaledTo(o);if(r[s.key])break;if(r[s.key]=!0,e=this.getTile(s),!e&&i&&(e=this._addTile(s)),e&&(t[s.key]=s,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let r,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(e),r)break;n=e}for(const e of t)this._loadedParentTiles[e]=r}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const r=Boolean(t);if(!r){const r=this.map?this.map.painter:null;t=new Tile(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,r,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,r||this._source.fire(new Event("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),r))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,r){const n=[],i=this.transform;if(!i)return n;const s="globe"===i.projection.name,o=Fl(i.center.lng);for(const l in this._tiles){const u=this._tiles[l];if(r&&u.clearQueryDebugViz(),u.holdingForFade())continue;let c;if(s){const e=u.tileID.canonical;if(0===e.z){const t=[Math.abs(a(o,...Wd(e,-1))-o),Math.abs(a(o,...Wd(e,1))-o)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(a(o,...Wd(e,-1))-o),Math.abs(a(o,...Wd(e,0))-o),Math.abs(a(o,...Wd(e,1))-o)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const r of c){const s=e.containsTile(u,i,t,r);s&&n.push(s)}}return n}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Yd(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=tl.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const n=this._tiles[e];n&&n.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(const r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter((r=>!r.hasDependency(e,t)))}_preloadTiles(e,t){const r=new Map,n=Array.isArray(e)?e:[e],i=this.map.painter.terrain,s=this.usedForTerrain&&i?i.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}u(Array.from(r.values()),((e,t)=>{const r=new Tile(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,(e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)}))}),t)}preloadTilesForOffline(e,t){const r=new Map,n=Array.isArray(e)?e:[e],i=this.map.painter.terrain,s=this.usedForTerrain&&i?i.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}u(Array.from(r.values()),((e,t)=>{const r=new Tile(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTileForOffline(r,(e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)}))}),t)}}function Xd(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Yd(e){return"raster"===e||"image"===e||"video"===e}function Wd(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}SourceCache.maxOverzooming=10,SourceCache.maxUnderzooming=3;class DEMSampler{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){const n=r||e.findDEMTileFor(t);if(!n||!n.dem)return;const i=n.dem,s=n.tileID,o=1<<t.canonical.z-s.canonical.z;return new DEMSampler(n,n.tileSize/zl/o,[(t.canonical.x/o-s.canonical.x)*i.dim,(t.canonical.y/o-s.canonical.y)*i.dim])}tileCoordToPixel(t,r){const n=r*this._scale+this._offset[1],i=Math.floor(t*this._scale+this._offset[0]),s=Math.floor(n);return new e(i,s)}getElevationAt(e,t,r,n){const i=e*this._scale+this._offset[0],s=t*this._scale+this._offset[1],o=Math.floor(i),a=Math.floor(s),l=this._dem;return n=!!n,r?Oe(Oe(l.get(o,a,n),l.get(o,a+1,n),s-a),Oe(l.get(o+1,a,n),l.get(o+1,a+1,n),s-a),i-o):l.get(o,a,n)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ol(1,e)*this._dem.stride}}class FeatureIndex{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new C(zl,16,0),this.featureIndexArray=new FeatureIndexArray,this.promoteId=t}insert(e,t,r,n,i,s=0){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,s);const a=this.grid;for(let e=0;e<t.length;e++){const r=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){const t=r[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}n[0]<zl&&n[1]<zl&&n[2]>=0&&n[3]>=0&&a.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Zc.VectorTile(new Bh(this.rawTileData)).layers,this.sourceLayerCoder=new DictionaryCoder(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(t,r,n,i){this.loadVTLayers();const s=t.params||{},o=Ko(s.filter),a=t.tileResult,l=t.transform,u=a.bufferedTilespaceBounds,c=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,((t,r,n,i)=>function(t,r,n,i,s){for(const e of t)if(r<=e.x&&n<=e.y&&i>=e.x&&s>=e.y)return!0;const o=[new e(r,n),new e(r,s),new e(i,s),new e(i,n)];if(t.length>2)for(const e of o)if(uu(t,e))return!0;for(let e=0;e<t.length-1;e++)if(cu(t[e],t[e+1],o))return!0;return!1}(a.bufferedTilespaceGeometry,t,r,n,i)));c.sort(Hd);let h=null;l.elevation&&c.length>0&&(h=DEMSampler.create(l.elevation,this.tileID));const p={};let d;for(let e=0;e<c.length;e++){const l=c[e];if(l===d)continue;d=l;const u=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(p,u,o,s.layers,s.availableImages,r,n,i,((e,r,n,i=0)=>(f||(f=Wl(e,this.tileID.canonical,t.tileTransform)),r.queryIntersectsFeature(a,e,n,f,this.z,t.transform,t.pixelPosMatrix,h,i))))}return p}loadMatchingFeature(e,t,r,n,i,s,o,a,l){const{featureIndex:u,bucketIndex:c,sourceLayerIndex:p,layoutVertexArrayOffset:d}=t,f=this.bucketLayerIDs[c];if(n&&!function(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}(n,f))return;const y=this.sourceLayerCoder.decode(p),m=this.vtLayers[y].feature(u);if(r.needGeometry){const e=Jl(m,!0);if(!r.filter(new EvaluationParameters(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!r.filter(new EvaluationParameters(this.tileID.overscaledZ),m))return;const g=this.getId(m,y);for(let t=0;t<f.length;t++){const r=f[t];if(n&&n.indexOf(r)<0)continue;const c=s[r];if(!c)continue;let p={};void 0!==g&&a&&(p=a.getState(c.sourceLayer||"_geojsonTileLayer",g));const y=h({},o[r]);y.paint=Jd(y.paint,c.paint,m,p,i),y.layout=Jd(y.layout,c.layout,m,p,i);const x=!l||l(m,c,p,d);if(!x)continue;const v=new Feature(m,this.z,this.x,this.y,g);v.layer=y;let b=e[r];void 0===b&&(b=e[r]=[]),b.push({featureIndex:u,feature:v,intersectionZ:x})}}lookupSymbolFeatures(e,t,r,n,i,s,o,a){const l={};this.loadVTLayers();const u=Ko(i);for(const i of e)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:n,featureIndex:i,layoutVertexArrayOffset:0},u,s,o,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[t])return i[t];const s=this.vtLayers[n].feature(t);return i[t]=s,s}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;return this.promoteId&&(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof r&&(r=Number(r))),r}}function Jd(e,t,r,n,i){return g(e,((e,s)=>{const o=t instanceof PossiblyEvaluated?t.get(s):null;return o&&o.evaluate?o.evaluate(r,n,i):o}))}function Hd(e,t){return t-e}ko(FeatureIndex,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class LineAtlas{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new AlphaImage({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=(r=this.nextRow)<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2));var r;this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const n=[];let i=e.length%2==1?-e[e.length-1]*r:0,s=e[0]*r,o=!0;n.push({left:i,right:s,isDash:o,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){o=!o;const l=e[t];i=a*r,a+=l,s=a*r,n.push({left:i,right:s,isDash:o,zeroLength:0===l})}return n}addRoundDash(e,t,r){const n=t/2;for(let t=-r;t<=r;t++){const i=this.width*(this.nextRow+r+t);let s=0,o=e[s];for(let a=0;a<this.width;a++){a/o.right>1&&(o=e[++s]);const l=Math.abs(a-o.left),u=Math.abs(a-o.right),c=Math.min(l,u);let h;const p=t/r*(n+1);if(o.isDash){const e=n-Math.abs(p);h=Math.sqrt(c*c+e*e)}else h=n-Math.sqrt(c*c+p*p);this.image.data[i+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const r=e[t],n=e[t+1];r.zeroLength?e.splice(t,1):n&&n.isDash===r.isDash&&(n.left=r.left,e.splice(t,1))}const r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const i=this.width*this.nextRow;let s=0,o=e[s];for(let r=0;r<this.width;r++){r/o.right>1&&(o=e[++s]);const n=Math.abs(r-o.left),a=Math.abs(r-o.right),l=Math.min(n,a);this.image.data[i+r]=Math.max(0,Math.min(255,(o.isDash?l:-l)+t+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const n="round"===t,i=n?7:0,s=2*i+1;if(this.nextRow+s>this.height)return b("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let t=0;t<e.length;t++)e[t]<0&&(b("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),o+=e[t];if(0!==o){const r=this.width/o,s=this.getDashRanges(e,this.width,r);n?this.addRoundDash(s,r,i):this.addRegularDash(s,"square"===t?.5*r:0)}const a=this.nextRow+i;this.nextRow+=s;const l={tl:[a,i],br:[o,0]};return this.positions[r]=l,l}}ko(LineAtlas,"LineAtlas");class GlyphAtlas{constructor(e){const t={},r=[];for(const n in e){const i=e[n],s=t[n]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?2:1,o={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};r.push(o),s[e]=o}}const{w:n,h:i}=ep(r),s=new AlphaImage({width:n||1,height:i||1});for(const r in e){const n=e[r];for(const e in n.glyphs){const i=n.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const o=t[r][e],a=i.metrics.localGlyph?2:1;AlphaImage.copy(i.bitmap,s,{x:0,y:0},{x:o.x+a,y:o.y+a},i.bitmap)}}this.image=s,this.positions=t}}ko(GlyphAtlas,"GlyphAtlas");class WorkerTile{constructor(e){this.tileID=new OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=nd(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,r,n,i){this.status="parsing",this.data=e,this.collisionBoxArray=new CollisionBoxArray;const s=new DictionaryCoder(Object.keys(e.layers).sort()),o=new FeatureIndex(this.tileID,this.promoteId);o.bucketLayerIDs=[];const a={},l=new LineAtlas(256,256),u={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:r},h=t.familiesBySource[this.source];for(const t in h){const n=e.layers[t];if(!n)continue;let i=!1,l=!1;for(const e of h[t])"symbol"===e[0].type?i=!0:l=!0;if(!0===this.isSymbolTile&&!i)continue;if(!1===this.isSymbolTile&&!l)continue;1===n.version&&b(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const c=s.encode(t),p=[];for(let e=0;e<n.length;e++){const r=n.feature(e),i=o.getId(r,t);p.push({feature:r,id:i,index:e,sourceLayerIndex:c})}for(const e of h[t]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Qd(e,this.zoom,r),(a[t.id]=t.createBucket({index:o.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:c,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(p,u,this.tileID.canonical,this.tileTransform),o.bucketLayerIDs.push(e.map((e=>e.id))))}}let p,d,f,y;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},x=g(u.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(x).length?n.send("getGlyphs",{uid:this.uid,stacks:x},((e,t)=>{p||(p=e,d=t,_.call(this))}),void 0,!1,m):d={};const v=Object.keys(u.iconDependencies);v.length?n.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{p||(p=e,f=t,_.call(this))}),void 0,!1,m):f={};const w=Object.keys(u.patternDependencies);function _(){if(p)return i(p);if(d&&f&&y){const e=new GlyphAtlas(d),t=new ImageAtlas(f,y);for(const n in a){const i=a[n];i instanceof SymbolBucket?(Qd(i.layers,this.zoom,r),Bp(i,d,e.positions,f,t.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):i.hasPattern&&(i instanceof LineBucket||i instanceof FillBucket||i instanceof FillExtrusionBucket)&&(Qd(i.layers,this.zoom,r),i.addFeatures(u,this.tileID.canonical,t.patternPositions,r,this.tileTransform))}this.status="done",i(null,{buckets:c(a).filter((e=>!e.isEmpty())),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}w.length?n.send("getImages",{icons:w,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{p||(p=e,y=t,_.call(this))}),void 0,!1,m):y={},_.call(this)}}function Qd(e,t,r){const n=new EvaluationParameters(t);for(const t of e)t.recalculate(n,r)}class DedupedRequest{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,n){const i=this.entries[e]=this.entries[e]||{callbacks:[]};if(i.result){const[e,r]=i.result;return this.scheduler?this.scheduler.add((()=>{n(e,r)}),t):n(e,r),()=>{}}return i.callbacks.push(n),i.cancel||(i.cancel=r(((r,n)=>{i.result=[r,n];for(const e of i.callbacks)this.scheduler?this.scheduler.add((()=>{e(r,n)}),t):e(r,n);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{i.result||(i.callbacks=i.callbacks.filter((e=>e!==n)),i.callbacks.length||(i.cancel(),delete this.entries[e]))}}}function ef(e,t,r){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const n=wo(e.request,((e,n,i,s)=>{e?t(e):n&&t(null,{vectorTile:r?void 0:new Zc.VectorTile(new Bh(n)),rawData:n,cacheControl:i,expires:s})}));return()=>{n.cancel(),t()}}),t)}function tf(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const i=function(e,t){return function(e,t){if(!xo(e.url)){if(r.fetch&&r.Request&&r.AbortController&&r.Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new r.AbortController,i=new r.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:go(),signal:n.signal});let s=!1,o=!1;const a=ir(i.url);"json"===e.type&&i.headers.set("Accept","application/json");const l=(n,s,l)=>{if(o)return;if(n&&"SecurityError"!==n.message&&b(n),s&&l)return u(s);const c=Date.now();r.fetch(i).then((r=>{if(r.ok){const e=a?r.clone():null;return u(r,e,c)}return t(new AJAXError(r.statusText,r.status,e.url))})).catch((e=>{20!==e.code&&t(new Error(e.message))}))},u=(r,n,a)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then((async e=>{if(!o){if(n&&a){mr(i,n,a);const t=xr(i.url),r=await vo(t);r&&await r.delete();try{await mo.tiles.add({url:t,blob:e})}catch(e){console.log("botlink cache failed to cache tile"),console.error(e.message)}}s=!0,t(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires"))}})).catch((e=>{o||t(new Error(e.message))}))};return a?vr(i,l):l(null,null),{cancel:()=>{o=!0,s||n.abort()}}}(e,t);if(S()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResourceForOffline",e,t,void 0,!0)}return function(e,t){const n=new r.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const t in e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let r=n.response;if("json"===e.type)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new AJAXError(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)}(h(e,{type:"arrayBuffer"}),t)}(e.request,((e,r,i,s)=>{e?t(e):r&&t(null,{vectorTile:n?void 0:new Zc.VectorTile(new Bh(r)),rawData:r,cacheControl:i,expires:s})}));return()=>{i.cancel(),t()}}),t)}class VectorTileWorkerSource extends Evented{constructor(e,t,r,n,i){super(),this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=i||ef,this.loadVectorDataForOffline=i||tf,this.loading={},this.loaded={},this.deduped=new DedupedRequest(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler}loadTile(e,t){const r=e.uid,n=e&&e.request,i=n&&n.collectResourceTiming,s=this.loading[r]=new WorkerTile(e);s.abort=this.loadVectorData(e,((o,a)=>{const l=!this.loading[r];if(delete this.loading[r],l||o||!a)return s.status="done",l||(this.loaded[r]=s),t(o);const u=a.rawData,c={};a.expires&&(c.expires=a.expires),a.cacheControl&&(c.cacheControl=a.cacheControl),s.vectorTile=a.vectorTile||new Zc.VectorTile(new Bh(u));const p=()=>{s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(e||!r)return t(e);const s={};if(i){const e=Mo(n);e.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,h({rawTileData:u.slice(0)},r,c,s))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[r]=s}))}loadTileForOffline(e,t){const r=e.uid,n=e&&e.request,i=n&&n.collectResourceTiming,s=this.loading[r]=new WorkerTile(e);s.abort=this.loadVectorDataForOffline(e,((o,a)=>{const l=!this.loading[r];if(delete this.loading[r],l||o||!a)return s.status="done",l||(this.loaded[r]=s),t(o);const u=a.rawData,c={};a.expires&&(c.expires=a.expires),a.cacheControl&&(c.cacheControl=a.cacheControl),s.vectorTile=a.vectorTile||new Zc.VectorTile(new Bh(u));const p=()=>{s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(e||!r)return t(e);const s={};if(i){const e=Mo(n);e.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,h({rawTileData:u.slice(0)},r,c,s))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[r]=s}))}reloadTile(e,t){const r=this.loaded,n=e.uid,i=this;if(r&&r[n]){const s=r[n];s.showCollisionBoxes=e.showCollisionBoxes,s.enableTerrain=!!e.enableTerrain,s.projection=e.projection,s.tileTransform=nd(e.tileID.canonical,e.projection);const o=(e,r)=>{const n=s.reloadCallback;n&&(delete s.reloadCallback,s.parse(s.vectorTile,i.layerIndex,this.availableImages,i.actor,n)),t(e,r)};"parsing"===s.status?s.reloadCallback=o:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(e,t){const r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}}class RasterDEMTileWorkerSource{loadTile(e,t){const{uid:n,encoding:i,rawImageData:s,padding:o,buildQuadTree:a}=e,l=r.ImageBitmap&&s instanceof r.ImageBitmap?this.getImageData(s,o):s;t(null,new DEMData(n,l,i,o<1,a))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const r=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}var rf=function e(t,r){var n,i=t&&t.type;if("FeatureCollection"===i)for(n=0;n<t.features.length;n++)e(t.features[n],r);else if("GeometryCollection"===i)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],r);else if("Feature"===i)e(t.geometry,r);else if("Polygon"===i)nf(t.coordinates,r);else if("MultiPolygon"===i)for(n=0;n<t.coordinates.length;n++)nf(t.coordinates[n],r);return t};function nf(e,t){if(0!==e.length){sf(e[0],t);for(var r=1;r<e.length;r++)sf(e[r],!t)}}function sf(e,t){for(var r=0,n=0,i=0,s=e.length,o=s-1;i<s;o=i++){var a=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),l=r+a;n+=Math.abs(r)>=Math.abs(a)?r-l+a:a-l+r,r=l}r+n>=0!=!!t&&e.reverse()}const of=Zc.VectorTileFeature.prototype.toGeoJSON;class FeatureWrapper$1{constructor(e){this._feature=e,this.extent=zl,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const r of this._feature.geometry)t.push([new e(r[0],r[1])]);return t}{const t=[];for(const r of this._feature.geometry){const n=[];for(const t of r)n.push(new e(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,r){return of.call(this,e,t,r)}}class GeoJSONWrapper$1{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=zl,this.length=e.length,this._features=e}feature(e){return new FeatureWrapper$1(this._features[e])}}var af=Zc.VectorTileFeature,lf=uf;function uf(e,t){this.options=t||{},this.features=e,this.length=e.length}function cf(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}uf.prototype.feature=function(e){return new cf(this.features[e],this.options.extent)},cf.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var r=0;r<t.length;r++){for(var n=t[r],i=[],s=0;s<n.length;s++)i.push(new e(n[s][0],n[s][1]));this.geometry.push(i)}return this.geometry},cf.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,n=1/0,i=-1/0,s=0;s<e.length;s++)for(var o=e[s],a=0;a<o.length;a++){var l=o[a];t=Math.min(t,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[t,n,r,i]},cf.prototype.toGeoJSON=af.prototype.toGeoJSON;var hf=df,pf=lf;function df(e){var t=new Bh;return function(e,t){for(var r in e.layers)t.writeMessage(3,ff,e.layers[r])}(e,t),t.finish()}function ff(e,t){var r;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)n.feature=e.feature(r),t.writeMessage(2,yf,n);var i=n.keys;for(r=0;r<i.length;r++)t.writeStringField(3,i[r]);var s=n.values;for(r=0;r<s.length;r++)t.writeMessage(4,bf,s[r])}function yf(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,mf,e),t.writeVarintField(3,r.type),t.writeMessage(4,vf,r)}function mf(e,t){var r=e.feature,n=e.keys,i=e.values,s=e.keycache,o=e.valuecache;for(var a in r.properties){var l=r.properties[a],u=s[a];if(null!==l){void 0===u&&(n.push(a),s[a]=u=n.length-1),t.writeVarint(u);var c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=o[h];void 0===p&&(i.push(l),o[h]=p=i.length-1),t.writeVarint(p)}}}function gf(e,t){return(t<<3)+(7&e)}function xf(e){return e<<1^e>>31}function vf(e,t){for(var r=e.loadGeometry(),n=e.type,i=0,s=0,o=r.length,a=0;a<o;a++){var l=r[a],u=1;1===n&&(u=l.length),t.writeVarint(gf(1,u));for(var c=3===n?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==n&&t.writeVarint(gf(2,c-1));var p=l[h].x-i,d=l[h].y-s;t.writeVarint(xf(p)),t.writeVarint(xf(d)),i+=p,s+=d}3===n&&t.writeVarint(gf(7,1))}}function bf(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function wf(e,t,r,n,i,s){if(i-n<=r)return;const o=n+i>>1;_f(e,t,o,n,i,s%2),wf(e,t,r,n,o-1,s+1),wf(e,t,r,o+1,i,s+1)}function _f(e,t,r,n,i,s){for(;i>n;){if(i-n>600){const o=i-n+1,a=r-n+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(a-o/2<0?-1:1);_f(e,t,r,Math.max(n,Math.floor(r-a*u/o+c)),Math.min(i,Math.floor(r+(o-a)*u/o+c)),s)}const o=t[2*r+s];let a=n,l=i;for(Sf(e,t,n,r),t[2*i+s]>o&&Sf(e,t,n,i);a<l;){for(Sf(e,t,a,l),a++,l--;t[2*a+s]<o;)a++;for(;t[2*l+s]>o;)l--}t[2*n+s]===o?Sf(e,t,n,l):(l++,Sf(e,t,l,i)),l<=r&&(n=l+1),r<=l&&(i=l-1)}}function Sf(e,t,r,n){Af(e,r,n),Af(t,2*r,2*n),Af(t,2*r+1,2*n+1)}function Af(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function kf(e,t,r,n){const i=e-r,s=t-n;return i*i+s*s}hf.fromVectorTileJs=df,hf.fromGeojsonVt=function(e,t){t=t||{};var r={};for(var n in e)r[n]=new lf(e[n].features,t),r[n].name=n,r[n].version=t.version,r[n].extent=t.extent;return df({layers:r})},hf.GeoJSONWrapper=pf;const If=e=>e[0],Pf=e=>e[1];class KDBush{constructor(e,t=If,r=Pf,n=64,i=Float64Array){this.nodeSize=n,this.points=e;const s=e.length<65536?Uint16Array:Uint32Array,o=this.ids=new s(e.length),a=this.coords=new i(2*e.length);for(let n=0;n<e.length;n++)o[n]=n,a[2*n]=t(e[n]),a[2*n+1]=r(e[n]);wf(o,a,n,0,o.length-1,0)}range(e,t,r,n){return function(e,t,r,n,i,s,o){const a=[0,e.length-1,0],l=[];let u,c;for(;a.length;){const h=a.pop(),p=a.pop(),d=a.pop();if(p-d<=o){for(let o=d;o<=p;o++)u=t[2*o],c=t[2*o+1],u>=r&&u<=i&&c>=n&&c<=s&&l.push(e[o]);continue}const f=Math.floor((d+p)/2);u=t[2*f],c=t[2*f+1],u>=r&&u<=i&&c>=n&&c<=s&&l.push(e[f]);const y=(h+1)%2;(0===h?r<=u:n<=c)&&(a.push(d),a.push(f-1),a.push(y)),(0===h?i>=u:s>=c)&&(a.push(f+1),a.push(p),a.push(y))}return l}(this.ids,this.coords,e,t,r,n,this.nodeSize)}within(e,t,r){return function(e,t,r,n,i,s){const o=[0,e.length-1,0],a=[],l=i*i;for(;o.length;){const u=o.pop(),c=o.pop(),h=o.pop();if(c-h<=s){for(let i=h;i<=c;i++)kf(t[2*i],t[2*i+1],r,n)<=l&&a.push(e[i]);continue}const p=Math.floor((h+c)/2),d=t[2*p],f=t[2*p+1];kf(d,f,r,n)<=l&&a.push(e[p]);const y=(u+1)%2;(0===u?r-i<=d:n-i<=f)&&(o.push(h),o.push(p-1),o.push(y)),(0===u?r+i>=d:n+i>=f)&&(o.push(p+1),o.push(c),o.push(y))}return a}(this.ids,this.coords,e,t,r,this.nodeSize)}}const Tf={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},Cf=Math.fround||(Ef=new Float32Array(1),e=>(Ef[0]=+e,Ef[0]));var Ef;class Supercluster{constructor(e){this.options=Rf(Object.create(Tf),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:r,maxZoom:n,nodeSize:i}=this.options;t&&console.time("total time");const s=`prepare ${e.length} points`;t&&console.time(s),this.points=e;let o=[];for(let t=0;t<e.length;t++)e[t].geometry&&o.push(Df(e[t],t));this.trees[n+1]=new KDBush(o,Of,jf,i,Float32Array),t&&console.timeEnd(s);for(let e=n;e>=r;e--){const r=+Date.now();o=this._cluster(o,e),this.trees[e]=new KDBush(o,Of,jf,i,Float32Array),t&&console.log("z%d: %d clusters in %dms",e,o.length,+Date.now()-r)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,i=180;else if(r>i){const e=this.getClusters([r,n,180,s],t),o=this.getClusters([-180,n,i,s],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],a=o.range(Vf(r),Lf(s),Vf(i),Lf(n)),l=[];for(const e of a){const t=o.points[e];l.push(t.numPoints?zf(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);const s=i.points[t];if(!s)throw new Error(n);const o=this.options.radius/(this.options.extent*Math.pow(2,r-1)),a=i.within(s.x,s.y,o),l=[];for(const t of a){const r=i.points[t];r.parentId===e&&l.push(r.numPoints?zf(r):this.points[r.index])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,r){const n=[];return this._appendLeaves(n,e,t=t||10,r=r||0,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:s,radius:o}=this.options,a=o/s,l=(r-a)/i,u=(r+1+a)/i,c={features:[]};return this._addTileFeatures(n.range((t-a)/i,l,(t+1+a)/i,u),n.points,t,r,i,c),0===t&&this._addTileFeatures(n.range(1-a/i,l,1,u),n.points,i,r,i,c),t===i-1&&this._addTileFeatures(n.range(0,l,a/i,u),n.points,-1,r,i,c),c.features.length?c:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,i){const s=this.getChildren(t);for(const t of s){const s=t.properties;if(s&&s.cluster?i+s.point_count<=n?i+=s.point_count:i=this._appendLeaves(e,s.cluster_id,r,n,i):i<n?i++:e.push(t),e.length===r)break}return i}_addTileFeatures(e,t,r,n,i,s){for(const o of e){const e=t[o],a=e.numPoints;let l,u,c;if(a)l=Bf(e),u=e.x,c=e.y;else{const t=this.points[e.index];l=t.properties,u=Vf(t.geometry.coordinates[0]),c=Lf(t.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(u*i-r)),Math.round(this.options.extent*(c*i-n))]],tags:l};let p;a?p=e.id:this.options.generateId?p=e.index:this.points[e.index].id&&(p=this.points[e.index].id),void 0!==p&&(h.id=p),s.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}_cluster(e,t){const r=[],{radius:n,extent:i,reduce:s,minPoints:o}=this.options,a=n/(i*Math.pow(2,t));for(let n=0;n<e.length;n++){const i=e[n];if(i.zoom<=t)continue;i.zoom=t;const l=this.trees[t+1],u=l.within(i.x,i.y,a),c=i.numPoints||1;let h=c;for(const e of u){const r=l.points[e];r.zoom>t&&(h+=r.numPoints||1)}if(h>c&&h>=o){let e=i.x*c,o=i.y*c,a=s&&c>1?this._map(i,!0):null;const p=(n<<5)+(t+1)+this.points.length;for(const r of u){const n=l.points[r];if(n.zoom<=t)continue;n.zoom=t;const u=n.numPoints||1;e+=n.x*u,o+=n.y*u,n.parentId=p,s&&(a||(a=this._map(i,!0)),s(a,this._map(n)))}i.parentId=p,r.push(Mf(e/h,o/h,p,h,a))}else if(r.push(i),h>1)for(const e of u){const n=l.points[e];n.zoom<=t||(n.zoom=t,r.push(n))}}return r}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?Rf({},e.properties):e.properties;const r=this.points[e.index].properties,n=this.options.map(r);return t&&n===r?Rf({},n):n}}function Mf(e,t,r,n,i){return{x:Cf(e),y:Cf(t),zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function Df(e,t){const[r,n]=e.geometry.coordinates;return{x:Cf(Vf(r)),y:Cf(Lf(n)),zoom:1/0,index:t,parentId:-1}}function zf(e){return{type:"Feature",id:e.id,properties:Bf(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),Ff(e.y)]}};var t}function Bf(e){const t=e.numPoints,r=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?Math.round(t/100)/10+"k":t;return Rf(Rf({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:r})}function Vf(e){return e/360+.5}function Lf(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Ff(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function Rf(e,t){for(const r in t)e[r]=t[r];return e}function Of(e){return e.x}function jf(e){return e.y}function qf(e,t,r,n){for(var i,s=n,o=r-t>>1,a=r-t,l=e[t],u=e[t+1],c=e[r],h=e[r+1],p=t+3;p<r;p+=3){var d=$f(e[p],e[p+1],l,u,c,h);if(d>s)i=p,s=d;else if(d===s){var f=Math.abs(p-o);f<a&&(i=p,a=f)}}s>n&&(i-t>3&&qf(e,t,i,n),e[i+2]=s,r-i>3&&qf(e,i,r,n))}function $f(e,t,r,n,i,s){var o=i-r,a=s-n;if(0!==o||0!==a){var l=((e-r)*o+(t-n)*a)/(o*o+a*a);l>1?(r=i,n=s):l>0&&(r+=o*l,n+=a*l)}return(o=e-r)*o+(a=t-n)*a}function Uf(e,t,r,n){var i={id:void 0===e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)Nf(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<t.length;n++)Nf(e,t[n]);else if("MultiPolygon"===r)for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)Nf(e,t[n][i])}(i),i}function Nf(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function Kf(e,t,r,n){if(t.geometry){var i=t.geometry.coordinates,s=t.geometry.type,o=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),a=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===s)Zf(i,a);else if("MultiPoint"===s)for(var u=0;u<i.length;u++)Zf(i[u],a);else if("LineString"===s)Gf(i,a,o,!1);else if("MultiLineString"===s){if(r.lineMetrics){for(u=0;u<i.length;u++)Gf(i[u],a=[],o,!1),e.push(Uf(l,"LineString",a,t.properties));return}Xf(i,a,o,!1)}else if("Polygon"===s)Xf(i,a,o,!0);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(u=0;u<t.geometry.geometries.length;u++)Kf(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var c=[];Xf(i[u],c,o,!0),a.push(c)}}e.push(Uf(l,s,a,t.properties))}}function Zf(e,t){t.push(Yf(e[0])),t.push(Wf(e[1])),t.push(0)}function Gf(e,t,r,n){for(var i,s,o=0,a=0;a<e.length;a++){var l=Yf(e[a][0]),u=Wf(e[a][1]);t.push(l),t.push(u),t.push(0),a>0&&(o+=n?(i*u-l*s)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-s,2))),i=l,s=u}var c=t.length-3;t[2]=1,qf(t,0,c,r),t[c+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function Xf(e,t,r,n){for(var i=0;i<e.length;i++){var s=[];Gf(e[i],s,r,n),t.push(s)}}function Yf(e){return e/360+.5}function Wf(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Jf(e,t,r,n,i,s,o,a){if(n/=t,s>=(r/=t)&&o<n)return e;if(o<r||s>=n)return null;for(var l=[],u=0;u<e.length;u++){var c=e[u],h=c.geometry,p=c.type,d=0===i?c.minX:c.minY,f=0===i?c.maxX:c.maxY;if(d>=r&&f<n)l.push(c);else if(!(f<r||d>=n)){var y=[];if("Point"===p||"MultiPoint"===p)Hf(h,y,r,n,i);else if("LineString"===p)Qf(h,y,r,n,i,!1,a.lineMetrics);else if("MultiLineString"===p)ty(h,y,r,n,i,!1);else if("Polygon"===p)ty(h,y,r,n,i,!0);else if("MultiPolygon"===p)for(var m=0;m<h.length;m++){var g=[];ty(h[m],g,r,n,i,!0),g.length&&y.push(g)}if(y.length){if(a.lineMetrics&&"LineString"===p){for(m=0;m<y.length;m++)l.push(Uf(c.id,p,y[m],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===y.length?(p="LineString",y=y[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===y.length?"Point":"MultiPoint"),l.push(Uf(c.id,p,y,c.tags))}}}return l.length?l:null}function Hf(e,t,r,n,i){for(var s=0;s<e.length;s+=3){var o=e[s+i];o>=r&&o<=n&&(t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]))}}function Qf(e,t,r,n,i,s,o){for(var a,l,u=ey(e),c=0===i?ny:iy,h=e.start,p=0;p<e.length-3;p+=3){var d=e[p],f=e[p+1],y=e[p+2],m=e[p+3],g=e[p+4],x=0===i?d:f,v=0===i?m:g,b=!1;o&&(a=Math.sqrt(Math.pow(d-m,2)+Math.pow(f-g,2))),x<r?v>r&&(l=c(u,d,f,m,g,r),o&&(u.start=h+a*l)):x>n?v<n&&(l=c(u,d,f,m,g,n),o&&(u.start=h+a*l)):ry(u,d,f,y),v<r&&x>=r&&(l=c(u,d,f,m,g,r),b=!0),v>n&&x<=n&&(l=c(u,d,f,m,g,n),b=!0),!s&&b&&(o&&(u.end=h+a*l),t.push(u),u=ey(e)),o&&(h+=a)}var w=e.length-3;d=e[w],f=e[w+1],y=e[w+2],(x=0===i?d:f)>=r&&x<=n&&ry(u,d,f,y),w=u.length-3,s&&w>=3&&(u[w]!==u[0]||u[w+1]!==u[1])&&ry(u,u[0],u[1],u[2]),u.length&&t.push(u)}function ey(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ty(e,t,r,n,i,s){for(var o=0;o<e.length;o++)Qf(e[o],t,r,n,i,s,!1)}function ry(e,t,r,n){e.push(t),e.push(r),e.push(n)}function ny(e,t,r,n,i,s){var o=(s-t)/(n-t);return e.push(s),e.push(r+(i-r)*o),e.push(1),o}function iy(e,t,r,n,i,s){var o=(s-r)/(i-r);return e.push(t+(n-t)*o),e.push(s),e.push(1),o}function sy(e,t){for(var r=[],n=0;n<e.length;n++){var i,s=e[n],o=s.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)i=oy(s.geometry,t);else if("MultiLineString"===o||"Polygon"===o){i=[];for(var a=0;a<s.geometry.length;a++)i.push(oy(s.geometry[a],t))}else if("MultiPolygon"===o)for(i=[],a=0;a<s.geometry.length;a++){for(var l=[],u=0;u<s.geometry[a].length;u++)l.push(oy(s.geometry[a][u],t));i.push(l)}r.push(Uf(s.id,o,i,s.tags))}return r}function oy(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function ay(e,t){if(e.transformed)return e;var r,n,i,s=1<<e.z,o=e.x,a=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(ly(u[n],u[n+1],t,s,o,a));else for(n=0;n<u.length;n++){var h=[];for(i=0;i<u[n].length;i+=2)h.push(ly(u[n][i],u[n][i+1],t,s,o,a));l.geometry.push(h)}}return e.transformed=!0,e}function ly(e,t,r,n,i,s){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-s))]}function uy(e,t,r,n,i){for(var s=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){o.numFeatures++,cy(o,e[a],s,i);var l=e[a].minX,u=e[a].minY,c=e[a].maxX,h=e[a].maxY;l<o.minX&&(o.minX=l),u<o.minY&&(o.minY=u),c>o.maxX&&(o.maxX=c),h>o.maxY&&(o.maxY=h)}return o}function cy(e,t,r,n){var i=t.geometry,s=t.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<i.length;a+=3)o.push(i[a]),o.push(i[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)hy(o,i,e,r,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<i.length;a++)hy(o,i[a],e,r,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var l=0;l<i.length;l++){var u=i[l];for(a=0;a<u.length;a++)hy(o,u[a],e,r,!0,0===a)}if(o.length){var c=t.tags||null;if("LineString"===s&&n.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:c};null!==t.id&&(p.id=t.id),e.features.push(p)}}function hy(e,t,r,n,i,s){var o=n*n;if(n>0&&t.size<(i?o:n))r.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>o)&&(r.numSimplified++,a.push(t[l]),a.push(t[l+1])),r.numPoints++;i&&function(e,t){for(var r=0,n=0,i=e.length,s=i-2;n<i;s=n,n+=2)r+=(e[n]-e[s])*(e[n+1]+e[s+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var o=e[n],a=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=o,e[i-1-n]=a}}(a,s),e.push(a)}}function py(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)Kf(r,e.features[n],t,n);else Kf(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(e,t){var r=t.buffer/t.extent,n=e,i=Jf(e,1,-1-r,r,0,-1,2,t),s=Jf(e,1,1-r,2+r,0,-1,2,t);return(i||s)&&(n=Jf(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=sy(i,1).concat(n)),s&&(n=n.concat(sy(s,-1)))),n}(n,t)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function dy(e,t,r){return 32*((1<<e)*r+t)+e}function fy(e,t){const r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return t(null,null);const i=new GeoJSONWrapper$1(n.features);let s=hf(i);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),t(null,{vectorTile:i,rawData:s.buffer})}py.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},py.prototype.splitTile=function(e,t,r,n,i,s,o){for(var a=[e,t,r,n],l=this.options,u=l.debug;a.length;){n=a.pop(),r=a.pop(),t=a.pop(),e=a.pop();var c=1<<t,h=dy(t,r,n),p=this.tiles[h];if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=uy(e,t,r,n,l),this.tileCoords.push({z:t,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+t;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=e,i){if(t===l.maxZoom||t===i)continue;var f=1<<i-t;if(r!==Math.floor(s/f)||n!==Math.floor(o/f))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){u>1&&console.time("clipping");var y,m,g,x,v,b,w=.5*l.buffer/l.extent,_=.5-w,S=.5+w,A=1+w;y=m=g=x=null,v=Jf(e,c,r-w,r+S,0,p.minX,p.maxX,l),b=Jf(e,c,r+_,r+A,0,p.minX,p.maxX,l),e=null,v&&(y=Jf(v,c,n-w,n+S,1,p.minY,p.maxY,l),m=Jf(v,c,n+_,n+A,1,p.minY,p.maxY,l),v=null),b&&(g=Jf(b,c,n-w,n+S,1,p.minY,p.maxY,l),x=Jf(b,c,n+_,n+A,1,p.minY,p.maxY,l),b=null),u>1&&console.timeEnd("clipping"),a.push(y||[],t+1,2*r,2*n),a.push(m||[],t+1,2*r,2*n+1),a.push(g||[],t+1,2*r+1,2*n),a.push(x||[],t+1,2*r+1,2*n+1)}}},py.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,s=n.debug;if(e<0||e>24)return null;var o=1<<e,a=dy(e,t=(t%o+o)%o,r);if(this.tiles[a])return ay(this.tiles[a],i);s>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l,u=e,c=t,h=r;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[dy(u,c,h)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",u,c,h),s>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,e,t,r),s>1&&console.timeEnd("drilling down"),this.tiles[a]?ay(this.tiles[a],i):null):null};class GeoJSONWorkerSource extends VectorTileWorkerSource{constructor(e,t,r,n,i){super(e,t,r,n,fy),i&&(this.loadGeoJSON=i)}loadData(e,t){const r=e&&e.request,n=r&&r.collectResourceTiming;this.loadGeoJSON(e,((i,s)=>{if(i||!s)return t(i);if("object"!=typeof s)return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{rf(s,!0);try{if(e.filter){const t=Kt(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const r=s.features.filter((e=>t.value.evaluate({zoom:0},e)));s={type:"FeatureCollection",features:r}}this._geoJSONIndex=e.cluster?new Supercluster(function({superclusterOptions:e,clusterProperties:t}){if(!t||!e)return e;const r={},n={},i={accumulated:null,zoom:0},s={properties:null},o=Object.keys(t);for(const e of o){const[i,s]=t[e],o=Kt(s),a=Kt("string"==typeof i?[i,["accumulated"],["get",e]]:i);r[e]=o.value,n[e]=a.value}return e.map=e=>{s.properties=e;const t={};for(const e of o)t[e]=r[e].evaluate(i,s);return t},e.reduce=(e,t)=>{s.properties=t;for(const t of o)i.accumulated=e[t],e[t]=n[t].evaluate(i,s)},e}(e)).load(s.features):function(e,t){return new py(e,t)}(s,e.geojsonVtOptions)}catch(i){return t(i)}this.loaded={};const o={};if(n){const t=Mo(r);t&&(o.resourceTiming={},o.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}t(null,o)}}))}reloadTile(e,t){const r=this.loaded;return r&&r[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(e,t){if(e.request)!function(e,t){bo(h(e,{type:"json"}),t)}(e.request,t);else{if("string"!=typeof e.data)return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return t(null,JSON.parse(e.data))}catch(r){return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class Worker{constructor(e){this.self=e,this.actor=new Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=fd({name:"mercator"}),this.workerSourceTypes={vector:VectorTileWorkerSource,geojson:GeoJSONWorkerSource},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=e=>{if(cl.isParsed())throw new Error("RTL text plugin already registered.");cl.applyArabicShaping=e.applyArabicShaping,cl.processBidirectionalText=e.processBidirectionalText,cl.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(e,t){this.isSpriteLoaded[e]=t;for(const r in this.workerSources[e]){const n=this.workerSources[e][r];for(const e in n)n[e]instanceof VectorTileWorkerSource&&(n[e].isSpriteLoaded=t,n[e].fire(new Event("isSpriteLoaded")))}}setImages(e,t,r){this.availableImages[e]=t;for(const r in this.workerSources[e]){const n=this.workerSources[e][r];for(const e in n)n[e].availableImages=t}r()}enableTerrain(e,t,r){this.terrain=t,r()}setProjection(e,t){this.projections[e]=fd(t)}setLayers(e,t,r){this.getLayerIndex(e).replace(t),r()}updateLayers(e,t,r){this.getLayerIndex(e).update(t.layers,t.removedIds),r()}loadTile(e,t,r){const n=this.enableTerrain?h({enableTerrain:this.terrain},t):t;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).loadTile(n,r)}loadTileForOffline(e,t,r){const n=this.enableTerrain?h({enableTerrain:this.terrain},t):t;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).loadTileForOffline(n,r)}loadDEMTile(e,t,r){const n=this.enableTerrain?h({buildQuadTree:this.terrain},t):t;this.getDEMWorkerSource(e,t.source).loadTile(n,r)}reloadTile(e,t,r){const n=this.enableTerrain?h({enableTerrain:this.terrain},t):t;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).reloadTile(n,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source).removeTile(t,r)}removeSource(e,t,r){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const n=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(e,t,r){try{cl.setState(t);const e=cl.getPluginURL();if(cl.isLoaded()&&!cl.isParsed()&&null!=e){this.self.importScripts(e);const t=cl.isParsed();r(t?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),t)}}catch(e){r(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new StyleLayerIndex),t}getWorkerSource(e,t,r){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][r]||(this.workerSources[e][t][r]=new this.workerSourceTypes[t]({send:(t,r,n,i,s,o)=>{this.actor.send(t,r,n,e,s,o)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])),this.workerSources[e][t][r]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new RasterDEMTileWorkerSource),this.demWorkerSources[e][t]}enforceCacheSizeLimit(e,t){!function(e){for(const t in dr)yr(t),dr[t].then((t=>{t.keys().then((r=>{for(let n=0;n<r.length-e;n++)t.delete(r[n])}))}))}(t)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Worker(self)),Worker}();
//# sourceMappingURL=mapbox-gl-csp-worker.js.map
